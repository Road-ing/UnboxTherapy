{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\..\\..\\App.svelte",
    "..\\..\\..\\Article.svelte",
    "..\\..\\..\\article.svelte",
    "..\\..\\..\\ActivationAnimator.svelte",
    "..\\..\\..\\Activationview.svelte",
    "..\\..\\..\\ConvolutionAnimator.svelte",
    "..\\..\\..\\Convolutionview.svelte",
    "..\\..\\..\\HyperparameterAnimator.svelte",
    "..\\..\\..\\Hyperparameterview.svelte",
    "..\\..\\..\\PoolAnimator.svelte",
    "..\\..\\..\\Poolview.svelte",
    "..\\..\\..\\Softmaxview.svelte",
    "..\\..\\..\\Modal.svelte",
    "..\\..\\..\\Overview.svelte",
    "..\\..\\..\\Explainer.svelte",
    "..\\..\\..\\Graph1_Animator.svelte",
    "..\\..\\..\\Graph1_view.svelte",
    "..\\..\\..\\Knn.svelte",
    "..\\..\\..\\Tree.svelte",
    "..\\..\\..\\home.svelte",
    "..\\..\\..\\home2.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n  import Router from \"svelte-spa-router\";\r\n  import { link } from \"svelte-spa-router\";\r\n  import { routes } from \"./route\";\r\n</script>\r\n\r\n<style>\r\n  #app-page {\r\n    height: 100%;\r\n  }\r\n  #app-page .content {\r\n    padding-top: 90px;\r\n    height: 100%;\r\n    font-family: 'Open Sans', Helvetica, Arial, sans-serif;\r\n  }\r\n  #app-page .page_header {\r\n    position: fixed;\r\n    height: 62px;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    padding: 0 5vw;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    background: white;\r\n    z-index: 100;\r\n    box-shadow: 0 -0.4rem 0.9rem 0.2rem rgba(0, 0, 0, 0.5);\r\n    background-color: #37474f;\r\n  }\r\n  #app-page .page_header a {\r\n    text-decoration: none;\r\n    cursor: pointer;\r\n    color: #f6f6f6;\r\n    font-size: 15px;\r\n    font-weight: 500;\r\n  }\r\n  .menu_ul {\r\n    width: 300px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n  }\r\n</style>\r\n\r\n<div id=\"app-page\">\r\n  <div class=\"page_header\">\r\n    <a href=\"/\" use:link rel=\"prefetch\" style=\"font-size: 50px;\">UnboxAI</a>\r\n    \r\n    <!-- <ul class=\"menu_ul\">\r\n      <li>\r\n        <a target=\"_blank\" href=\"/dt/index.html\">决策树</a>\r\n      </li>\r\n      <li>\r\n        <a target=\"_blank\" href=\"/dist/indexnn.html\">神经网络</a>\r\n      </li>\r\n      <li>\r\n        <a target=\"_blank\" href=\"/\">KNN</a>\r\n      </li>\r\n      <li>\r\n        <a href=\"/cnn\" use:link rel=\"prefetch\">卷积神经网络</a>\r\n      </li>\r\n    </ul> -->\r\n  </div>\r\n\r\n  <div class=\"content\">\r\n    <Router {routes} />\r\n  </div>\r\n</div>\r\n\r\n",
    "<script>\r\n\r\n</script>\r\n\r\n<style>\r\n\t#description {\r\n    margin-bottom: 60px;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    max-width: 78ch;\r\n  }\r\n\r\n  #description h2 {\r\n    color: #444;\r\n    font-size: 40px;\r\n    font-weight: 450;\r\n    margin-bottom: 12px;\r\n    margin-top: 60px;\r\n  }\r\n\r\n  #description h4 {\r\n    font-style: italic;\r\n    color: steelblue;\r\n    font-size: 20px;\r\n    font-weight: 450;\r\n    margin-bottom: 8px;\r\n    margin-top: 44px;\r\n  }\r\n\r\n  #description h3 {\r\n    font-style: italic;\r\n    color: steelblue;\r\n    font-size: 24px;\r\n    font-weight: 450;\r\n    margin-bottom: 8px;\r\n    margin-top: 44px;\r\n  }\r\n\r\n  #description p {\r\n    margin: 16px 0;\r\n  }\r\n\r\n  #description p img {\r\n    vertical-align: middle;\r\n  }\r\n\r\n  #description .figure-caption {\r\n    font-size: 13px;\r\n    margin-top: 5px;\r\n  }\r\n\r\n  #description ol {\r\n    margin-left: 40px;\r\n  }\r\n\r\n  #description p, \r\n  #description div,\r\n  #description li {\r\n    color: #555;\r\n    font-size: 17px;\r\n    line-height: 1.6;\r\n  }\r\n\r\n  #description small {\r\n    font-size: 12px;\r\n  }\r\n\r\n  #description ol li img {\r\n    vertical-align: middle;\r\n  }\r\n\r\n</style>\r\n\r\n\r\n<body>\r\n  <div id=\"description\">\r\n    <div id=\"One\"><h2><strong>Section: 卷积神经网络</strong></h2></div>\r\n    <p>\r\n        <strong>\r\n            几天之后一个周末，你的同学来你家里玩。听说你实现了一个能够自动识别鸢尾花品种的识别程序，他十分感兴趣，于是在手机中找出了一张之前在郊外拍摄到的一张鸢尾花照片，问你的软件能不能识别照片中的鸢尾花\r\n            品种。这就让你犯了难了，之前你都是通过实地测量出鸢尾花的花瓣花萼的长宽等特征来输入网络中进行分类，而现在仅仅只有一张照片，从照片中测量得到的长宽也一定与实际相差甚远，如何通过图像来识别鸢尾花\r\n            的品种，这又让你找到了一个新的挑战。\r\n        </strong>\r\n    </p>\r\n      <p>\r\n        <strong>\r\n            经过网络上的一番资料查阅，你发现当今的人工智能技术已经能够识别图像中物体的种类，而这些人工智能使用的技术是一个叫做卷积神经网络的网络结构。于是你决定尝试一下使用卷积神经网络来对图片中的鸢尾花进行分类。\r\n        </strong>\r\n    </p>\r\n    <h3>什么是卷积神经网络？</h3>\r\n    <p>\r\n\t\t在机器学习中，往往都是从输入的特征中找到不同类别之间的区别从而进行分类。而与之前用测量的鸢尾花数据作为输入不同，这次我们的输入是一张图片。这时候，使用一个 <em>卷积神经网络</em>，或简称为CNN，是一种非常适合解决这种问题类型的分类器！\r\n\t </p>\r\n  \t<p>\r\n  \t\t与之前的神经网络相似，CNN也是从输入中找到具有代表性的特征，从而能够区分不同的图片类型，只不过它的网络会更加复杂一些，也多了一些特殊的层，总的来说它有以下几种关键构造：\r\n  \t</p>\r\n  \t<ol>\r\n  \t\t<li><strong>输入：</strong> 之前网络的输入往往是一组代表不同特征的数字，而在计算机中我们往往使用一个m×n的矩阵来代表一张图片，在CNN中便是已这个矩阵作为输入。</li>\r\n  \t\t<li><strong>神经元：</strong> 与普通的神经网络相似，每个神经元都代表了前一层的输出通过一次函数计算得到的一个新的代表隐含的特征的值。</li>\r\n  \t\t<li><strong>层：</strong> 每次使用相同的操作处理一组神经元，得到一组新的神经元的这个操作阶段叫做一层。</li>\r\n  \t\t<li><strong>内核权重和偏差：</strong>如图神经网络一样，在CNN中也是通过将输入与内核权重及偏差做函数计算来得到新的输出。</li>\r\n  \t</ol> \r\n \r\n      <h3>CNN中不同层的作用</h3>\r\n      <h4 id='article-input'> 输入层</h4>\r\n      <p>\r\n      输入层（最左边的层）代表输入到CNN中的图像。因为我们使用RGB图像作为输入，所以输入层具有三个通道，分别对应于该层中显示的红色，绿色和蓝色通道。\r\n      </p>\r\n      <h4 id='article-convolution'> 卷积层</h4>\r\n      <p>\r\n      卷积层是CNN的基础，因为它们包含可学习的内核（权重），这些内核提取出可将不同图像彼此区分开的特征-这就是我们想要的分类\r\n      </p>\r\n      <p>\r\n        如图1所示卷积过程是将内核中的参数与输入中对应大小的参数一一对应进行相乘再求和后得到一个对应该输入位置的结果，通过滑动改变内核相对应的位置，来得到右侧的输出。\r\n      </p>\r\n    <div class=\"figure\">\r\n      <img src=\"PUBLIC_URL/assets/figures/convolution.gif\" alt=\"clicking on topmost first conv. layer activation map\" />\r\n      <div class=\"figure-caption\">\r\n        图1:卷积层的计算过程。一个3×3的卷积核，通过在左侧滑动位置，逐个计算出对应位置的结果，最终得到右侧的输出。\r\n      </div>\r\n    </div>\r\n\r\n    <h4 id='article-pooling'>池化层</h4>\r\n    <p>\r\n      在不同的CNN架构中，池化层的类型很多，但是它们的目的都是要逐渐减小网络的空间范围，从而减少网络的参数和总体计算。\r\n    </p>\r\n    <p>\r\n      最大池操作需要在体系结构设计期间选择内核大小和步幅长度。选择后，该操作将以指定的步幅在输入上滑动内核，同时仅从输入中选择每个内核切片上的最大值以产生输出值。\r\n    </p>\r\n \r\n    <h4 id='article-softmax'>Softmax函数</h4>\r\n    <p>\r\n      softmax操作的主要作用是：确保CNN输出总和为1。因此，softmax操作可用于将模型输出缩放为概率。\r\n    </p>\r\n\r\n    <h4 id='try'>尝试一下</h4>\r\n    <p>\r\n      通过学习卷积网络的基本概念，你了解到CNN通过卷积层从图像中提取出局部特征，从而能够让网络学会“看”图。比起之前使用的网络需要提供人工选定的特征，CNN只需要输入一张图片，这无疑减少了许多的前期准备的工作量。\r\n    </p>\r\n    <p>\r\n      CNN的优势及其它的独特之处使你对它的原理构造更加的感兴趣了。经过一番努力之后，你终于实现了一个简单的CNN来用于分类鸢尾花的种类。而现在有三个不同品种的鸢尾花图像测试样本，来看看CNN是如何分辨出它是哪一个品种的鸢尾花的吧！\r\n    </p>\r\n  </div>\r\n</body>",
    "<script>\r\n\r\n</script>\r\n\r\n<style>\r\n\t#description {\r\n    margin-bottom: 60px;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    max-width: 78ch;\r\n  }\r\n\r\n  #description h2 {\r\n    color: #444;\r\n    font-size: 40px;\r\n    font-weight: 450;\r\n    margin-bottom: 12px;\r\n    margin-top: 60px;\r\n  }\r\n\r\n  #description h4 {\r\n    font-style: italic;\r\n    color: steelblue;\r\n    font-size: 20px;\r\n    font-weight: 450;\r\n    margin-bottom: 8px;\r\n    margin-top: 44px;\r\n  }\r\n\r\n  #description h3 {\r\n    font-style: italic;\r\n    color: steelblue;\r\n    font-size: 24px;\r\n    font-weight: 450;\r\n    margin-bottom: 8px;\r\n    margin-top: 44px;\r\n  }\r\n\r\n  #description p {\r\n    margin: 16px 0;\r\n  }\r\n\r\n  #description p img {\r\n    vertical-align: middle;\r\n  }\r\n\r\n  #description .figure-caption {\r\n    font-size: 13px;\r\n    margin-top: 5px;\r\n  }\r\n\r\n  #description ol {\r\n    margin-left: 40px;\r\n  }\r\n\r\n  #description p, \r\n  #description div,\r\n  #description li {\r\n    color: #555;\r\n    font-size: 17px;\r\n    line-height: 1.6;\r\n  }\r\n\r\n  #description small {\r\n    font-size: 12px;\r\n  }\r\n\r\n  #description ol li img {\r\n    vertical-align: middle;\r\n  }\r\n\r\n</style>\r\n\r\n\r\n<body>\r\n  <div id=\"description\">\r\n    <div id=\"One\"><h2><strong>Section: 卷积神经网络</strong></h2></div>\r\n    <p>\r\n        <strong>\r\n            几天之后一个周末，你的同学来你家里玩。听说你实现了一个能够自动识别鸢尾花品种的识别程序，他十分感兴趣，于是在手机中找出了一张之前在郊外拍摄到的一张鸢尾花照片，问你的软件能不能识别照片中的鸢尾花\r\n            品种。这就让你犯了难了，之前你都是通过实地测量出鸢尾花的花瓣花萼的长宽等特征来输入网络中进行分类，而现在仅仅只有一张照片，从照片中测量得到的长宽也一定与实际相差甚远，如何通过图像来识别鸢尾花\r\n            的品种，这又让你找到了一个新的挑战。\r\n        </strong>\r\n    </p>\r\n      <p>\r\n        <strong>\r\n            经过网络上的一番资料查阅，你发现当今的人工智能技术已经能够识别图像中物体的种类，而这些人工智能使用的技术是一个叫做卷积神经网络的网络结构。于是你决定尝试一下使用卷积神经网络来对图片中的鸢尾花进行分类。\r\n        </strong>\r\n    </p>\r\n    <h3>什么是卷积神经网络？</h3>\r\n    <p>\r\n\t\t在机器学习中，往往都是从输入的特征中找到不同类别之间的区别从而进行分类。而与之前用测量的鸢尾花数据作为输入不同，这次我们的输入是一张图片。这时候，使用一个 <em>卷积神经网络</em>，或简称为CNN，是一种非常适合解决这种问题类型的分类器！\r\n\t </p>\r\n  \t<p>\r\n  \t\t与之前的神经网络相似，CNN也是从输入中找到具有代表性的特征，从而能够区分不同的图片类型，只不过它的网络会更加复杂一些，也多了一些特殊的层，总的来说它有以下几种关键构造：\r\n  \t</p>\r\n  \t<ol>\r\n  \t\t<li><strong>输入：</strong> 之前网络的输入往往是一组代表不同特征的数字，而在计算机中我们往往使用一个m×n的矩阵来代表一张图片，在CNN中便是已这个矩阵作为输入。</li>\r\n  \t\t<li><strong>神经元：</strong> 与普通的神经网络相似，每个神经元都代表了前一层的输出通过一次函数计算得到的一个新的代表隐含的特征的值。</li>\r\n  \t\t<li><strong>层：</strong> 每次使用相同的操作处理一组神经元，得到一组新的神经元的这个操作阶段叫做一层。</li>\r\n  \t\t<li><strong>内核权重和偏差：</strong>如图神经网络一样，在CNN中也是通过将输入与内核权重及偏差做函数计算来得到新的输出。</li>\r\n  \t</ol> \r\n \r\n      <h3>CNN中不同层的作用</h3>\r\n      <h4 id='article-input'> 输入层</h4>\r\n      <p>\r\n      输入层（最左边的层）代表输入到CNN中的图像。因为我们使用RGB图像作为输入，所以输入层具有三个通道，分别对应于该层中显示的红色，绿色和蓝色通道。\r\n      </p>\r\n      <h4 id='article-convolution'> 卷积层</h4>\r\n      <p>\r\n      卷积层是CNN的基础，因为它们包含可学习的内核（权重），这些内核提取出可将不同图像彼此区分开的特征-这就是我们想要的分类\r\n      </p>\r\n      <p>\r\n        如图1所示卷积过程是将内核中的参数与输入中对应大小的参数一一对应进行相乘再求和后得到一个对应该输入位置的结果，通过滑动改变内核相对应的位置，来得到右侧的输出。\r\n      </p>\r\n    <div class=\"figure\">\r\n      <img src=\"PUBLIC_URL/assets/figures/convolution.gif\" alt=\"clicking on topmost first conv. layer activation map\" />\r\n      <div class=\"figure-caption\">\r\n        图1:卷积层的计算过程。一个3×3的卷积核，通过在左侧滑动位置，逐个计算出对应位置的结果，最终得到右侧的输出。\r\n      </div>\r\n    </div>\r\n\r\n    <h4 id='article-pooling'>池化层</h4>\r\n    <p>\r\n      在不同的CNN架构中，池化层的类型很多，但是它们的目的都是要逐渐减小网络的空间范围，从而减少网络的参数和总体计算。\r\n    </p>\r\n    <p>\r\n      最大池操作需要在体系结构设计期间选择内核大小和步幅长度。选择后，该操作将以指定的步幅在输入上滑动内核，同时仅从输入中选择每个内核切片上的最大值以产生输出值。\r\n    </p>\r\n \r\n    <h4 id='article-softmax'>Softmax函数</h4>\r\n    <p>\r\n      softmax操作的主要作用是：确保CNN输出总和为1。因此，softmax操作可用于将模型输出缩放为概率。\r\n    </p>\r\n\r\n    <h4 id='try'>尝试一下</h4>\r\n    <p>\r\n      通过学习卷积网络的基本概念，你了解到CNN通过卷积层从图像中提取出局部特征，从而能够让网络学会“看”图。比起之前使用的网络需要提供人工选定的特征，CNN只需要输入一张图片，这无疑减少了许多的前期准备的工作量。\r\n    </p>\r\n    <p>\r\n      CNN的优势及其它的独特之处使你对它的原理构造更加的感兴趣了。经过一番努力之后，你终于实现了一个简单的CNN来用于分类鸢尾花的种类。而现在有三个不同品种的鸢尾花图像测试样本，来看看CNN是如何分辨出它是哪一个品种的鸢尾花的吧！\r\n    </p>\r\n  </div>\r\n</body>",
    "<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  import { array1d, getMatrixSliceFromOutputHighlights,\r\n    getVisualizationSizeConstraint, getMatrixSliceFromInputHighlights, gridData\r\n  } from './DetailviewUtils.js';\r\n  import Dataview from './Dataview.svelte';\r\n\r\n  export let image;\r\n  export let output;\r\n  export let isPaused;\r\n  export let dataRange;\r\n\r\n  const dispatch = createEventDispatcher();\r\n  const padding = 0;\r\n  let padded_input_size = image.length + padding * 2;\r\n  $: padded_input_size = image.length + padding * 2;\r\n\r\n  let gridInputMatrixSlice = gridData([[0]]);\r\n  let gridOutputMatrixSlice = gridData([[0]]);\r\n  let inputHighlights = array1d(image.length * image.length, (i) => true);\r\n  let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n  let interval;\r\n  $ : {\r\n    let inputHighlights = array1d(image.length * image.length, (i) => true);\r\n    let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n    let interval;\r\n  }\r\n\r\n  let counter;\r\n\r\n  // lots of replication between mouseover and start-relu. TODO: fix this.\r\n  function startRelu() {\r\n    counter = 0;\r\n    if (interval) clearInterval(interval);\r\n    interval = setInterval(() => {\r\n      if (isPaused) return;\r\n      const flat_animated = counter % (output.length * output.length);\r\n      outputHighlights = array1d(output.length * output.length, (i) => false);\r\n      inputHighlights = array1d(image.length * image.length, (i) => undefined);\r\n      const animatedH = Math.floor(flat_animated / output.length);\r\n      const animatedW = flat_animated % output.length;\r\n      outputHighlights[animatedH * output.length + animatedW] = true;\r\n      inputHighlights[animatedH * output.length + animatedW] = true;\r\n      const inputMatrixSlice = getMatrixSliceFromInputHighlights(image, inputHighlights, 1);\r\n      gridInputMatrixSlice = gridData(inputMatrixSlice);\r\n      const outputMatrixSlice = getMatrixSliceFromOutputHighlights(output, outputHighlights);\r\n      gridOutputMatrixSlice = gridData(outputMatrixSlice);\r\n      counter++;\r\n    }, 250)\r\n  }\r\n\r\n  function handleMouseover(event) {\r\n    outputHighlights = array1d(output.length * output.length, (i) => false);\r\n    const animatedH = event.detail.hoverH;\r\n    const animatedW = event.detail.hoverW;\r\n    outputHighlights[animatedH * output.length + animatedW] = true;\r\n    inputHighlights = array1d(image.length * image.length, (i) => undefined);\r\n    inputHighlights[animatedH * output.length + animatedW] = true;\r\n    const inputMatrixSlice = getMatrixSliceFromInputHighlights(image, inputHighlights, 1);\r\n    gridInputMatrixSlice = gridData(inputMatrixSlice);\r\n    const outputMatrixSlice = getMatrixSliceFromOutputHighlights(output, outputHighlights);\r\n    gridOutputMatrixSlice = gridData(outputMatrixSlice);\r\n    isPaused = true;\r\n    dispatch('message', {\r\n      text: isPaused\r\n    });\r\n  }\r\n\r\n  startRelu();\r\n  let gridImage = gridData(image)\r\n  let gridOutput = gridData(output)\r\n  $ : {\r\n    startRelu();\r\n    gridImage = gridData(image)\r\n    gridOutput = gridData(output)\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .column {\r\n    padding: 5px;\r\n  }\r\n</style>\r\n\r\n<div class=\"column has-text-centered\">\r\n  <div class=\"header-text\">\r\n    Input ({image.length}, {image[0].length})\r\n  </div>\r\n  <Dataview on:message={handleMouseover} data={gridImage} highlights={inputHighlights} outputLength={output.length}\r\n      isKernelMath={false} constraint={getVisualizationSizeConstraint(image.length)} dataRange={dataRange} stride={1}/>  \r\n</div>\r\n<div class=\"column has-text-centered\">\r\n  <span>\r\n    max(\r\n    <Dataview data={gridData([[0]])} highlights={outputHighlights} isKernelMath={true} \r\n    constraint={20} dataRange={dataRange}/>\r\n    ,\r\n    <Dataview data={gridInputMatrixSlice} highlights={outputHighlights} isKernelMath={true} \r\n    constraint={20} dataRange={dataRange}/>\r\n    )\r\n    =\r\n    <Dataview data={gridOutputMatrixSlice} highlights={outputHighlights} isKernelMath={true} \r\n      constraint={20} dataRange={dataRange}/>\r\n  </span> \r\n</div>\r\n<div class=\"column has-text-centered\">\r\n  <div class=\"header-text\">\r\n    Output ({output.length}, {output[0].length})\r\n  </div>\r\n  <Dataview on:message={handleMouseover} data={gridOutput} highlights={outputHighlights} isKernelMath={false} \r\n      outputLength={output.length} constraint={getVisualizationSizeConstraint(output.length)} dataRange={dataRange} stride={1}/>\r\n</div>",
    "<script>\r\n\timport ActivationAnimator from './ActivationAnimator.svelte';\r\n  import { createEventDispatcher } from 'svelte';\r\n\r\n  export let input;\r\n  export let output;\r\n  export let dataRange;\r\n  export let isExited;\r\n\r\n  const dispatch = createEventDispatcher();\r\n  let isPaused = false;\r\n  \r\n  function handleClickPause() {\r\n    isPaused = !isPaused;\r\n  }\r\n\r\n  function handlePauseFromInteraction(event) {\r\n    isPaused = event.detail.text;\r\n  }\r\n\r\n  function handleClickX() {\r\n    dispatch('message', {\r\n      text: true\r\n    });\r\n  }\r\n\r\n  function handleScroll() {\r\n    let svgHeight = Number(d3.select('#cnn-svg').style('height').replace('px', '')) + 150;\r\n    let scroll = new SmoothScroll('a[href*=\"#\"]', {offset: -svgHeight});\r\n    let anchor = document.querySelector(`#article-relu`);\r\n    scroll.animateScroll(anchor);\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .control-pannel {\r\n    display: flex;\r\n    position: relative;\r\n    flex-direction: column;\r\n    align-items: center;\r\n  }\r\n\r\n  .buttons {\r\n    cursor: pointer;\r\n    position: absolute;\r\n    top: 0px;\r\n    right: 0px;\r\n  }\r\n\r\n  .control-button {\r\n    color: gray;\r\n    font-size: 15px;\r\n    opacity: 0.4;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .control-button:not(:first-child) {\r\n    margin-left: 5px;\r\n  }\r\n\r\n  .annotation {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-left : 10px;\r\n    font-size: 12px;\r\n  }\r\n\r\n  .annotation > img {\r\n    width: 17px;\r\n    margin-right: 5px;\r\n  }\r\n\r\n  .control-button:hover {\r\n    opacity: 0.8;\r\n  }\r\n\r\n  .box {\r\n    padding: 5px 15px 10px 15px;\r\n  }\r\n\r\n  .container {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n\r\n  .title-text {\r\n    font-size: 1.2em;\r\n    font-weight: 500;\r\n    color: #4a4a4a;\r\n  }\r\n</style>\r\n\r\n{#if !isExited}\r\n  <div class=\"container\">\r\n    <div class=\"box\">\r\n\r\n      <div class=\"control-pannel\">\r\n\r\n        <div class=\"title-text\">\r\n          ReLU Activation\r\n        </div>\r\n\r\n        <div class=\"buttons\">\r\n\r\n          <div class=\"control-button\" on:click={handleScroll} title=\"Jump to article section\">\r\n            <i class=\"fas fa-info-circle\"></i>\r\n          </div>\r\n\r\n          <div class=\"play-button control-button\" on:click={handleClickPause} title=\"Play animation\">\r\n            {@html isPaused ?\r\n              '<i class=\"fas fa-play-circle play-icon\"></i>' :\r\n              '<i class=\"fas fa-pause-circle\"></i>'}\r\n          </div>\r\n\r\n          <div class=\"delete-button control-button\" on:click={handleClickX} title=\"Close\">\r\n              <i class=\"fas control-icon fa-times-circle\"></i>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div class=\"container is-centered is-vcentered\">\r\n        <ActivationAnimator on:message={handlePauseFromInteraction} \r\n          image={input} output={output} isPaused={isPaused}\r\n          dataRange={dataRange}/>\r\n      </div>\r\n\r\n      <div class=\"annotation\">\r\n        <img src='PUBLIC_URL/assets/img/pointer.svg' alt='pointer icon'>\r\n        <div class=\"annotation-text\">\r\n          <span style=\"font-weight:600\">Hover over</span> the matrices to change pixel.\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n{/if}",
    "<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  import { array1d, getMatrixSliceFromOutputHighlights,\r\n    compute_input_multiplies_with_weight, getDataRange,\r\n    getVisualizationSizeConstraint, generateOutputMappings,\r\n    getMatrixSliceFromInputHighlights, gridData\r\n  } from './DetailviewUtils.js';\r\n  import Dataview from './Dataview.svelte';\r\n  import KernelMathView from './KernelMathView.svelte';\r\n  // image: nxn array -- prepadded.\r\n  // kernel: mxm array.\r\n  // stride: int\r\n  export let stride;\r\n  export let dilation\r\n  export let kernel;\r\n  export let image;\r\n  export let output;\r\n  export let isPaused;\r\n  export let dataRange;\r\n  export let colorScale;\r\n  export let isInputInputLayer = false;\r\n\r\n  const dispatch = createEventDispatcher();\r\n  const padding = 0;\r\n  let padded_input_size = image.length + padding * 2;\r\n  $: padded_input_size = image.length + padding * 2;\r\n\r\n  // Dummy data for original state of component.\r\n  let testInputMatrixSlice = [];\r\n  for (let i = 0; i < kernel.length; i++) {\r\n    testInputMatrixSlice.push([]);\r\n    for (let j = 0; j < kernel.length; j++) {\r\n      testInputMatrixSlice[i].push(0)\r\n    }\r\n  }\r\n  testInputMatrixSlice = gridData(testInputMatrixSlice)\r\n  let testOutputMatrixSlice = gridData([0]);\r\n\r\n  let inputHighlights = [];\r\n  let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n  let interval;\r\n  $ : {\r\n    let inputHighlights = [];\r\n    let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n    let interval;\r\n  }\r\n\r\n  let counter;\r\n  // lots of replication between mouseover and start-conv. TODO: fix this.\r\n  function startConvolution(stride) {\r\n    counter = 0;\r\n    let outputMappings = generateOutputMappings(stride, output, kernel.length, padded_input_size, dilation);\r\n    if (stride <= 0) return;\r\n    if (interval) clearInterval(interval);\r\n    interval = setInterval(() => {\r\n      if (isPaused) return;\r\n      const flat_animated = counter % (output.length * output.length);\r\n      outputHighlights = array1d(output.length * output.length, (i) => false);\r\n      const animatedH = Math.floor(flat_animated / output.length);\r\n      const animatedW = flat_animated % output.length;\r\n      outputHighlights[animatedH * output.length + animatedW] = true;\r\n      inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, padded_input_size, kernel.length, outputMappings, kernel.length)\r\n      const inputMatrixSlice = getMatrixSliceFromInputHighlights(image, inputHighlights, kernel.length);\r\n      testInputMatrixSlice = gridData(inputMatrixSlice);\r\n      const outputMatrixSlice = getMatrixSliceFromOutputHighlights(output, outputHighlights);\r\n      testOutputMatrixSlice = gridData(outputMatrixSlice);\r\n      counter++;\r\n    }, 250)\r\n  }\r\n\r\n  function handleMouseover(event) {\r\n    let outputMappings = generateOutputMappings(stride, output, kernel.length, padded_input_size, dilation);\r\n    outputHighlights = array1d(output.length * output.length, (i) => false);\r\n    const animatedH = event.detail.hoverH;\r\n    const animatedW = event.detail.hoverW;\r\n    outputHighlights[animatedH * output.length + animatedW] = true;\r\n    inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, padded_input_size, kernel.length, outputMappings, kernel.length)\r\n    const inputMatrixSlice = getMatrixSliceFromInputHighlights(image, inputHighlights, kernel.length);\r\n    testInputMatrixSlice = gridData(inputMatrixSlice);\r\n    const outputMatrixSlice = getMatrixSliceFromOutputHighlights(output, outputHighlights);\r\n    testOutputMatrixSlice = gridData(outputMatrixSlice);\r\n    isPaused = true;\r\n    dispatch('message', {\r\n      text: isPaused\r\n    });\r\n  }\r\n\r\n  startConvolution(stride);\r\n  let testImage = gridData(image)\r\n  let testOutput = gridData(output)\r\n  let testKernel = gridData(kernel)\r\n  $ : {\r\n    startConvolution(stride);\r\n    testImage = gridData(image)\r\n    testOutput = gridData(output)\r\n    testKernel = gridData(kernel)\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .column {\r\n    padding: 5px;\r\n  }\r\n</style>\r\n\r\n<div class=\"column has-text-centered\">\r\n  <div class=\"header-text\">\r\n    输入 ({image.length}, {image[0].length})\r\n  </div>\r\n  <Dataview on:message={handleMouseover} data={testImage} highlights={inputHighlights} outputLength={output.length}\r\n      isKernelMath={false} constraint={getVisualizationSizeConstraint(image.length)}\r\n      dataRange={dataRange} stride={stride} colorScale={colorScale}\r\n      isInputLayer={isInputInputLayer}/>\r\n</div>\r\n<div class=\"column has-text-centered\">\r\n  <KernelMathView data={testInputMatrixSlice} kernel={testKernel} constraint={getVisualizationSizeConstraint(kernel.length)}\r\n                  dataRange={dataRange} kernelRange={getDataRange(kernel)} colorScale={colorScale}\r\n                  isInputLayer={isInputInputLayer}/>\r\n  <Dataview data={testOutputMatrixSlice} highlights={outputHighlights} isKernelMath={true} \r\n      constraint={getVisualizationSizeConstraint(kernel.length)} dataRange={dataRange}/>\r\n</div>\r\n<div class=\"column has-text-centered\">\r\n  <div class=\"header-text\">\r\n    输出 ({output.length}, {output[0].length})\r\n  </div>\r\n  <Dataview on:message={handleMouseover} data={testOutput} highlights={outputHighlights} isKernelMath={false}\r\n      outputLength={output.length} constraint={getVisualizationSizeConstraint(output.length)} dataRange={dataRange} stride={stride}/>\r\n</div>",
    "<script>\r\n\timport ConvolutionAnimator from './ConvolutionAnimator.svelte';\r\n  import { singleConv } from '../utils/cnn.js';\r\n  import { createEventDispatcher } from 'svelte';\r\n\r\n  export let input;\r\n  export let kernel;\r\n  export let dataRange;\r\n  export let colorScale = d3.interpolateRdBu;\r\n  export let isInputInputLayer = false;\r\n  export let isExited = false;\r\n  // export let output;\r\n  \r\n  const dispatch = createEventDispatcher();\r\n\tlet stride = 1;\r\n  const dilation = 1;\r\n  var isPaused = false;\r\n  var outputFinal = singleConv(input, kernel, stride);\r\n  $: if (stride > 0) {\r\n    try { \r\n      outputFinal = singleConv(input, kernel, stride);\r\n    } catch {\r\n      console.log(\"Cannot handle stride of \" + stride);\r\n    }\r\n  }\r\n  \r\n  function handleClickPause() {\r\n    isPaused = !isPaused;\r\n  }\r\n\r\n  function handleScroll() {\r\n    let svgHeight = Number(d3.select('#cnn-svg').style('height').replace('px', '')) + 150;\r\n    let scroll = new SmoothScroll('a[href*=\"#\"]', {offset: -svgHeight});\r\n    let anchor = document.querySelector(`#article-convolution`);\r\n    scroll.animateScroll(anchor);\r\n  }\r\n\r\n  function handlePauseFromInteraction(event) {\r\n    isPaused = event.detail.text;\r\n  }\r\n\r\n  function handleClickX() {\r\n    isExited = true;\r\n    dispatch('message', {\r\n      text: isExited\r\n    });\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .control-pannel {\r\n    display: flex;\r\n    position: relative;\r\n    flex-direction: column;\r\n    align-items: center;\r\n  }\r\n\r\n  .buttons {\r\n    cursor: pointer;\r\n    position: absolute;\r\n    top: 0px;\r\n    right: 0px;\r\n  }\r\n\r\n  .control-button {\r\n    color: gray;\r\n    font-size: 15px;\r\n    opacity: 0.4;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .control-button:not(:first-child) {\r\n    margin-left: 5px;\r\n  }\r\n\r\n  .annotation {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-left : 10px;\r\n    font-size: 12px;\r\n  }\r\n\r\n  .annotation > img {\r\n    width: 17px;\r\n    margin-right: 5px;\r\n  }\r\n\r\n  .control-button:hover {\r\n    opacity: 0.8;\r\n  }\r\n\r\n  .box {\r\n    padding: 5px 15px 10px 15px;\r\n  }\r\n\r\n  .container {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: flex-end;\r\n  }\r\n\r\n  .title-text {\r\n    font-size: 1.2em;\r\n    font-weight: 500;\r\n    color: #4a4a4a;\r\n  }\r\n</style>\r\n\r\n{#if !isExited}\r\n  <div class=\"container\" id=\"detailview-container\">\r\n\r\n    <!-- old stride input -->\r\n    <!-- <div class=\"columns is-mobile\">\r\n      <div class=\"column is-half is-offset-one-quarter\">\r\n        <div class=\"field is-grouped\">\r\n          <p class=\"control is-expanded\">\r\n            <input class=\"input\" type=\"text\" placeholder=\"Stride\" bind:value={stride} />\r\n          </p>\r\n          <p class=\"control\">\r\n            <button class=\"button is-success\" on:click={handleClickPause}>\r\n              Toggle Movement\r\n            </button>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div> -->\r\n\r\n    <div class=\"box\">\r\n\r\n      <div class=\"control-pannel\">\r\n\r\n        <div class=\"title-text\">\r\n          卷积过程\r\n        </div>\r\n\r\n        <div class=\"buttons\">\r\n          <div class=\"control-button\" on:click={handleScroll} title=\"Jump to article section\">\r\n            <i class=\"fas fa-info-circle\"></i>\r\n          </div>\r\n\r\n          <div class=\"play-button control-button\" on:click={handleClickPause} title=\"Play animation\">\r\n            {@html isPaused ?\r\n              '<i class=\"fas fa-play-circle play-icon\"></i>' :\r\n              '<i class=\"fas fa-pause-circle\"></i>'}\r\n          </div>\r\n\r\n          <div class=\"delete-button control-button\" on:click={handleClickX} title=\"Close\">\r\n            <i class=\"fas control-icon fa-times-circle\"></i>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"container is-centered\">\r\n        <ConvolutionAnimator on:message={handlePauseFromInteraction} \r\n          kernel={kernel} image={input} output={outputFinal} \r\n          stride={stride} dilation={dilation} isPaused={isPaused}\r\n          dataRange={dataRange} colorScale={colorScale}\r\n          isInputInputLayer={isInputInputLayer} />\r\n      </div>\r\n\r\n      <div class=\"annotation\">\r\n        <img src='PUBLIC_URL/assets/img/pointer.svg' alt='pointer icon'>\r\n        <div class=\"annotation-text\">\r\n          <span style=\"font-weight:600\">悬停鼠标</span> 在矩阵中来查看对应位置的计算过程.\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n{/if}",
    "<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  import { array1d, compute_input_multiplies_with_weight,\r\n          generateOutputMappings, gridData\r\n  } from './DetailviewUtils.js';\r\n  import HyperparameterDataview from './HyperparameterDataview.svelte';\r\n  import KernelMathView from './KernelMathView.svelte';\r\n  // image: nxn array -- prepadded.\r\n  // kernel: mxm array.\r\n  // stride: int\r\n  export let stride;\r\n  export let dilation\r\n  export let kernel;\r\n  export let image;\r\n  export let output;\r\n  export let isPaused;\r\n  export let padding;\r\n  export let isStrideValid;\r\n\r\n  const dispatch = createEventDispatcher();\r\n\r\n  let inputHighlights = [];\r\n  let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n  let interval;\r\n  $ : {\r\n    let inputHighlights = [];\r\n    let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n    let interval;\r\n  }\r\n\r\n  let counter;\r\n  // lots of replication between mouseover and start-conv. TODO: fix this.\r\n  function startConvolution(stride) {\r\n    counter = 0;\r\n    isPaused = false;\r\n    dispatch('message', {\r\n      text: isPaused\r\n    });\r\n    let outputMappings = generateOutputMappings(stride, output, kernel.length, image.length, dilation);\r\n    if (stride <= 0) return;\r\n    if (interval) clearInterval(interval);\r\n    interval = setInterval(() => {\r\n      if (isPaused || !isStrideValid) return;\r\n      const flat_animated = counter % (output.length * output.length);\r\n      outputHighlights = array1d(output.length * output.length, (i) => false);\r\n      const animatedH = Math.floor(flat_animated / output.length);\r\n      const animatedW = flat_animated % output.length;\r\n      outputHighlights[animatedH * output.length + animatedW] = true;\r\n      inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, image.length, kernel.length, outputMappings, kernel.length)\r\n      counter++;\r\n    }, 1000)\r\n  }\r\n\r\n  function handleMouseover(event) {\r\n    let outputMappings = generateOutputMappings(stride, output, kernel.length, image.length, dilation);\r\n    outputHighlights = array1d(output.length * output.length, (i) => false);\r\n    const animatedH = event.detail.hoverH;\r\n    const animatedW = event.detail.hoverW;\r\n    outputHighlights[animatedH * output.length + animatedW] = true;\r\n    inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, image.length, kernel.length, outputMappings, kernel.length)\r\n    isPaused = true;\r\n    dispatch('message', {\r\n      text: isPaused\r\n    });\r\n  }\r\n\r\n  // Fix the total grid size to change hyperparameters without changing the grid\r\n  // size.  This must be two pixels smaller than the HyperparameterDataview svg\r\n  // size, so that the stroke on the right side of the grid does not get cut off.\r\n  const gridSize = 198;\r\n  startConvolution(stride);\r\n  let testImage = gridData(image, gridSize / image.length);\r\n  let testOutput = gridData(output, gridSize / output.length);\r\n  let testKernel = gridData(kernel, gridSize / kernel.length);\r\n  $ : {\r\n    startConvolution(stride);\r\n    testImage = gridData(image, gridSize / image.length);\r\n    testOutput = gridData(output, gridSize / output.length);\r\n    testKernel = gridData(kernel, gridSize / kernel.length);\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .wrapper {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: flex-end;\r\n  }\r\n\r\n  .column {\r\n    padding: 5px 10px 10px 10px;\r\n  }\r\n\r\n  .header-text {\r\n    line-height: 1.1;\r\n  }\r\n\r\n  .header-sub-text {\r\n    font-size: 13px;\r\n    color: #9a9a9a;\r\n    margin-bottom: 2px;\r\n  }\r\n</style>\r\n\r\n<div class=\"wrapper\">\r\n  <div class=\"column has-text-centered\">\r\n    <div class=\"header-text\">\r\n      Input ({image.length - 2 * padding}, {image.length - 2 * padding}) <br/>\r\n    </div>\r\n    <div class=\"header-sub-text\">\r\n      After-padding ({image.length}, {image.length})\r\n    </div>\r\n    <HyperparameterDataview on:message={handleMouseover} data={testImage} highlights={inputHighlights}\r\n        outputLength={output.length} stride={stride} padding={padding} isStrideValid={isStrideValid}/>\r\n  </div>\r\n  <div class=\"column has-text-centered\">\r\n    <div class=\"header-text\" style=\"padding-top: 27px;\">\r\n      Output ({output.length}, {output.length})\r\n    </div>\r\n    <div class=\"header-sub-text\">\r\n      &nbsp;\r\n    </div>\r\n    <HyperparameterDataview on:message={handleMouseover} data={testOutput} highlights={outputHighlights}\r\n        outputLength={output.length} stride={stride} padding={padding} isOutput={true} isStrideValid={isStrideValid}/>\r\n  </div>\r\n</div>",
    "<script>\r\n\timport HyperparameterAnimator from './HyperparameterAnimator.svelte';\r\n  import { singleConv } from '../utils/cnn.js';\r\n\r\n  let inputSize = 5;\r\n  let kernelSize = 2;\r\n  let padding = 0;\r\n  let stride = 1;\r\n  const dilation = 1;\r\n  let isPaused = false;\r\n  let isStrideValid = true;\r\n  $: inputSizeWithPadding = inputSize + 2 * padding;\r\n\r\n  function generateSquareArray(arrayDim) {\r\n    let arr = [];\r\n    for (let i = 0; i < arrayDim; i++) {\r\n      arr.push([]);\r\n      for (let j = 0; j < arrayDim; j++) {\r\n        arr[i].push(0)\r\n      }\r\n    }\r\n    return arr;\r\n  }\r\n\r\n  function handleClickPause() {\r\n    isPaused = !isPaused;\r\n  }\r\n\r\n  function handlePauseFromInteraction(event) {\r\n    isPaused = event.detail.text;\r\n  }\r\n\r\n  // Update input, kernel, and output as user adjusts hyperparameters.\r\n  let input = generateSquareArray(inputSize + padding * 2);\r\n  let kernel = generateSquareArray(kernelSize);\r\n  $: input = generateSquareArray(inputSize + padding * 2);\r\n  $: kernel = generateSquareArray(kernelSize);\r\n  let outputFinal = singleConv(input, kernel, stride);\r\n  $: if (stride > 0) {\r\n    const stepSize = (inputSizeWithPadding - kernelSize) / stride + 1;\r\n    let strideNumberInput = document.getElementById(\"strideNumber\");\r\n    if (Number.isInteger(stepSize)) {\r\n      outputFinal = singleConv(input, kernel, stride);\r\n      if (strideNumberInput != null) {\r\n        strideNumberInput.className = strideNumberInput.className.replace(\"is-danger\", \"\");\r\n      }\r\n      isStrideValid = true;\r\n    } else {\r\n      if (!strideNumberInput.className.includes(\"is-danger\")) {\r\n        strideNumberInput.className += \" is-danger\";\r\n      }\r\n      isStrideValid = false;\r\n      console.log(\"Cannot handle stride of \" + stride);\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .control-button {\r\n    position: absolute;\r\n    top: 5px;\r\n    right: 15px;\r\n    color: gray;\r\n    font-size: 22px;\r\n    opacity: 0.4;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .control-button:hover {\r\n    opacity: 0.8;\r\n  }\r\n\r\n  .box {\r\n    padding: 5px 30px 20px 30px;\r\n    position: relative;\r\n  }\r\n\r\n  .left-part {\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin-top: 30px;\r\n  }\r\n\r\n  .right-part {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .content-container {\r\n    display: flex;\r\n    justify-content: space-around;\r\n  }\r\n\r\n  .field {\r\n    padding-top: 5px;\r\n  }\r\n\r\n  .annotation {\r\n    display: flex;\r\n    align-items: center;\r\n    padding-left : 10px;\r\n  }\r\n\r\n  .annotation-text-hyper {\r\n    font-size: 15px;\r\n    font-style: italic;\r\n  }\r\n\r\n  .annotation > img {\r\n    width: 20px;\r\n    margin-right: 5px;\r\n  }\r\n\r\n  .is-very-small {\r\n    font-size: 12px; \r\n  }\r\n\r\n  .field {\r\n    align-items: center;\r\n  }\r\n\r\n  .field-label.is-normal {\r\n    padding-top: 0;\r\n  }\r\n\r\n  .field:not(:last-child) {\r\n    margin-bottom: 7px;\r\n  }\r\n\r\n  label {\r\n    display: inline-block;\r\n    width: 105px;\r\n    text-align: right;\r\n    font-weight: 500;\r\n    color: #4a4a4a;\r\n  } \r\n\r\n  input[type=number] {\r\n    width: 50px;\r\n  }\r\n\r\n  input[type=range] {\r\n    width: 160px;\r\n  }\r\n</style>\r\n\r\n<div class=\"container has-text-centered\" id=\"detailview-container\">\r\n  <div class=\"box\">\r\n\r\n      <div class=\"control-button\" on:click={handleClickPause}>\r\n        {@html isPaused ?\r\n          '<i class=\"fas fa-play-circle play-icon\"></i>' :\r\n          '<i class=\"fas fa-pause-circle\"></i>'}\r\n      </div>\r\n\r\n    <div class=\"content-container\">\r\n      <div class=\"left-part\">\r\n\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Input Size:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={inputSize}\r\n              min={kernelSize} max={7}>\r\n          </div>\r\n\r\n          <input type=\"range\" bind:value={inputSize}\r\n            min={kernelSize} max={7}>\r\n        </div>\r\n\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Padding:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={padding} min={0}\r\n              max={kernelSize - 1}>\r\n          </div>\r\n\r\n          <input type=\"range\" bind:value={padding} min={0}\r\n            max={kernelSize - 1}>\r\n        </div>\r\n\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Kernel Size:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={kernelSize} min={padding + 1}\r\n              max={inputSizeWithPadding}>\r\n          </div>\r\n\r\n          <input type=\"range\" bind:value={kernelSize} min={padding + 1}\r\n            max={inputSizeWithPadding}>\r\n        </div>\r\n\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Stride:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=number id=\"strideNumber\" bind:value={stride} min=1\r\n              max={Math.max(inputSizeWithPadding - kernelSize + 1, 2)}>\r\n          </div>\r\n\r\n          <input type=\"range\" bind:value={stride} min=1\r\n            max={Math.max(inputSizeWithPadding - kernelSize + 1, 2)}>\r\n        </div>\r\n      </div>\r\n\r\n        <div class=\"right-part\">\r\n          <HyperparameterAnimator on:message={handlePauseFromInteraction} \r\n            kernel={kernel} image={input} output={outputFinal} isStrideValid={isStrideValid}\r\n            stride={stride} dilation={dilation} padding={padding} isPaused={isPaused}/>\r\n\r\n          <div class=\"annotation\">\r\n            <img src='PUBLIC_URL/assets/img/pointer.svg' alt='pointer icon' width=\"25px\">\r\n            <div class=\"annotation-text-hyper\">\r\n              <span style=\"font-weight:600\">Hover over</span> the matrices to change kernel position.\r\n            </div>\r\n          </div>\r\n          \r\n        </div>\r\n\r\n    </div>\r\n\r\n\r\n  </div>\r\n</div>",
    "<script>\r\n  import { createEventDispatcher } from 'svelte';\r\n  import { array1d, getMatrixSliceFromOutputHighlights,\r\n    compute_input_multiplies_with_weight, getVisualizationSizeConstraint,\r\n    generateOutputMappings, getMatrixSliceFromInputHighlights, gridData\r\n  } from './DetailviewUtils.js';\r\n  import Dataview from './Dataview.svelte';\r\n\r\n  export let stride;\r\n  export let dilation\r\n  export let kernelLength;\r\n  export let image;\r\n  export let output;\r\n  export let isPaused;\r\n  export let dataRange;\r\n\r\n  const dispatch = createEventDispatcher();\r\n  const padding = 0;\r\n  let padded_input_size = image.length + padding * 2;\r\n  $: padded_input_size = image.length + padding * 2;\r\n\r\n  // Dummy data for original state of component.\r\n  let testInputMatrixSlice = [];\r\n  for (let i = 0; i < kernelLength; i++) {\r\n    testInputMatrixSlice.push([]);\r\n    for (let j = 0; j < kernelLength; j++) {\r\n      testInputMatrixSlice[i].push(0)\r\n    }\r\n  }\r\n  testInputMatrixSlice = gridData(testInputMatrixSlice)\r\n  let testOutputMatrixSlice = gridData([[0]]);\r\n\r\n  let inputHighlights = [];\r\n  let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n  let interval;\r\n  $ : {\r\n    let inputHighlights = [];\r\n    let outputHighlights = array1d(output.length * output.length, (i) => true);\r\n    let interval;\r\n  }\r\n  \r\n  let counter;\r\n\r\n  // lots of replication between mouseover and start-pool. TODO: fix this.\r\n  function startMaxPool(stride) {\r\n    counter = 0;\r\n    let outputMappings = generateOutputMappings(stride, output, kernelLength, padded_input_size, dilation);\r\n    if (stride <= 0) return;\r\n    if (interval) clearInterval(interval);\r\n    interval = setInterval(() => {\r\n      if (isPaused) return;\r\n      const flat_animated = counter % (output.length * output.length);\r\n      outputHighlights = array1d(output.length * output.length, (i) => false);\r\n      const animatedH = Math.floor(flat_animated / output.length);\r\n      const animatedW = flat_animated % output.length;\r\n      outputHighlights[animatedH * output.length + animatedW] = true;\r\n      inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, padded_input_size, kernelLength, outputMappings, kernelLength)\r\n      const inputMatrixSlice = getMatrixSliceFromInputHighlights(image, inputHighlights, kernelLength);\r\n      testInputMatrixSlice = gridData(inputMatrixSlice);\r\n      const outputMatrixSlice = getMatrixSliceFromOutputHighlights(output, outputHighlights);\r\n      testOutputMatrixSlice = gridData(outputMatrixSlice);\r\n      counter++;\r\n    }, 250)\r\n  }\r\n\r\n  function handleMouseover(event) {\r\n    let outputMappings = generateOutputMappings(stride, output, kernelLength, padded_input_size, dilation);\r\n    outputHighlights = array1d(output.length * output.length, (i) => false);\r\n    const animatedH = event.detail.hoverH;\r\n    const animatedW = event.detail.hoverW;\r\n    outputHighlights[animatedH * output.length + animatedW] = true;\r\n    inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, padded_input_size, kernelLength, outputMappings, kernelLength)\r\n    const inputMatrixSlice = getMatrixSliceFromInputHighlights(image, inputHighlights, kernelLength);\r\n    testInputMatrixSlice = gridData(inputMatrixSlice);\r\n    const outputMatrixSlice = getMatrixSliceFromOutputHighlights(output, outputHighlights);\r\n    testOutputMatrixSlice = gridData(outputMatrixSlice);\r\n    isPaused = true;\r\n    dispatch('message', {\r\n      text: isPaused\r\n    });\r\n  }\r\n\r\n  startMaxPool(stride);\r\n  let testImage = gridData(image)\r\n  let testOutput = gridData(output)\r\n  $ : {\r\n    startMaxPool(stride);\r\n    testImage = gridData(image)\r\n    testOutput = gridData(output)\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .column {\r\n    padding: 5px;\r\n  }\r\n</style>\r\n\r\n<div class=\"column has-text-centered\">\r\n  <div class=\"header-text\">\r\n    输入 ({testImage.length}, {testImage[0].length})\r\n  </div>\r\n\r\n  <Dataview on:message={handleMouseover} data={testImage} highlights={inputHighlights} outputLength={output.length}\r\n      isKernelMath={false} constraint={getVisualizationSizeConstraint(image.length)} dataRange={dataRange} stride={stride}/>  \r\n</div>\r\n<div class=\"column has-text-centered\">\r\n  <span>\r\n    max(\r\n    <Dataview data={testInputMatrixSlice} highlights={outputHighlights} isKernelMath={true} \r\n      constraint={getVisualizationSizeConstraint(kernelLength)} dataRange={dataRange}/>\r\n    )\r\n    =\r\n    <Dataview data={testOutputMatrixSlice} highlights={outputHighlights} isKernelMath={true} \r\n      constraint={getVisualizationSizeConstraint(kernelLength)} dataRange={dataRange}/>\r\n  </span> \r\n</div>\r\n<div class=\"column has-text-centered\">\r\n  <div class=\"header-text\">\r\n    输出 ({testOutput.length}, {testOutput[0].length})\r\n  </div>\r\n  <Dataview on:message={handleMouseover} data={testOutput} highlights={outputHighlights} isKernelMath={false} \r\n      outputLength={output.length} constraint={getVisualizationSizeConstraint(output.length)} dataRange={dataRange} stride={stride}/>\r\n</div>",
    "<script>\r\n\timport PoolAnimator from './PoolAnimator.svelte';\r\n  import { singleMaxPooling } from '../utils/cnn.js';\r\n  import { createEventDispatcher } from 'svelte';\r\n\r\n  export let input;\r\n  export let kernelLength;\r\n  export let dataRange;\r\n  export let isExited;\r\n  \r\n  const dispatch = createEventDispatcher();\r\n  // let isExited = false;\r\n\tlet stride = 2;\r\n  const dilation = 1;\r\n  var isPaused = false;\r\n  var outputFinal = singleMaxPooling(input);\r\n  // let dragging = false;\r\n  // let dragInfo = {x1: 0, x2: 0, y1: 0, y2: 0};\r\n  // let detailView = d3.select('#detailview').node();\r\n  $: if (stride > 0) {\r\n    try { \r\n      outputFinal = singleMaxPooling(input);\r\n    } catch {\r\n      console.log(\"Cannot handle stride of \" + stride);\r\n    }\r\n  }\r\n  \r\n  function handleClickPause() {\r\n    isPaused = !isPaused;\r\n    console.log(isPaused)\r\n  }\r\n\r\n  function handlePauseFromInteraction(event) {\r\n    isPaused = event.detail.text;\r\n  }\r\n\r\n  function handleClickX() {\r\n    dispatch('message', {\r\n      text: true\r\n    });\r\n  }\r\n\r\n  function handleScroll() {\r\n    let svgHeight = Number(d3.select('#cnn-svg').style('height').replace('px', '')) + 150;\r\n    let scroll = new SmoothScroll('a[href*=\"#\"]', {offset: -svgHeight});\r\n    let anchor = document.querySelector(`#article-pooling`);\r\n    scroll.animateScroll(anchor);\r\n  }\r\n\r\n  // Test dragging detail view, need more work\r\n  // const detailViewDragStart = (e) => {\r\n  //   // Record the starting pos\r\n  //   dragInfo.x1 = 0;\r\n  //   dragInfo.y1 = 0;\r\n  //   dragInfo.x2 = e.clientX;\r\n  //   dragInfo.y2 = e.clientY;\r\n  \r\n  //   dragging = true;\r\n  // }\r\n\r\n  // const detailViewDragEnd = (e) => {\r\n  //   dragging = false;\r\n  // }\r\n\r\n  // const detailViewDragMove = (e) => {\r\n  //   // Add up move to the starting pos\r\n  //   dragInfo.x1 = dragInfo.x2 - e.clientX;\r\n  //   dragInfo.y1 = dragInfo.y2 - e.clientY;\r\n  //   dragInfo.x2 = e.clientX;\r\n  //   dragInfo.y2 = e.clientY;\r\n\r\n  //   // Move detail view\r\n  //   detailView.style.top = (detailView.offsetTop - dragInfo.y1) + 'px';\r\n  //   detailView.style.left = (detailView.offsetLeft - dragInfo.x1) + 'px';\r\n  // }\r\n</script>\r\n\r\n<style>\r\n  .control-pannel {\r\n    display: flex;\r\n    position: relative;\r\n    flex-direction: column;\r\n    align-items: center;\r\n  }\r\n\r\n  .buttons {\r\n    cursor: pointer;\r\n    position: absolute;\r\n    top: 0px;\r\n    right: 0px;\r\n  }\r\n\r\n  .control-button {\r\n    color: gray;\r\n    font-size: 15px;\r\n    opacity: 0.4;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .control-button:not(:first-child) {\r\n    margin-left: 5px;\r\n  }\r\n\r\n  .annotation {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-left : 10px;\r\n    font-size: 12px;\r\n  }\r\n\r\n  .annotation > img {\r\n    width: 17px;\r\n    margin-right: 5px;\r\n  }\r\n\r\n\r\n  .control-button:hover {\r\n    opacity: 0.8;\r\n  }\r\n\r\n  .box {\r\n    padding: 5px 15px 10px 15px;\r\n  }\r\n\r\n  .container {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n  }\r\n\r\n  .title-text {\r\n    font-size: 1.2em;\r\n    font-weight: 500;\r\n    color: #4a4a4a;\r\n  }\r\n</style>\r\n\r\n{#if !isExited}\r\n  <div class=\"container\">\r\n\r\n    <!-- old stride input -->\r\n    <!-- <div class=\"columns is-mobile\">\r\n      <div class=\"column is-half is-offset-one-quarter\">\r\n        <div class=\"field is-grouped\">\r\n          <p class=\"control is-expanded\">\r\n            <input class=\"input\" type=\"text\" placeholder=\"Stride\" bind:value={stride} />\r\n          </p>\r\n          <p class=\"control\">\r\n            <button class=\"button is-success\" on:click={handleClickPause}>\r\n              Toggle Movement\r\n            </button>\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div> -->\r\n    <div class=\"box\">\r\n\r\n      <div class=\"control-pannel\">\r\n      \r\n        <div class=\"title-text\">\r\n          最大值池化\r\n        </div>\r\n\r\n        <div class=\"buttons\">\r\n\r\n          <div class=\"control-button\" on:click={handleScroll} title=\"Jump to article section\">\r\n            <i class=\"fas fa-info-circle\"></i>\r\n          </div>\r\n\r\n          <div class=\"play-button control-button\" on:click={handleClickPause} title=\"Play animation\">\r\n            {@html isPaused ?\r\n              '<i class=\"fas fa-play-circle play-icon\"></i>' :\r\n              '<i class=\"fas fa-pause-circle\"></i>'}\r\n          </div>\r\n\r\n          <div class=\"delete-button control-button\" on:click={handleClickX} title=\"Close\">\r\n            <i class=\"fas control-icon fa-times-circle\"></i>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <div class=\"container is-centered is-vcentered\">\r\n        <PoolAnimator on:message={handlePauseFromInteraction} \r\n          kernelLength={kernelLength} image={input} output={outputFinal} \r\n          stride={stride} dilation={dilation} isPaused={isPaused}\r\n          dataRange={dataRange} />\r\n      </div>\r\n\r\n      <div class=\"annotation\">\r\n        <img src='PUBLIC_URL/assets/img/pointer.svg' alt='pointer icon'>\r\n          <div class=\"annotation-text\">\r\n            <span style=\"font-weight:600\">悬停鼠标</span> 在矩阵中来查看对应位置的计算过程.\r\n          </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n{/if}",
    "<script>\r\n  import { onMount, afterUpdate, createEventDispatcher } from 'svelte';\r\n  export let logits;\r\n  export let logitColors;\r\n  export let selectedI;\r\n  export let highlightI = -1;\r\n  export let outputName;\r\n  export let outputValue;\r\n  export let startAnimation;\r\n\r\n  let softmaxViewComponent;\r\n  let svg = null;\r\n  const dispatch = createEventDispatcher();\r\n  const formater = (n, d) => {\r\n    if (d === undefined) {\r\n      return d3.format('.2f')(n);\r\n    } else {\r\n      return d3.format(`.${d}f`)(n);\r\n    }\r\n  }\r\n\r\n  $: highlightI, (() => {\r\n    if (svg !== null) {\r\n      svg.selectAll(`.formula-term`)\r\n        .style('text-decoration', 'none')\r\n        .style('font-weight', 'normal');\r\n\r\n      svg.selectAll(`.formula-term-${highlightI}`)\r\n      .style('font-weight', 'bold')\r\n      .style('text-decoration', 'underline');\r\n    }\r\n  })();\r\n\r\n  $: startAnimation, (() => {\r\n    if (svg !== null) {\r\n      svg.select(`.formula-term-${startAnimation.i}`)\r\n        .transition('softmax-edge')\r\n        .duration(startAnimation.duration)\r\n        .style('fill-opacity', 1);\r\n    }\r\n  })();\r\n\r\n  const mouseOverHandler = (d, i, g, curI) => {\r\n    highlightI = curI;\r\n    dispatch('mouseOver', {curI: curI});\r\n  }\r\n\r\n  const mouseLeaveHandler = (d, i, g, curI) => {\r\n    highlightI = -1;\r\n    dispatch('mouseLeave', {curI: curI});\r\n  }\r\n\r\n  const handleClickX = () => {\r\n    dispatch('xClicked', {});\r\n  }\r\n\r\n  function handleScroll() {\r\n    let svgHeight = Number(d3.select('#cnn-svg').style('height').replace('px', '')) + 150;\r\n    let scroll = new SmoothScroll('a[href*=\"#\"]', {offset: -svgHeight});\r\n    let anchor = document.querySelector(`#article-softmax`);\r\n    scroll.animateScroll(anchor);\r\n  }\r\n\r\n  onMount(() => {\r\n    svg = d3.select(softmaxViewComponent)\r\n      .select('#softmax-svg');\r\n\r\n    let formulaRightGroup = svg.append('g')\r\n      .attr('class', 'formula-right')\r\n      .attr('transform', `translate(${10}, ${0})`)\r\n      .style('font-size', '15px');\r\n\r\n    // Denominator\r\n    let denominatorGroup = formulaRightGroup.append('g')\r\n      .attr('class', 'denominator')\r\n      .attr('transform', `translate(${0}, ${58})`);\r\n      \r\n    // Add the left (\r\n    denominatorGroup.append('text')\r\n      .attr('x', 0)\r\n      .attr('y', 0)\r\n      .style('fill', 'gray')\r\n      .text('(');\r\n\r\n    // Need to loop through the logits array instead of data-binding because\r\n    // we want dynamic positioning based on prior '-' occurance\r\n    let curX = 8;\r\n    let numOfRows = 4;\r\n\r\n    logits.forEach((d, i) => {\r\n      if (i / numOfRows >= 1 && i % numOfRows === 0) {\r\n          curX = 8;\r\n      }\r\n\r\n      let curText = denominatorGroup.append('text')\r\n        .attr('x', curX)\r\n        .attr('y', Math.floor(i / numOfRows) * 20)\r\n        .style('cursor', 'crosshair')\r\n        .style('pointer-events', 'all')\r\n        .on('mouseover', (d, n, g) => mouseOverHandler(d, n, g, i))\r\n        .on('mouseleave', (d, n, g) => mouseLeaveHandler(d, n, g, i))\r\n        .text(`exp(`);\r\n      \r\n      curText.append('tspan')\r\n        .attr('class', `formula-term-${i} formula-term`)\r\n        .attr('dx', '1')\r\n        .style('fill', logitColors[i])\r\n        .style('fill-opacity', (i === selectedI) || startAnimation.hasInitialized ? 1 : 0)\r\n        .text(formater(d));\r\n      \r\n      curText.append('tspan')\r\n        .attr('dx', '1')\r\n        .text(')');\r\n      \r\n      let curBBox = curText.node().getBBox();\r\n      curX += curBBox.width + 4;\r\n\r\n      if (i !== logits.length - 1) {\r\n        denominatorGroup.append('text')\r\n          .attr('x', curX)\r\n          .attr('y', Math.floor(i / numOfRows) * 20)\r\n          .text('+');\r\n        curX += 14;\r\n      } else {\r\n        denominatorGroup.append('text')\r\n          .attr('x', curX-2)\r\n          .attr('y', Math.floor(i / numOfRows) * 20)\r\n          .style('fill', 'gray')\r\n          .text(')');\r\n      }\r\n    })\r\n\r\n    denominatorGroup.selectAll('text')\r\n      .data(logits)\r\n      .enter()\r\n      .append('text')\r\n      .attr('x', (d, i) => 40 * i)\r\n      .attr('y', 0)\r\n      .text(d => formater(d));\r\n    \r\n    // Calculate the dynamic denominator group width\r\n    let denominatorGroupBBox = denominatorGroup.node().getBBox();\r\n\r\n    // Draw the fraction line\r\n    formulaRightGroup.append('line')\r\n      .attr('class', 'separation-line')\r\n      .attr('x1', -5)\r\n      .attr('x2', denominatorGroupBBox.width + 5)\r\n      .attr('y1', 32)\r\n      .attr('y2', 32)\r\n      .style('stroke-width', 1.2)\r\n      .style('stroke', 'gray');\r\n    \r\n    // Draw the numerator\r\n    let numeratorGroup = formulaRightGroup.append('g')\r\n      .attr('class', 'numerator-group')\r\n      .attr('transform', `translate(${0}, ${20})`);\r\n    \r\n    let numeratorText = numeratorGroup.append('text')\r\n      .attr('x', denominatorGroupBBox.x + denominatorGroupBBox.width / 2)\r\n      .attr('y', 0)\r\n      .on('mouseover', (d, n, g) => mouseOverHandler(d, n, g, selectedI))\r\n      .on('mouseleave', (d, n, g) => mouseLeaveHandler(d, n, g, selectedI))\r\n      .style('pointer-events', 'all')\r\n      .style('cursor', 'crosshair')\r\n      .style('text-anchor', 'middle')\r\n      .text('exp(');\r\n\r\n    numeratorText.append('tspan')\r\n      .attr('class', `formula-term-${selectedI} formula-term`)\r\n      .attr('dx', 1)\r\n      .style('fill', logitColors[selectedI])\r\n      .text(`${formater(logits[selectedI])}`);\r\n\r\n    numeratorText.append('tspan')\r\n       .attr('dx', 1)\r\n      .text(')');\r\n    \r\n    // Draw the left part of the formula\r\n    let formulaLeftGroup = svg.append('g')\r\n      .attr('class', 'formula-left')\r\n      .attr('transform', `translate(${395}, ${32})`);\r\n    \r\n    let softmaxText = formulaLeftGroup.append('text')\r\n      .attr('x', 20)\r\n      .attr('dominant-baseline', 'middle')\r\n      .text(`${formater(outputValue, 4)}`);\r\n    \r\n    let softmaxTextBBox = softmaxText.node().getBBox();\r\n    \r\n    formulaLeftGroup.append('text')\r\n      .attr('dominant-baseline', 'middle')\r\n      .attr('x', 0)\r\n      .attr('y', 0)\r\n      .style('fill', 'gray')\r\n      .style('font-weight', 'bold')\r\n      .text('=');\r\n\r\n  })\r\n\r\n</script>\r\n\r\n<style>\r\n  .buttons {\r\n    cursor: pointer;\r\n    position: absolute;\r\n    top: 6px;\r\n    right: 10px;\r\n  }\r\n\r\n  .control-button {\r\n    color: gray;\r\n    font-size: 15px;\r\n    opacity: 0.4;\r\n  }\r\n\r\n  .control-button:hover {\r\n    opacity: 0.8;\r\n  }\r\n\r\n  .control-button:not(:first-child) {\r\n    margin-left: 5px;\r\n  }\r\n\r\n  .title-text {\r\n    font-size: 1.2em;\r\n    font-weight: 500;\r\n    color: #4a4a4a;\r\n  }\r\n\r\n  .annotation {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding-left : 10px;\r\n    font-size: 12px;\r\n  }\r\n\r\n  .annotation > img {\r\n    width: 17px;\r\n    margin-right: 5px;\r\n  }\r\n\r\n  .box {\r\n    padding: 5px 10px 15px 10px;\r\n    position: relative;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n  }\r\n\r\n  svg {\r\n    margin: 10px 0 12px 0;\r\n  }\r\n</style>\r\n\r\n<div class=\"container\" bind:this={softmaxViewComponent}>\r\n  <div class=\"box\">\r\n\r\n    <div class=\"buttons\">\r\n      <div class=\"control-button\" on:click={handleScroll} title=\"Jump to article section\">\r\n        <i class=\"fas fa-info-circle\"></i>\r\n      </div>\r\n\r\n      <div class=\"delete-button control-button\" on:click={handleClickX} title=\"Close\">\r\n        <i class=\"fas control-icon fa-times-circle\"></i>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"title-text\">\r\n      <i>\"{outputName}\"</i> 的Softmax概率结果\r\n    </div>\r\n\r\n    <svg id=\"softmax-svg\" width=\"470\" height=\"105\"/>\r\n\r\n    <div class=\"annotation\">\r\n      <img src='PUBLIC_URL/assets/img/pointer.svg' alt='pointer icon'>\r\n      <div class=\"annotation-text\">\r\n        <span style=\"font-weight:600\">悬停鼠标</span> 高亮对应值的计算路径.\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</div>\r\n\r\n",
    "<script>\r\n  /* global d3 */\r\n\r\n  import { onMount, createEventDispatcher } from 'svelte';\r\n  import { modalStore } from '../stores.js';\r\n\r\n  let modalComponent;\r\n  let valiImg;\r\n  let inputValue = '';\r\n  let showLoading = false;\r\n  let files;\r\n  let usingURL = true;\r\n  let errorInfo = {\r\n    show: false,\r\n    error: ''\r\n  };\r\n  const dispatch = createEventDispatcher();\r\n\r\n  let modalInfo = {\r\n    show: false\r\n  };\r\n  modalStore.set(modalInfo);\r\n  modalStore.subscribe(value => {modalInfo = value});\r\n\r\n  const errorCallback = () => {\r\n    // The URL is invalid, show an error message on the UI\r\n    showLoading = false;\r\n    errorInfo.show = true;\r\n    errorInfo.error = usingURL ? \"We can't find the image at that URL.\" :\r\n      \"Not a valid image file.\";\r\n  }\r\n\r\n  const loadCallback = () => {\r\n    // The URL is valid, but we are not sure if loading it to canvas would be\r\n    // blocked by crossOrigin setting. Try it here before dispatch to parent.\r\n\r\n    // https://stackoverflow.com/questions/13674835/canvas-tainted-by-cross-origin-data\r\n    let canvas = document.createElement(\"canvas\");\r\n    let context = canvas.getContext(\"2d\");\r\n\r\n    canvas.width = valiImg.width;\r\n    canvas.height = valiImg.height;\r\n    context.drawImage(valiImg, 0, 0);\r\n\r\n    try {\r\n      context.getImageData(0, 0, valiImg.width, valiImg.height);\r\n      // If the foreign image does support CORS -> use this image\r\n      // dispatch to parent component to use the input image\r\n      showLoading = false;\r\n      modalInfo.show = false;\r\n      modalStore.set(modalInfo);\r\n      dispatch('urlTyped', {url: valiImg.src});\r\n      inputValue = null;\r\n    } catch(err) {\r\n      // If the foreign image does not support CORS -> use this image\r\n      showLoading = false;\r\n      errorInfo.show = true;\r\n      errorInfo.error = \"No permission to load this image.\"\r\n    }\r\n  }\r\n\r\n  const imageUpload = () => {\r\n    usingURL = false;\r\n    let reader = new FileReader();\r\n    reader.onload = (event) => {\r\n      valiImg.src = event.target.result;\r\n    }\r\n    reader.readAsDataURL(files[0]);\r\n  }\r\n\r\n  const crossClicked = () => {\r\n    modalInfo.show = false;\r\n    modalStore.set(modalInfo);\r\n    // Dispatch the parent component\r\n    dispatch('xClicked', {preImage: modalInfo.preImage});\r\n  }\r\n\r\n  const addClicked = () => {\r\n    // Validate the input URL\r\n    showLoading = true;\r\n    errorInfo.show = false;\r\n    valiImg.crossOrigin = \"Anonymous\";\r\n    valiImg.src = inputValue;\r\n  }\r\n\r\n  onMount(() => {\r\n    let modal = d3.select(modalComponent)\r\n      .select('#input-modal');\r\n  })\r\n\r\n</script>\r\n\r\n<style>\r\n  .modal-card {\r\n    max-width: 500px;\r\n  }\r\n\r\n  .modal-card-title {\r\n    font-size: 20px;\r\n  }\r\n\r\n  .modal-card-head {\r\n    padding: 15px 20px;\r\n  }\r\n\r\n  .modal-card-foot {\r\n    padding: 12px 20px;\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .is-smaller {\r\n    font-size: 15px;\r\n    padding: 0.5em 0.8em;\r\n    max-height: 2.2em;\r\n  }\r\n\r\n  .small-font {\r\n    font-size: 15px;\r\n  }\r\n\r\n  .error-message {\r\n    font-size: 15px;\r\n    padding: 0.5em 0;\r\n    color: #F22B61;\r\n  }\r\n\r\n  .control {\r\n    width: 100%;\r\n  }\r\n\r\n  .or-label {\r\n    font-size: 15px;\r\n    margin: 0 10px;\r\n    padding: 0.5em 0;\r\n  }\r\n\r\n  .field {\r\n    display: flex;\r\n    justify-content: space-between;\r\n  }\r\n\r\n</style>\r\n\r\n\r\n<div class=\"modal-component\"\r\n  bind:this={modalComponent}>\r\n\r\n  <div class=\"modal\"\r\n    id=\"input-modal\"\r\n    class:is-active={modalInfo.show}>\r\n\r\n    <div class=\"modal-background\" on:click={crossClicked}></div>\r\n\r\n    <div class=\"modal-card\">\r\n      <header class=\"modal-card-head\">\r\n        <p class=\"modal-card-title\">自定义输入图片</p>\r\n        <button class=\"delete\" aria-label=\"close\" on:click={crossClicked}></button>\r\n      </header>\r\n\r\n      <section class=\"modal-card-body\">\r\n        <div class=\"field\">\r\n          <div class=\"control has-icons-left\"\r\n            class:is-loading={showLoading}>\r\n\r\n            <input class=\"input small-font\" type=\"url\"\r\n              bind:value={inputValue}\r\n              placeholder=\"输入图片的网址链接...\">\r\n\r\n            <span class=\"icon small-font is-left\">\r\n              <i class=\"fas fa-link\"></i>\r\n            </span>\r\n\r\n          </div>\r\n\r\n          <div class=\"or-label\">or</div>\r\n\r\n          <div class=\"file\">\r\n            <label class=\"file-label\">\r\n              <input class=\"file-input\" type=\"file\" name=\"image\"\r\n                accept=\".png,.jpeg,.tiff,.jpg,.png\"\r\n                on:change={imageUpload}\r\n                bind:files={files}>\r\n              <span class=\"file-cta small-font\">\r\n                <span class=\"file-icon\">\r\n                  <i class=\"fas fa-upload\"></i>\r\n                </span>\r\n                <span class=\"file-label\">\r\n                  上传图片\r\n                </span>\r\n              </span>\r\n            </label>\r\n          </div>\r\n\r\n        </div>\r\n\r\n      </section>\r\n\r\n      <footer class=\"modal-card-foot\">\r\n\r\n        <div class=\"error-message\"\r\n          class:hidden={!errorInfo.show}>\r\n          {errorInfo.error}\r\n        </div>\r\n\r\n        <div class=\"button-container\">\r\n          <button class=\"button is-smaller\"\r\n            on:click={crossClicked}>\r\n            取消\r\n          </button>\r\n\r\n          <button class=\"button is-success is-smaller\"\r\n            on:click={addClicked}>\r\n            确定\r\n          </button>\r\n        </div>\r\n\r\n\r\n      </footer>\r\n    </div>\r\n\r\n  </div>\r\n\r\n  <!-- An invisible image to check if the user input URL is valid -->\r\n  <img style=\"display: none\"\r\n    id=\"vali-image\"\r\n    alt=\"hidden image\"\r\n    bind:this={valiImg}\r\n    on:error={errorCallback}\r\n    on:load={loadCallback} />\r\n\r\n</div>\r\n",
    "<script>\r\n  // Svelte functions\r\n  import { onMount } from 'svelte';\r\n  import {\r\n    cnnStore, svgStore, vSpaceAroundGapStore, hSpaceAroundGapStore,\r\n    nodeCoordinateStore, selectedScaleLevelStore, cnnLayerRangesStore,\r\n    needRedrawStore, cnnLayerMinMaxStore, detailedModeStore,\r\n    shouldIntermediateAnimateStore, isInSoftmaxStore, softmaxDetailViewStore,\r\n    hoverInfoStore, allowsSoftmaxAnimationStore, modalStore,\r\n    intermediateLayerPositionStore\r\n  } from '../stores.js';\r\n\r\n  // Svelte views\r\n  import ConvolutionView from '../detail-view/Convolutionview.svelte';\r\n  import ActivationView from '../detail-view/Activationview.svelte';\r\n  import PoolView from '../detail-view/Poolview.svelte';\r\n  import SoftmaxView from '../detail-view/Softmaxview.svelte';\r\n  import Modal from './Modal.svelte'\r\n  import Article from '../article/Article.svelte';\r\n\r\n  // Overview functions\r\n  import { loadTrainedModel, constructCNN } from '../utils/cnn-tf.js';\r\n  import { overviewConfig } from '../config.js';\r\n\r\n  import {\r\n    addOverlayRect, drawConv1, drawConv2, drawConv3, drawConv4\r\n  } from './intermediate-draw.js';\r\n\r\n  import {\r\n    moveLayerX, addOverlayGradient\r\n  } from './intermediate-utils.js';\r\n\r\n  import {\r\n    drawFlatten, softmaxDetailViewMouseOverHandler, softmaxDetailViewMouseLeaveHandler, drawOutFlatten\r\n  } from './flatten-draw.js';\r\n\r\n  import {\r\n    drawOutput, drawCNN, updateCNN, updateCNNLayerRanges, drawCustomImage\r\n  } from './overview-draw.js';\r\n\r\n\r\n  // View bindings\r\n  let overviewComponent;\r\n  let scaleLevelSet = new Set(['local', 'module', 'global']);\r\n  let selectedScaleLevel = 'local';\r\n  selectedScaleLevelStore.set(selectedScaleLevel);\r\n  let previousSelectedScaleLevel = selectedScaleLevel;\r\n  let wholeSvg = undefined;\r\n  let svg = undefined;\r\n\r\n  $: selectedScaleLevel, selectedScaleLevelChanged();\r\n\r\n  // Configs\r\n  const layerColorScales = overviewConfig.layerColorScales;\r\n  const nodeLength = overviewConfig.nodeLength;\r\n  const plusSymbolRadius = overviewConfig.plusSymbolRadius;\r\n  const numLayers = overviewConfig.numLayers;\r\n  const edgeOpacity = overviewConfig.edgeOpacity;\r\n  const edgeInitColor = overviewConfig.edgeInitColor;\r\n  const edgeHoverColor = overviewConfig.edgeHoverColor;\r\n  const edgeHoverOuting = overviewConfig.edgeHoverOuting;\r\n  const edgeStrokeWidth = overviewConfig.edgeStrokeWidth;\r\n  const intermediateColor = overviewConfig.intermediateColor;\r\n  const kernelRectLength = overviewConfig.kernelRectLength;\r\n  const svgPaddings = overviewConfig.svgPaddings;\r\n  const gapRatio = overviewConfig.gapRatio;\r\n  const overlayRectOffset = overviewConfig.overlayRectOffset;\r\n  const classLists = overviewConfig.classLists;\r\n\r\n  // Shared properties\r\n  let needRedraw = [undefined, undefined];\r\n  needRedrawStore.subscribe( value => {needRedraw = value;} );\r\n\r\n  let nodeCoordinate = undefined;\r\n  nodeCoordinateStore.subscribe( value => {nodeCoordinate = value;} )\r\n\r\n  let cnnLayerRanges = undefined;\r\n  cnnLayerRangesStore.subscribe( value => {cnnLayerRanges = value;} )\r\n\r\n  let cnnLayerMinMax = undefined;\r\n  cnnLayerMinMaxStore.subscribe( value => {cnnLayerMinMax = value;} )\r\n\r\n  let detailedMode = undefined;\r\n  detailedModeStore.subscribe( value => {detailedMode = value;} )\r\n\r\n  let shouldIntermediateAnimate = undefined;\r\n  shouldIntermediateAnimateStore.subscribe(value => {\r\n    shouldIntermediateAnimate = value;\r\n  })\r\n\r\n  let vSpaceAroundGap = undefined;\r\n  vSpaceAroundGapStore.subscribe( value => {vSpaceAroundGap = value;} )\r\n\r\n  let hSpaceAroundGap = undefined;\r\n  hSpaceAroundGapStore.subscribe( value => {hSpaceAroundGap = value;} )\r\n\r\n  let isInSoftmax = undefined;\r\n  isInSoftmaxStore.subscribe( value => {isInSoftmax = value;} )\r\n\r\n  let softmaxDetailViewInfo = undefined;\r\n  softmaxDetailViewStore.subscribe( value => {\r\n    softmaxDetailViewInfo = value;\r\n  } )\r\n  \r\n  let modalInfo = undefined;\r\n  modalStore.subscribe( value => {modalInfo = value;} )\r\n\r\n  let hoverInfo = undefined;\r\n  hoverInfoStore.subscribe( value => {hoverInfo = value;} )\r\n\r\n  let intermediateLayerPosition = undefined;\r\n  intermediateLayerPositionStore.subscribe ( value => {intermediateLayerPosition = value;} )\r\n\r\n  let width = undefined;\r\n  let height = undefined;\r\n  let model = undefined;\r\n  let selectedNode = {layerName: '', index: -1, data: null};\r\n  let isInIntermediateView = false;\r\n  let isInActPoolDetailView = false;\r\n  let actPoolDetailViewNodeIndex = -1;\r\n  let actPoolDetailViewLayerIndex = -1;\r\n  let detailedViewNum = undefined;\r\n  let disableControl = false;\r\n\r\n  // Wait to load\r\n  let cnn = undefined;\r\n\r\n  let detailedViewAbsCoords = {\r\n    1 : [600, 270, 490, 290],\r\n    2: [500, 270, 490, 290],\r\n    3 : [700, 270, 490, 290],\r\n    4: [600, 270, 490, 290],\r\n    5: [650, 270, 490, 290],\r\n    6 : [775, 270, 490, 290],\r\n    7 : [100, 270, 490, 290],\r\n    8 : [60, 270, 490, 290],\r\n    9 : [200, 270, 490, 290],\r\n    10 : [300, 270, 490, 290],\r\n  }\r\n\r\n  const layerIndexDict1 = {\r\n    'input': 0,\r\n    'conv_1_1': 1,\r\n    'relu_1_1': 2,\r\n    'conv_1_2': 3,\r\n    'relu_1_2': 4,\r\n    'max_pool_1': 5,\r\n    'conv_2_1': 6,\r\n    'relu_2_1': 7,\r\n    'conv_2_2': 8,\r\n    'relu_2_2': 9,\r\n    'max_pool_2': 10,\r\n    'output': 11\r\n  }\r\n  const layerIndexDict = {\r\n    'input': 0,\r\n    'conv2d_22': 1,\r\n    'max_pooling2d_21': 2,\r\n    'conv2d_23': 3,\r\n    'max_pooling2d_22': 4,\r\n    'dense_22': 5,\r\n    'output': 6,\r\n  }\r\n  const layerLegendDict = {\r\n    0: {local: 'input-legend', module: 'input-legend', global: 'input-legend'},\r\n    1: {local: 'local-legend-0-1', module: 'module-legend-0', global: 'global-legend'},\r\n    2: {local: 'local-legend-0-1', module: 'module-legend-0', global: 'global-legend'},\r\n    3: {local: 'local-legend-0-2', module: 'module-legend-0', global: 'global-legend'},\r\n    4: {local: 'local-legend-0-2', module: 'module-legend-0', global: 'global-legend'},\r\n    5: {local: 'local-legend-0-2', module: 'module-legend-0', global: 'global-legend'},\r\n    6: {local: 'local-legend-1-1', module: 'module-legend-1', global: 'global-legend'},\r\n    7: {local: 'local-legend-1-1', module: 'module-legend-1', global: 'global-legend'},\r\n    8: {local: 'local-legend-1-2', module: 'module-legend-1', global: 'global-legend'},\r\n    9: {local: 'local-legend-1-2', module: 'module-legend-1', global: 'global-legend'},\r\n    10: {local: 'local-legend-1-2', module: 'module-legend-1', global: 'global-legend'},\r\n    11: {local: 'output-legend', module: 'output-legend', global: 'output-legend'}\r\n  }\r\n\r\n  let imageOptions = [\r\n    {file: 'IS2.jpg', class: '山鸢尾'},\r\n    {file: 'IV1.jpg', class: '杂色鸢尾'},\r\n    {file: 'IVA5.jpg', class: '维吉尼亚鸢尾'}\r\n  ];\r\n  let selectedImage = imageOptions[0].file;\r\n\r\n  let nodeData;\r\n  let selectedNodeIndex = -1;\r\n  let isExitedFromDetailedView = true;\r\n  let isExitedFromCollapse = true;\r\n  let customImageURL = null;\r\n\r\n  // Helper functions\r\n  const selectedScaleLevelChanged = () => {\r\n    if (svg !== undefined) {\r\n      if (!scaleLevelSet.add(selectedScaleLevel)) {\r\n        console.error('Encounter unknown scale level!');\r\n      }\r\n\r\n      // Update nodes and legends\r\n      if (selectedScaleLevel != previousSelectedScaleLevel){\r\n        // We can simply redraw all nodes using the new color scale, or we can\r\n        // make it faster by only redraw certian nodes\r\n        let updatingLayerIndexDict = {\r\n          local: {\r\n            module: [1, 2, 8, 9, 10],\r\n            global: [1, 2, 3, 4, 5, 8, 9, 10]\r\n          },\r\n          module: {\r\n            local: [1, 2, 8, 9, 10],\r\n            global: [1, 2, 3, 4, 5, 8, 9, 10]\r\n          },\r\n          global: {\r\n            local: [1, 2, 3, 4, 5, 8, 9, 10],\r\n            module: [1, 2, 3, 4, 5]\r\n          }\r\n        };\r\n\r\n        let updatingLayerIndex = updatingLayerIndexDict[\r\n          previousSelectedScaleLevel][selectedScaleLevel];\r\n\r\n        updatingLayerIndex.forEach(l => {\r\n          let range = cnnLayerRanges[selectedScaleLevel][l];\r\n          svg.select(`#cnn-layer-group-${l}`)\r\n            .selectAll('.node-image')\r\n            .each((d, i, g) => drawOutput(d, i, g, range));\r\n        });\r\n \r\n        // Hide previous legend\r\n        svg.selectAll(`.${previousSelectedScaleLevel}-legend`)\r\n          .classed('hidden', true);\r\n\r\n        // Show selected legends\r\n        svg.selectAll(`.${selectedScaleLevel}-legend`)\r\n          .classed('hidden', !detailedMode);\r\n      }\r\n      previousSelectedScaleLevel = selectedScaleLevel;\r\n      selectedScaleLevelStore.set(selectedScaleLevel);\r\n    }\r\n  }\r\n\r\n  const intermediateNodeMouseOverHandler = (d, i, g) => {\r\n    if (detailedViewNum !== undefined) { return; }\r\n    svg.select(`rect#underneath-gateway-${d.index}`)\r\n      .style('opacity', 1);\r\n  }\r\n\r\n  const intermediateNodeMouseLeaveHandler = (d, i, g) => {\r\n    // return;\r\n    if (detailedViewNum !== undefined) { return; }\r\n    svg.select(`rect#underneath-gateway-${d.index}`)\r\n      .style('opacity', 0);\r\n  }\r\n\r\n  const intermediateNodeClicked = (d, i, g, selectedI, curLayerIndex) => {\r\n    d3.event.stopPropagation();\r\n    isExitedFromCollapse = false;\r\n    // Use this event to trigger the detailed view\r\n    if (detailedViewNum === d.index) {\r\n      // Setting this for testing purposes currently.\r\n      selectedNodeIndex = -1; \r\n      // User clicks this node again -> rewind\r\n      detailedViewNum = undefined;\r\n      svg.select(`rect#underneath-gateway-${d.index}`)\r\n        .style('opacity', 0);\r\n    } \r\n    // We need to show a new detailed view (two cases: if we need to close the\r\n    // old detailed view or not)\r\n    else {\r\n      // Setting this for testing purposes currently.\r\n      selectedNodeIndex = d.index;\r\n      let inputMatrix = d.output;\r\n      let kernelMatrix = d.outputLinks[selectedI].weight;\r\n      // let interMatrix = singleConv(inputMatrix, kernelMatrix);\r\n      let colorScale = layerColorScales.conv;\r\n\r\n      // Compute the color range\r\n      let rangePre = cnnLayerRanges[selectedScaleLevel][curLayerIndex - 1];\r\n      let rangeCur = cnnLayerRanges[selectedScaleLevel][curLayerIndex];\r\n      let range = Math.max(rangePre, rangeCur);\r\n\r\n      // User triggers a different detailed view\r\n      if (detailedViewNum !== undefined) {\r\n        // Change the underneath highlight\r\n        svg.select(`rect#underneath-gateway-${detailedViewNum}`)\r\n          .style('opacity', 0);\r\n        svg.select(`rect#underneath-gateway-${d.index}`)\r\n          .style('opacity', 1);\r\n      }\r\n      \r\n      // Dynamically position the detail view\r\n      let wholeSvg = d3.select('#cnn-svg');\r\n      let svgYMid = +wholeSvg.style('height').replace('px', '') / 2;\r\n      let svgWidth = +wholeSvg.style('width').replace('px', '');\r\n      let detailViewTop = -svgYMid - 250 / 2;\r\n      let positionX = intermediateLayerPosition[Object.keys(layerIndexDict)[curLayerIndex]];\r\n\r\n      let posX = 0;\r\n      if (curLayerIndex > 6) {\r\n        posX = (positionX - svgPaddings.left) / 2;\r\n        posX = svgPaddings.left + posX - 800 / 2;\r\n      } else {\r\n        posX = (svgWidth + svgPaddings.right - positionX) / 2;\r\n        posX = positionX + posX - 800 / 2;\r\n      }\r\n\r\n      const detailview = document.getElementById('detailview');\r\n      detailview.style.top = `${detailViewTop}px`;\r\n      detailview.style.left = `${posX}px`;\r\n      detailview.style.position = 'relative';\r\n\r\n      detailedViewNum = d.index;\r\n\r\n      // Send the currently used color range to detailed view\r\n      nodeData.colorRange = range;\r\n      nodeData.inputIsInputLayer = curLayerIndex <= 1;\r\n    }\r\n  }\r\n\r\n  // The order of the if/else statements in this function is very critical\r\n  const emptySpaceClicked = () => {\r\n    // If detail view -> rewind to intermediate view\r\n    if (detailedViewNum !== undefined) {\r\n          // Setting this for testing purposes currently.\r\n      selectedNodeIndex = -1; \r\n      // User clicks this node again -> rewind\r\n      svg.select(`rect#underneath-gateway-${detailedViewNum}`)\r\n        .style('opacity', 0);\r\n      detailedViewNum = undefined;\r\n    }\r\n\r\n    // If softmax view -> rewind to flatten layer view\r\n    else if (isInSoftmax) {\r\n      svg.select('.softmax-symbol')\r\n        .dispatch('click');\r\n    }\r\n\r\n    // If intermediate view -> rewind to overview\r\n    else if (isInIntermediateView) {\r\n      let curLayerIndex = layerIndexDict[selectedNode.layerName];\r\n      quitIntermediateView(curLayerIndex, selectedNode.domG, selectedNode.domI);\r\n      d3.select(selectedNode.domG[selectedNode.domI])\r\n        .dispatch('mouseleave');\r\n    }\r\n\r\n    // If pool/act detail view -> rewind to overview\r\n    else if (isInActPoolDetailView) {\r\n      quitActPoolDetailView();\r\n    }\r\n  }\r\n\r\n  const prepareToEnterIntermediateView = (d, g, i, curLayerIndex) => {\r\n    isInIntermediateView = true;\r\n    // Hide all legends\r\n    svg.selectAll(`.${selectedScaleLevel}-legend`)\r\n      .classed('hidden', true);\r\n    svg.selectAll('.input-legend').classed('hidden', true);\r\n    svg.selectAll('.output-legend').classed('hidden', true);\r\n\r\n    // Hide the input annotation\r\n    svg.select('.input-annotation')\r\n      .classed('hidden', true);\r\n\r\n    // Highlight the previous layer and this node\r\n    svg.select(`g#cnn-layer-group-${curLayerIndex - 1}`)\r\n      .selectAll('rect.bounding')\r\n      .style('stroke-width', 2);\r\n    \r\n    d3.select(g[i])\r\n      .select('rect.bounding')\r\n      .style('stroke-width', 2);\r\n    \r\n    // Disable control panel UI\r\n    // d3.select('#level-select').property('disabled', true);\r\n    // d3.selectAll('.image-container')\r\n    //   .style('cursor', 'not-allowed')\r\n    //   .on('mouseclick', () => {});\r\n    disableControl = true;\r\n    \r\n    // Allow infinite animation loop\r\n    shouldIntermediateAnimateStore.set(true);\r\n\r\n    // Highlight the labels\r\n    svg.selectAll(`g#layer-label-${curLayerIndex - 1},\r\n      g#layer-detailed-label-${curLayerIndex - 1},\r\n      g#layer-label-${curLayerIndex},\r\n      g#layer-detailed-label-${curLayerIndex}`)\r\n      .style('font-weight', '800');\r\n    \r\n    // Register a handler on the svg element so user can click empty space to quit\r\n    // the intermediate view\r\n    d3.select('#cnn-svg')\r\n      .on('click', emptySpaceClicked);\r\n  }\r\n\r\n  const quitActPoolDetailView = () => {\r\n    isInActPoolDetailView = false;\r\n    actPoolDetailViewNodeIndex = -1;\r\n\r\n    let layerIndex = layerIndexDict[selectedNode.layerName];\r\n    let nodeIndex = selectedNode.index;\r\n    svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n      .select('rect.bounding')\r\n      .classed('hidden', true);\r\n\r\n    selectedNode.data.inputLinks.forEach(link => {\r\n      let layerIndex = layerIndexDict[link.source.layerName];\r\n      let nodeIndex = link.source.index;\r\n      svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n        .select('rect.bounding')\r\n        .classed('hidden', true);\r\n    })\r\n\r\n    // Clean up the underneath rects\r\n    svg.select('g.underneath')\r\n      .selectAll('rect')\r\n      .remove();\r\n\r\n    // Show all edges\r\n    let unimportantEdges = svg.select('g.edge-group')\r\n      .selectAll('.edge')\r\n      .filter(d => {\r\n        return d.targetLayerIndex !== actPoolDetailViewLayerIndex;\r\n      })\r\n      .style('visibility', null);\r\n    \r\n    // Recover control UI\r\n    disableControl = false;\r\n\r\n    // Show legends if in detailed mode\r\n    svg.selectAll(`.${selectedScaleLevel}-legend`)\r\n      .classed('hidden', !detailedMode);\r\n    svg.selectAll('.input-legend').classed('hidden', !detailedMode);\r\n    svg.selectAll('.output-legend').classed('hidden', !detailedMode);\r\n\r\n    // Also dehighlight the edge\r\n    let edgeGroup = svg.select('g.cnn-group').select('g.edge-group');\r\n    edgeGroup.selectAll(`path.edge-${layerIndex}-${nodeIndex}`)\r\n      .transition()\r\n      .ease(d3.easeCubicOut)\r\n      .duration(200)\r\n      .style('stroke', edgeInitColor)\r\n      .style('stroke-width', edgeStrokeWidth)\r\n      .style('opacity', edgeOpacity);\r\n\r\n    // Remove the overlay rect\r\n    svg.selectAll('g.intermediate-layer-overlay, g.intermediate-layer-annotation')\r\n      .transition('remove')\r\n      .duration(500)\r\n      .ease(d3.easeCubicInOut)\r\n      .style('opacity', 0)\r\n      .on('end', (d, i, g) => {\r\n        svg.selectAll('g.intermediate-layer-overlay, g.intermediate-layer-annotation').remove();\r\n        svg.selectAll('defs.overlay-gradient').remove();\r\n        svg.select('.input-annotation').classed('hidden', false);\r\n      });\r\n\r\n    // Turn the fade out nodes back\r\n    svg.select(`g#cnn-layer-group-${layerIndex}`)\r\n      .selectAll('g.node-group')\r\n      .each((sd, si, sg) => {\r\n        d3.select(sg[si])\r\n          .style('pointer-events', 'all');\r\n    });\r\n\r\n    svg.select(`g#cnn-layer-group-${layerIndex - 1}`)\r\n      .selectAll('g.node-group')\r\n      .each((sd, si, sg) => {\r\n        // Recover the old events\r\n        d3.select(sg[si])\r\n          .style('pointer-events', 'all')\r\n          .on('mouseover', nodeMouseOverHandler)\r\n          .on('mouseleave', nodeMouseLeaveHandler)\r\n          .on('click', nodeClickHandler);\r\n    });\r\n\r\n    // Deselect the node\r\n    selectedNode.layerName = '';\r\n    selectedNode.index = -1;\r\n    selectedNode.data = null;\r\n\r\n    actPoolDetailViewLayerIndex = -1;\r\n  }\r\n\r\n  const actPoolDetailViewPreNodeMouseOverHandler = (d, i, g) => {\r\n    // Highlight the edges\r\n    let layerIndex = layerIndexDict[d.layerName];\r\n    let nodeIndex = d.index;\r\n    let edgeGroup = svg.select('g.cnn-group').select('g.edge-group');\r\n    \r\n    edgeGroup.selectAll(`path.edge-${actPoolDetailViewLayerIndex}-${nodeIndex}`)\r\n      .raise()\r\n      .transition()\r\n      .ease(d3.easeCubicInOut)\r\n      .duration(400)\r\n      .style('stroke', edgeHoverColor)\r\n      .style('stroke-width', '1')\r\n      .style('opacity', 1);\r\n    \r\n    // Highlight its border\r\n    d3.select(g[i]).select('rect.bounding')\r\n      .classed('hidden', false);\r\n    \r\n    // Highlight node's pair\r\n    let associatedLayerIndex = layerIndex - 1;\r\n    if (layerIndex === actPoolDetailViewLayerIndex - 1) {\r\n      associatedLayerIndex = layerIndex + 1;\r\n    }\r\n\r\n    svg.select(`g#layer-${associatedLayerIndex}-node-${nodeIndex}`)\r\n      .select('rect.bounding')\r\n      .classed('hidden', false);\r\n  }\r\n\r\n  const actPoolDetailViewPreNodeMouseLeaveHandler = (d, i, g) => {\r\n    // De-highlight the edges\r\n    let layerIndex = layerIndexDict[d.layerName];\r\n    let nodeIndex = d.index;\r\n    let edgeGroup = svg.select('g.cnn-group').select('g.edge-group');\r\n\r\n    edgeGroup.selectAll(`path.edge-${actPoolDetailViewLayerIndex}-${nodeIndex}`)\r\n      .transition()\r\n      .ease(d3.easeCubicOut)\r\n      .duration(200)\r\n      .style('stroke', edgeInitColor)\r\n      .style('stroke-width', edgeStrokeWidth)\r\n      .style('opacity', edgeOpacity);\r\n    \r\n    // De-highlight its border\r\n    d3.select(g[i]).select('rect.bounding')\r\n      .classed('hidden', true);\r\n    \r\n    // De-highlight node's pair\r\n    let associatedLayerIndex = layerIndex - 1;\r\n    if (layerIndex === actPoolDetailViewLayerIndex - 1) {\r\n      associatedLayerIndex = layerIndex + 1;\r\n    }\r\n\r\n    svg.select(`g#layer-${associatedLayerIndex}-node-${nodeIndex}`)\r\n      .select('rect.bounding')\r\n      .classed('hidden', true);\r\n  }\r\n\r\n  const actPoolDetailViewPreNodeClickHandler = (d, i, g) => {\r\n    let layerIndex = layerIndexDict[d.layerName];\r\n    let nodeIndex = d.index;\r\n\r\n    // Click the pre-layer node in detail view has the same effect as clicking\r\n    // the cur-layer node, which is to open a new detail view window\r\n    svg.select(`g#layer-${layerIndex + 1}-node-${nodeIndex}`)\r\n      .node()\r\n      .dispatchEvent(new Event('click'));\r\n  }\r\n\r\n  const enterDetailView = (curLayerIndex, i) => {\r\n    isInActPoolDetailView = true;\r\n    actPoolDetailViewNodeIndex = i;\r\n    actPoolDetailViewLayerIndex = curLayerIndex;\r\n\r\n    // Dynamically position the detail view\r\n    let wholeSvg = d3.select('#cnn-svg');\r\n    let svgYMid = +wholeSvg.style('height').replace('px', '') / 2;\r\n    let svgWidth = +wholeSvg.style('width').replace('px', '');\r\n    let detailViewTop = -svgYMid - 260 / 2;\r\n\r\n    let posX = 0;\r\n    if (curLayerIndex > 5) {\r\n      posX = nodeCoordinate[curLayerIndex - 1][0].x + 50;\r\n      posX = posX / 2 - 800 / 2;\r\n    } else {\r\n      posX = (svgWidth - nodeCoordinate[curLayerIndex][0].x - nodeLength) / 2;\r\n      posX = nodeCoordinate[curLayerIndex][0].x + nodeLength + posX - 800 / 2;\r\n\r\n    }\r\n\r\n    const detailview = document.getElementById('detailview');\r\n    detailview.style.top = `${detailViewTop}px`;\r\n    detailview.style.left = `${posX}px`;\r\n    detailview.style.position = 'relative';\r\n\r\n    // Hide all edges\r\n    let unimportantEdges = svg.select('g.edge-group')\r\n      .selectAll('.edge')\r\n      .filter(d => {\r\n        return d.targetLayerIndex !== curLayerIndex;\r\n      })\r\n      .style('visibility', 'hidden');\r\n    \r\n    // Disable UI\r\n    disableControl = true;\r\n    \r\n    // Hide input annotaitons\r\n    svg.select('.input-annotation')\r\n      .classed('hidden', true);\r\n\r\n    // Hide legends\r\n    svg.selectAll(`.${selectedScaleLevel}-legend`)\r\n      .classed('hidden', true);\r\n    svg.selectAll('.input-legend').classed('hidden', true);\r\n    svg.selectAll('.output-legend').classed('hidden', true);\r\n    svg.select(`#${layerLegendDict[curLayerIndex][selectedScaleLevel]}`)\r\n      .classed('hidden', false);\r\n\r\n    // Add overlay rects\r\n    let leftX = nodeCoordinate[curLayerIndex - 1][i].x;\r\n    // +5 to cover the detailed mode long label\r\n    let rightStart = nodeCoordinate[curLayerIndex][i].x + nodeLength + 5;\r\n\r\n    // Compute the left and right overlay rect width\r\n    let rightWidth = width - rightStart - overlayRectOffset / 2;\r\n    let leftWidth = leftX - nodeCoordinate[0][0].x;\r\n\r\n    // The overlay rects should be symmetric\r\n    if (rightWidth > leftWidth) {\r\n      let stops = [{offset: '0%', color: 'rgb(250, 250, 250)', opacity: 0.85},\r\n        {offset: '50%', color: 'rgb(250, 250, 250)', opacity: 0.9},\r\n        {offset: '100%', color: 'rgb(250, 250, 250)', opacity: 1}];\r\n      addOverlayGradient('overlay-gradient-right', stops);\r\n      \r\n      let leftEndOpacity = 0.85 + (0.95 - 0.85) * (leftWidth / rightWidth);\r\n      stops = [{offset: '0%', color: 'rgb(250, 250, 250)', opacity: leftEndOpacity},\r\n        {offset: '100%', color: 'rgb(250, 250, 250)', opacity: 0.85}];\r\n      addOverlayGradient('overlay-gradient-left', stops);\r\n    } else {\r\n      let stops = [{offset: '0%', color: 'rgb(250, 250, 250)', opacity: 1},\r\n        {offset: '50%', color: 'rgb(250, 250, 250)', opacity: 0.9},\r\n        {offset: '100%', color: 'rgb(250, 250, 250)', opacity: 0.85}];\r\n      addOverlayGradient('overlay-gradient-left', stops);\r\n\r\n      let rightEndOpacity = 0.85 + (0.95 - 0.85) * (rightWidth / leftWidth);\r\n      stops = [{offset: '0%', color: 'rgb(250, 250, 250)', opacity: 0.85},\r\n        {offset: '100%', color: 'rgb(250, 250, 250)', opacity: rightEndOpacity}];\r\n      addOverlayGradient('overlay-gradient-right', stops);\r\n    }\r\n    \r\n    addOverlayRect('overlay-gradient-right',\r\n      rightStart + overlayRectOffset / 2 + 0.5,\r\n      0, rightWidth, height + svgPaddings.top);\r\n    \r\n    addOverlayRect('overlay-gradient-left',\r\n      nodeCoordinate[0][0].x - overlayRectOffset / 2,\r\n      0, leftWidth, height + svgPaddings.top);\r\n\r\n    svg.selectAll('rect.overlay')\r\n      .on('click', emptySpaceClicked);\r\n    \r\n    // Add underneath rectangles\r\n    let underGroup = svg.select('g.underneath');\r\n    let padding = 7;\r\n    for (let n = 0; n < cnn[curLayerIndex - 1].length; n++) {\r\n      underGroup.append('rect')\r\n        .attr('class', 'underneath-gateway')\r\n        .attr('id', `underneath-gateway-${n}`)\r\n        .attr('x', nodeCoordinate[curLayerIndex - 1][n].x - padding)\r\n        .attr('y', nodeCoordinate[curLayerIndex - 1][n].y - padding)\r\n        .attr('width', (2 * nodeLength + hSpaceAroundGap) + 2 * padding)\r\n        .attr('height', nodeLength + 2 * padding)\r\n        .attr('rx', 10)\r\n        .style('fill', 'rgba(160, 160, 160, 0.3)')\r\n        .style('opacity', 0);\r\n      \r\n      // Update the event functions for these two layers\r\n      svg.select(`g#layer-${curLayerIndex - 1}-node-${n}`)\r\n        .style('pointer-events', 'all')\r\n        .style('cursor', 'pointer')\r\n        .on('mouseover', actPoolDetailViewPreNodeMouseOverHandler)\r\n        .on('mouseleave', actPoolDetailViewPreNodeMouseLeaveHandler)\r\n        .on('click', actPoolDetailViewPreNodeClickHandler);\r\n    }\r\n    underGroup.lower();\r\n\r\n    // Highlight the selcted pair\r\n    underGroup.select(`#underneath-gateway-${i}`)\r\n      .style('opacity', 1);\r\n  }\r\n\r\n  const quitIntermediateView = (curLayerIndex, g, i) => {\r\n    // If it is the softmax detail view, quit that view first\r\n    if (isInSoftmax) {\r\n      svg.select('.logit-layer').remove();\r\n      svg.select('.logit-layer-lower').remove();\r\n      svg.selectAll('.plus-symbol-clone').remove();\r\n\r\n      // Instead of removing the paths, we hide them, so it is faster to load in\r\n      // the future\r\n      svg.select('.underneath')\r\n        .selectAll('.logit-lower')\r\n        .style('opacity', 0);\r\n\r\n      softmaxDetailViewStore.set({\r\n          show: false,\r\n          logits: []\r\n      })\r\n\r\n      allowsSoftmaxAnimationStore.set(false);\r\n    }\r\n    isInSoftmaxStore.set(false);\r\n    isInIntermediateView = false;\r\n\r\n    // Show the legend\r\n    svg.selectAll(`.${selectedScaleLevel}-legend`)\r\n      .classed('hidden', !detailedMode);\r\n    svg.selectAll('.input-legend').classed('hidden', !detailedMode);\r\n    svg.selectAll('.output-legend').classed('hidden', !detailedMode);\r\n\r\n    // Recover control panel UI\r\n    disableControl = false;\r\n\r\n    // Recover the input layer node's event\r\n    for (let n = 0; n < cnn[curLayerIndex - 1].length; n++) {\r\n      svg.select(`g#layer-${curLayerIndex - 1}-node-${n}`)\r\n        .on('mouseover', nodeMouseOverHandler)\r\n        .on('mouseleave', nodeMouseLeaveHandler)\r\n        .on('click', nodeClickHandler);\r\n    }\r\n\r\n    // Clean up the underneath rects\r\n    svg.select('g.underneath')\r\n      .selectAll('rect')\r\n      .remove();\r\n    detailedViewNum = undefined;\r\n\r\n    // Highlight the previous layer and this node\r\n    svg.select(`g#cnn-layer-group-${curLayerIndex - 1}`)\r\n      .selectAll('rect.bounding')\r\n      .style('stroke-width', 1);\r\n    \r\n    d3.select(g[i])\r\n      .select('rect.bounding')\r\n      .style('stroke-width', 1);\r\n\r\n    // Highlight the labels\r\n    svg.selectAll(`g#layer-label-${curLayerIndex - 1},\r\n      g#layer-detailed-label-${curLayerIndex - 1},\r\n      g#layer-label-${curLayerIndex},\r\n      g#layer-detailed-label-${curLayerIndex}`)\r\n      .style('font-weight', 'normal');\r\n\r\n    // Also unclick the node\r\n    // Record the current clicked node\r\n    selectedNode.layerName = '';\r\n    selectedNode.index = -1;\r\n    selectedNode.data = null;\r\n    isExitedFromCollapse = true;\r\n\r\n    // Remove the intermediate layer\r\n    let intermediateLayer = svg.select('g.intermediate-layer');\r\n\r\n    // Kill the infinite animation loop\r\n    shouldIntermediateAnimateStore.set(false);\r\n\r\n    intermediateLayer.transition('remove')\r\n      .duration(500)\r\n      .ease(d3.easeCubicInOut)\r\n      .style('opacity', 0)\r\n      .on('end', (d, i, g) => { d3.select(g[i]).remove()});\r\n    \r\n    // Remove the output node overlay mask\r\n    svg.selectAll('.overlay-group').remove();\r\n    \r\n    // Remove the overlay rect\r\n    svg.selectAll('g.intermediate-layer-overlay, g.intermediate-layer-annotation')\r\n      .transition('remove')\r\n      .duration(500)\r\n      .ease(d3.easeCubicInOut)\r\n      .style('opacity', 0)\r\n      .on('end', (d, i, g) => {\r\n        svg.selectAll('g.intermediate-layer-overlay, g.intermediate-layer-annotation').remove();\r\n        svg.selectAll('defs.overlay-gradient').remove();\r\n      });\r\n    \r\n    // Recover the layer if we have drdrawn it\r\n    if (needRedraw[0] !== undefined) {\r\n      let redrawRange = cnnLayerRanges[selectedScaleLevel][needRedraw[0]];\r\n      if (needRedraw[1] !== undefined) {\r\n        svg.select(`g#layer-${needRedraw[0]}-node-${needRedraw[1]}`)\r\n          .select('image.node-image')\r\n          .each((d, i, g) => drawOutput(d, i, g, redrawRange));\r\n      } else {\r\n        svg.select(`g#cnn-layer-group-${needRedraw[0]}`)\r\n          .selectAll('image.node-image')\r\n          .each((d, i, g) => drawOutput(d, i, g, redrawRange));\r\n      }\r\n    }\r\n    \r\n    // Move all layers to their original place\r\n    for (let i = 0; i < numLayers; i++) {\r\n      moveLayerX({layerIndex: i, targetX: nodeCoordinate[i][0].x,\r\n        disable:false, delay:500, opacity: 1});\r\n    }\r\n\r\n    moveLayerX({layerIndex: numLayers - 2,\r\n      targetX: nodeCoordinate[numLayers - 2][0].x, opacity: 1,\r\n      disable:false, delay:500, onEndFunc: () => {\r\n        // Show all edges on the last moving animation end\r\n        svg.select('g.edge-group')\r\n          .style('visibility', 'visible');\r\n\r\n        // Recover the input annotation\r\n        svg.select('.input-annotation')\r\n          .classed('hidden', false);\r\n      }});\r\n  }\r\n\r\n  const nodeClickHandler = (d, i, g) => {\r\n    d3.event.stopPropagation();\r\n    let nodeIndex = d.index;\r\n\r\n    // Record the current clicked node\r\n    selectedNode.layerName = d.layerName;\r\n    selectedNode.index = d.index;\r\n    selectedNode.data = d;\r\n    selectedNode.domI = i;\r\n    selectedNode.domG = g;\r\n\r\n    // Record data for detailed view.\r\n    if (d.type === 'conv' || d.type === 'relu' || d.type === 'pool') {\r\n      let data = [];\r\n      for (let j = 0; j < d.inputLinks.length; j++) {\r\n        data.push({\r\n          input: d.inputLinks[j].source.output,\r\n          kernel: d.inputLinks[j].weight,\r\n          output: d.inputLinks[j].dest.output,\r\n        })\r\n      }\r\n      let curLayerIndex = layerIndexDict[d.layerName];\r\n      data.colorRange = cnnLayerRanges[selectedScaleLevel][curLayerIndex];\r\n      data.isInputInputLayer = curLayerIndex <= 1;\r\n      nodeData = data;\r\n    }\r\n\r\n    let curLayerIndex = layerIndexDict[d.layerName];\r\n\r\n    if (d.type == 'relu' || d.type == 'pool') {\r\n      isExitedFromDetailedView = false;\r\n      if (!isInActPoolDetailView) {\r\n        // Enter the act pool detail view\r\n        enterDetailView(curLayerIndex, d.index);\r\n      } else {\r\n        if (d.index === actPoolDetailViewNodeIndex) {\r\n          // Quit the act pool detail view\r\n          quitActPoolDetailView();\r\n        } else {\r\n          // Switch the detail view input to the new clicked pair\r\n\r\n          // Remove the previous selection effect\r\n          svg.select(`g#layer-${curLayerIndex}-node-${actPoolDetailViewNodeIndex}`)\r\n            .select('rect.bounding')\r\n            .classed('hidden', true);\r\n\r\n          svg.select(`g#layer-${curLayerIndex - 1}-node-${actPoolDetailViewNodeIndex}`)\r\n            .select('rect.bounding')\r\n            .classed('hidden', true);\r\n          \r\n          let edgeGroup = svg.select('g.cnn-group').select('g.edge-group');\r\n      \r\n          edgeGroup.selectAll(`path.edge-${curLayerIndex}-${actPoolDetailViewNodeIndex}`)\r\n            .transition()\r\n            .ease(d3.easeCubicOut)\r\n            .duration(200)\r\n            .style('stroke', edgeInitColor)\r\n            .style('stroke-width', edgeStrokeWidth)\r\n            .style('opacity', edgeOpacity);\r\n          \r\n          let underGroup = svg.select('g.underneath');\r\n          underGroup.select(`#underneath-gateway-${actPoolDetailViewNodeIndex}`)\r\n            .style('opacity', 0);\r\n        \r\n          // Add selection effect on the new selected pair\r\n          svg.select(`g#layer-${curLayerIndex}-node-${nodeIndex}`)\r\n            .select('rect.bounding')\r\n            .classed('hidden', false);\r\n\r\n          svg.select(`g#layer-${curLayerIndex - 1}-node-${nodeIndex}`)\r\n            .select('rect.bounding')\r\n            .classed('hidden', false);\r\n\r\n          edgeGroup.selectAll(`path.edge-${curLayerIndex}-${nodeIndex}`)\r\n            .raise()\r\n            .transition()\r\n            .ease(d3.easeCubicInOut)\r\n            .duration(400)\r\n            .style('stroke', edgeHoverColor)\r\n            .style('stroke-width', '1')\r\n            .style('opacity', 1);\r\n\r\n          underGroup.select(`#underneath-gateway-${nodeIndex}`)\r\n            .style('opacity', 1);\r\n\r\n          actPoolDetailViewNodeIndex = nodeIndex;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Enter the second view (layer-view) when user clicks a conv node\r\n    if ((d.type === 'conv' || d.layerName === 'output'  || d.type === 'fc') && !isInIntermediateView) {\r\n      prepareToEnterIntermediateView(d, g, nodeIndex, curLayerIndex);\r\n\r\n      if (d.layerName === 'conv2d_22') {\r\n        drawConv1(curLayerIndex, d, nodeIndex, width, height,\r\n          intermediateNodeMouseOverHandler, intermediateNodeMouseLeaveHandler,\r\n          intermediateNodeClicked);\r\n      }\r\n\r\n      else if (d.layerName === 'conv_1_2') {\r\n        drawConv2(curLayerIndex, d, nodeIndex, width, height,\r\n          intermediateNodeMouseOverHandler, intermediateNodeMouseLeaveHandler,\r\n          intermediateNodeClicked);\r\n      }\r\n\r\n      else if (d.layerName === 'conv2d_23') {\r\n        drawConv3(curLayerIndex, d, nodeIndex, width, height,\r\n          intermediateNodeMouseOverHandler, intermediateNodeMouseLeaveHandler,\r\n          intermediateNodeClicked);\r\n      }\r\n      \r\n      else if (d.layerName === 'conv_2_2') {\r\n        drawConv4(curLayerIndex, d, nodeIndex, width, height,\r\n          intermediateNodeMouseOverHandler, intermediateNodeMouseLeaveHandler,\r\n          intermediateNodeClicked);\r\n      }\r\n\r\n      else if (d.layerName === 'dense_22') {\r\n        drawFlatten(curLayerIndex, d, nodeIndex, width, height);\r\n      }\r\n\r\n      else if(d.layerName === 'output') {\r\n        drawOutFlatten(curLayerIndex, d, nodeIndex, width, height);\r\n      }\r\n    }\r\n    // Quit the layerview\r\n    else if ((d.type === 'conv' || d.layerName === 'output') && isInIntermediateView) {\r\n      quitIntermediateView(curLayerIndex, g, i);\r\n    }\r\n  }\r\n\r\n  const nodeMouseOverHandler = (d, i, g) => {\r\n    // if (isInIntermediateView || isInActPoolDetailView) { return; }\r\n    if (isInIntermediateView) { return; }\r\n\r\n    // Highlight the edges\r\n    let layerIndex = layerIndexDict[d.layerName];\r\n    let nodeIndex = d.index;\r\n    let edgeGroup = svg.select('g.cnn-group').select('g.edge-group');\r\n    \r\n    edgeGroup.selectAll(`path.edge-${layerIndex}-${nodeIndex}`)\r\n      .raise()\r\n      .transition()\r\n      .ease(d3.easeCubicInOut)\r\n      .duration(400)\r\n      .style('stroke', edgeHoverColor)\r\n      .style('stroke-width', '1')\r\n      .style('opacity', 1);\r\n    \r\n    // Highlight its border\r\n    d3.select(g[i]).select('rect.bounding')\r\n      .classed('hidden', false);\r\n    d3.select(g[i]).select('circle.bounding')\r\n      .classed('hidden', false);\r\n    \r\n    // Highlight source's border\r\n    if (d.inputLinks.length === 1) {\r\n      let link = d.inputLinks[0];\r\n      let layerIndex = layerIndexDict[link.source.layerName];\r\n      let nodeIndex = link.source.index;\r\n      svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n        .select('rect.bounding')\r\n        .classed('hidden', false);\r\n      svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n        .select('circle.bounding')\r\n        .classed('hidden', false);\r\n    } else {\r\n      svg.select(`g#cnn-layer-group-${layerIndex - 1}`)\r\n        .selectAll('g.node-group')\r\n        .selectAll('rect.bounding')\r\n        .classed('hidden', false);\r\n      svg.select(`g#cnn-layer-group-${layerIndex - 1}`)\r\n        .selectAll('g.node-group')\r\n        .selectAll('circle.bounding')\r\n        .classed('hidden', false);\r\n    }\r\n\r\n    // Highlight the output text\r\n    if (d.layerName === 'output') {\r\n      d3.select(g[i])\r\n        .select('.output-text')\r\n        .style('opacity', 0.8)\r\n        .style('text-decoration', 'underline');\r\n    }\r\n\r\n    /* Use the following commented code if we have non-linear model\r\n    d.inputLinks.forEach(link => {\r\n      let layerIndex = layerIndexDict[link.source.layerName];\r\n      let nodeIndex = link.source.index;\r\n      svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n        .select('rect.bounding')\r\n        .classed('hidden', false);\r\n    });\r\n    */\r\n  }\r\n\r\n  const nodeMouseLeaveHandler = (d, i, g) => {\r\n    // Screenshot\r\n    // return;\r\n\r\n    if (isInIntermediateView) { return; }\r\n    \r\n    // Keep the highlight if user has clicked\r\n    if (isInActPoolDetailView || (\r\n      d.layerName !== selectedNode.layerName ||\r\n      d.index !== selectedNode.index)){\r\n      let layerIndex = layerIndexDict[d.layerName];\r\n      let nodeIndex = d.index;\r\n      let edgeGroup = svg.select('g.cnn-group').select('g.edge-group');\r\n      \r\n      edgeGroup.selectAll(`path.edge-${layerIndex}-${nodeIndex}`)\r\n        .transition()\r\n        .ease(d3.easeCubicOut)\r\n        .duration(200)\r\n        .style('stroke', edgeInitColor)\r\n        .style('stroke-width', edgeStrokeWidth)\r\n        .style('opacity', edgeOpacity);\r\n\r\n      d3.select(g[i]).select('rect.bounding').classed('hidden', true);\r\n      d3.select(g[i]).select('circle.bounding').classed('hidden', true);\r\n\r\n      if (d.inputLinks.length === 1) {\r\n        let link = d.inputLinks[0];\r\n        let layerIndex = layerIndexDict[link.source.layerName];\r\n        let nodeIndex = link.source.index;\r\n        svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n          .select('rect.bounding')\r\n          .classed('hidden', true);\r\n        svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n          .select('circle.bounding')\r\n          .classed('hidden', true);\r\n      } else {\r\n        svg.select(`g#cnn-layer-group-${layerIndex - 1}`)\r\n          .selectAll('g.node-group')\r\n          .selectAll('rect.bounding')\r\n          .classed('hidden', d => d.layerName !== selectedNode.layerName ||\r\n            d.index !== selectedNode.index);\r\n        svg.select(`g#cnn-layer-group-${layerIndex - 1}`)\r\n          .selectAll('g.node-group')\r\n          .selectAll('circle.bounding')\r\n          .classed('hidden', d => d.layerName !== selectedNode.layerName ||\r\n            d.index !== selectedNode.index);\r\n      }\r\n\r\n      // Dehighlight the output text\r\n      if (d.layerName === 'output') {\r\n        d3.select(g[i])\r\n          .select('.output-text')\r\n          .style('fill', 'black')\r\n          .style('opacity', 0.5)\r\n          .style('text-decoration', 'none');\r\n      }\r\n\r\n      /* Use the following commented code if we have non-linear model\r\n      d.inputLinks.forEach(link => {\r\n        let layerIndex = layerIndexDict[link.source.layerName];\r\n        let nodeIndex = link.source.index;\r\n        svg.select(`g#layer-${layerIndex}-node-${nodeIndex}`)\r\n          .select('rect.bounding')\r\n          .classed('hidden', true);\r\n      });\r\n      */\r\n    }\r\n  }\r\n  let logits = [-4.28, 2.96, -0.38, 5.24, -7.56, -3.43, 8.63, 2.63, 6.30, 0.68];\r\n  let selectedI = 4;\r\n\r\n  onMount(async () => {\r\n    window.scrollTo(0,0);\r\n    // Create SVG\r\n    wholeSvg = d3.select(overviewComponent)\r\n      .select('#cnn-svg');\r\n    svg = wholeSvg.append('g')\r\n      .attr('class', 'main-svg')\r\n      .attr('transform', `translate(${svgPaddings.left}, 0)`);\r\n    svgStore.set(svg);\r\n\r\n    width = Number(wholeSvg.style('width').replace('px', '')) -\r\n      svgPaddings.left - svgPaddings.right;\r\n    height = Number(wholeSvg.style('height').replace('px', '')) -\r\n      svgPaddings.top - svgPaddings.bottom;\r\n\r\n    let cnnGroup = svg.append('g')\r\n      .attr('class', 'cnn-group');\r\n    \r\n    let underGroup = svg.append('g')\r\n      .attr('class', 'underneath');\r\n\r\n    let svgYMid = +wholeSvg.style('height').replace('px', '') / 2;\r\n    detailedViewAbsCoords = {\r\n      1 : [600, 100 + svgYMid - 220 / 2, 490, 290],\r\n      2: [500, 100 + svgYMid - 220 / 2, 490, 290],\r\n      3 : [700, 100 + svgYMid - 220 / 2, 490, 290],\r\n      4: [600, 100 + svgYMid - 220 / 2, 490, 290],\r\n      5: [650, 100 + svgYMid - 220 / 2, 490, 290],\r\n      6 : [850, 100 + svgYMid - 220 / 2, 490, 290],\r\n      7 : [100, 100 + svgYMid - 220 / 2, 490, 290],\r\n      8 : [60, 100 + svgYMid - 220 / 2, 490, 290],\r\n      9 : [200, 100 + svgYMid - 220 / 2, 490, 290],\r\n      10 : [300, 100 + svgYMid - 220 / 2, 490, 290],\r\n    }\r\n    \r\n    // Define global arrow marker end\r\n    svg.append(\"defs\")\r\n      .append(\"marker\")\r\n      .attr(\"id\", 'marker')\r\n      .attr(\"viewBox\", \"0 -5 10 10\")\r\n      .attr(\"refX\", 6)\r\n      .attr(\"refY\", 0)\r\n      .attr(\"markerWidth\", 6)\r\n      .attr(\"markerHeight\", 6)\r\n      .attr(\"orient\", \"auto\")\r\n      .append(\"path\")\r\n      .style('stroke-width', 1.2)\r\n      .style('fill', 'gray')\r\n      .style('stroke', 'gray')\r\n      .attr(\"d\", \"M0,-5L10,0L0,5\");\r\n\r\n    // Alternative arrow head style for non-interactive annotation\r\n    svg.append(\"defs\")\r\n      .append(\"marker\")\r\n      .attr(\"id\", 'marker-alt')\r\n      .attr(\"viewBox\", \"0 -5 10 10\")\r\n      .attr(\"refX\", 6)\r\n      .attr(\"refY\", 0)\r\n      .attr(\"markerWidth\", 6)\r\n      .attr(\"markerHeight\", 6)\r\n      .attr(\"orient\", \"auto\")\r\n      .append(\"path\")\r\n      .style('fill', 'none')\r\n      .style('stroke', 'gray')\r\n      .style('stroke-width', 2)\r\n      .attr(\"d\", \"M-5,-10L10,0L-5,10\");\r\n    \r\n    console.time('Construct cnn');\r\n    model = await loadTrainedModel('PUBLIC_URL/assets/data/model.json');\r\n    cnn = await constructCNN(`PUBLIC_URL/assets/img/${selectedImage}`, model);\r\n    console.timeEnd('Construct cnn');\r\n    \r\n\r\n    // Ignore the flatten layer for now\r\n    let flatten = cnn[cnn.length - 3];\r\n    cnn.splice(cnn.length - 3, 1);\r\n    cnn.flatten = flatten;\r\n    console.log(cnn);\r\n    cnnStore.set(cnn);\r\n    updateCNNLayerRanges();\r\n\r\n    // Create and draw the CNN view\r\n    drawCNN(width, height, cnnGroup, nodeMouseOverHandler,\r\n      nodeMouseLeaveHandler, nodeClickHandler);\r\n  })\r\n\r\n  const detailedButtonClicked = () => {\r\n    detailedMode = !detailedMode;\r\n    detailedModeStore.set(detailedMode);\r\n\r\n    if (!isInIntermediateView){\r\n      // Show the legend\r\n      svg.selectAll(`.${selectedScaleLevel}-legend`)\r\n        .classed('hidden', !detailedMode);\r\n      \r\n      svg.selectAll('.input-legend').classed('hidden', !detailedMode);\r\n      svg.selectAll('.output-legend').classed('hidden', !detailedMode);\r\n    }\r\n    \r\n    // Switch the layer name\r\n    svg.selectAll('.layer-detailed-label')\r\n      .classed('hidden', !detailedMode);\r\n    \r\n    svg.selectAll('.layer-label')\r\n      .classed('hidden', detailedMode);\r\n  }\r\n\r\n  const imageOptionClicked = async (e) => {\r\n    let newImageName = d3.select(e.target).attr('data-imageName');\r\n\r\n    if (newImageName !== selectedImage) {\r\n      selectedImage = newImageName;\r\n\r\n      // Re-compute the CNN using the new input image\r\n      cnn = await constructCNN(`PUBLIC_URL/assets/img/${selectedImage}`, model);\r\n\r\n\r\n      // Ignore the flatten layer for now\r\n      let flatten = cnn[cnn.length - 3];\r\n      cnn.splice(cnn.length - 3, 1);\r\n      cnn.flatten = flatten;\r\n      cnnStore.set(cnn);\r\n\r\n      // Update all scales used in the CNN view\r\n      updateCNNLayerRanges();\r\n      updateCNN();\r\n    }\r\n  }\r\n\r\n  const customImageClicked = () => {\r\n\r\n    // Case 1: there is no custom image -> show the modal to get user input\r\n    if (customImageURL === null) {\r\n      modalInfo.show = true;\r\n      modalInfo.preImage = selectedImage;\r\n      modalStore.set(modalInfo);\r\n    }\r\n\r\n    // Case 2: there is an existing custom image, not the focus -> switch to this image\r\n    else if (selectedImage !== 'custom') {\r\n      let fakeEvent = {detail: {url: customImageURL}};\r\n      handleCustomImage(fakeEvent);\r\n    }\r\n\r\n    // Case 3: there is an existing custom image, and its the focus -> let user\r\n    // upload a new image\r\n    else {\r\n      modalInfo.show = true;\r\n      modalInfo.preImage = selectedImage;\r\n      modalStore.set(modalInfo);\r\n    }\r\n\r\n    if (selectedImage !== 'custom') {\r\n      selectedImage = 'custom';\r\n    }\r\n\r\n  }\r\n\r\n  const handleModalCanceled = (event) => {\r\n    // User cancels the modal without a successful image, so we restore the\r\n    // previous selected image as input\r\n    selectedImage = event.detail.preImage;\r\n  }\r\n\r\n  const handleCustomImage = async (event) => {\r\n    // User gives a valid image URL\r\n    customImageURL = event.detail.url;\r\n\r\n    // Re-compute the CNN using the new input image\r\n    cnn = await constructCNN(customImageURL, model);\r\n\r\n    // Ignore the flatten layer for now\r\n    let flatten = cnn[cnn.length - 2];\r\n    cnn.splice(cnn.length - 2, 1);\r\n    cnn.flatten = flatten;\r\n    cnnStore.set(cnn);\r\n\r\n    // Update the UI\r\n    let customImageSlot = d3.select(overviewComponent)\r\n      .select('.custom-image').node();\r\n    drawCustomImage(customImageSlot, cnn[0]);\r\n\r\n    // Update all scales used in the CNN view\r\n    updateCNNLayerRanges();\r\n    updateCNN();\r\n  }\r\n\r\n  function handleExitFromDetiledConvView(event) {\r\n    if (event.detail.text) {\r\n      detailedViewNum = undefined;\r\n      svg.select(`rect#underneath-gateway-${selectedNodeIndex}`)\r\n        .style('opacity', 0);\r\n      selectedNodeIndex = -1; \r\n    }\r\n  }\r\n\r\n  function handleExitFromDetiledPoolView(event) {\r\n    if (event.detail.text) {\r\n      quitActPoolDetailView();\r\n      isExitedFromDetailedView = true;\r\n    }\r\n  }\r\n\r\n  function handleExitFromDetiledActivationView(event) {\r\n    if (event.detail.text) {\r\n      quitActPoolDetailView();\r\n      isExitedFromDetailedView = true;\r\n    }\r\n  }\r\n\r\n  function handleExitFromDetiledSoftmaxView(event) {\r\n    softmaxDetailViewInfo.show = false;\r\n    softmaxDetailViewStore.set(softmaxDetailViewInfo);\r\n  }\r\n\r\n</script>\r\n\r\n<style>\r\n  .overview {\r\n    padding: 0;\r\n    height: 100%;\r\n    width: 100%;\r\n    display: flex;\r\n    position: relative;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    align-items: flex-start;\r\n  }\r\n\r\n  .control-container {\r\n    padding: 5px 20px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    width: 100%;\r\n  }\r\n\r\n  .right-control {\r\n    display: flex;\r\n  }\r\n\r\n  .left-control {\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n\r\n  .control > .select > #level-select {\r\n    padding-left: 2em;\r\n    padding-right: 2em;\r\n  }\r\n\r\n  .cnn {\r\n    width: 100%;\r\n    padding: 0;\r\n    background: var(--light-gray);\r\n    display: flex;\r\n  }\r\n\r\n  svg {\r\n    margin: 0 auto;\r\n    min-height: 490px;\r\n    max-height: 700px;\r\n    height: calc(100vh - 100px);\r\n    width: 100vw;\r\n  }\r\n\r\n  .is-very-small {\r\n    font-size: 12px;\r\n  }\r\n\r\n  #detailed-button {\r\n    margin-right: 10px;\r\n    color: #dbdbdb;\r\n    transition: border-color 300ms ease-in-out, color 200ms ease-in-out;\r\n  }\r\n\r\n  #detailed-button.is-activated, #detailed-button.is-activated:hover {\r\n    color: #3273dc;\r\n    border-color: #3273dc;\r\n  }\r\n\r\n  #detailed-button:hover {\r\n    color: #b5b5b5;\r\n  }\r\n\r\n  #hover-label {\r\n    transition: opacity 300ms ease-in-out;\r\n    text-overflow: ellipsis;\r\n    pointer-events: none;\r\n    margin-left: 5px;\r\n  }\r\n\r\n  .image-container {\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 4px;\r\n    display: inline-block;\r\n    position: relative;\r\n    border: 2.5px solid #1E1E1E;\r\n    margin-right: 10px;\r\n    cursor: pointer;\r\n    pointer-events: all;\r\n    transition: border 300ms ease-in-out;\r\n  }\r\n\r\n  .image-container img {\r\n    object-fit: cover;\r\n    max-width: 100%;\r\n    max-height: 100%;\r\n    z-index: -1;\r\n    transition: opacity 300ms ease-in-out;\r\n  }\r\n\r\n  .image-container.inactive {\r\n    border: 2.5px solid rgb(220, 220, 220);\r\n  }\r\n\r\n  .image-container.inactive > img {\r\n    opacity: 0.3;\r\n  }\r\n\r\n  .image-container.inactive:hover > img {\r\n    opacity: 0.6;\r\n  }\r\n\r\n  .image-container.inactive.disabled {\r\n    border: 2.5px solid rgb(220, 220, 220);\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .image-container.inactive.disabled:hover {\r\n    border: 2.5px solid rgb(220, 220, 220);\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .image-container.inactive.disabled > img {\r\n    opacity: 0.3;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .image-container.inactive.disabled:hover > img {\r\n    opacity: 0.3;\r\n    cursor: not-allowed;\r\n  }\r\n\r\n  .image-container.inactive > .edit-icon {\r\n    color: #BABABA;\r\n  }\r\n\r\n  .image-container.inactive:hover > .edit-icon {\r\n    color: #777777;\r\n  }\r\n\r\n  .image-container.inactive:hover {\r\n    border: 2.5px solid #1E1E1E;\r\n  }\r\n\r\n  .edit-icon {\r\n    position: absolute;\r\n    bottom: -6px;\r\n    right: -7px;\r\n    font-size: 7px;\r\n    color: #1E1E1E;\r\n    transition: color 300ms ease-in-out;\r\n  }\r\n\r\n  :global(canvas) {\r\n    image-rendering: crisp-edges;\r\n  }\r\n\r\n  :global(.layer-label, .layer-detailed-label, .layer-intermediate-label) {\r\n    font-size: 12px;\r\n    opacity: 0.8;\r\n    text-anchor: middle;\r\n  }\r\n\r\n  :global(.colorLegend) {\r\n    font-size: 10px;\r\n  }\r\n\r\n  :global(.legend) {\r\n    transition: opacity 400ms ease-in-out;\r\n  }\r\n\r\n  :global(.legend > rect) {\r\n    opacity: 1;\r\n  }\r\n\r\n  :global(.legend text, .legend line, .legend path) {\r\n    opacity: 0.7;\r\n  }\r\n\r\n  :global(.legend#output-legend > rect) {\r\n    opacity: 1;\r\n  }\r\n\r\n  :global(.hidden) {\r\n    opacity: 0;\r\n    pointer-events: none;\r\n  }\r\n\r\n  :global(.very-strong) {\r\n    stroke-width: 3px;\r\n  }\r\n\r\n  :global(.bounding, .edge, .edge-group, foreignObject, .bounding-flatten,\r\n    .underneath-gateway, .input-annotation) {\r\n    transition: opacity 300ms ease-in-out;\r\n  }\r\n\r\n  :global(rect.bounding) {\r\n    transition: stroke-width 800ms ease-in-out, opacity 300ms ease-in-out;\r\n  }\r\n\r\n  :global(.annotation-text) {\r\n    pointer-events: none;\r\n    font-size: 10px;\r\n    font-style: italic;\r\n    fill: gray;\r\n  }\r\n\r\n  /* Change the cursor style on the detailed view input and output matrices */\r\n  :global(rect.square) {\r\n    cursor: crosshair;\r\n  }\r\n\r\n  :global(.animation-control-button) {\r\n    font-family: FontAwesome;\r\n    opacity: 0.8;\r\n    cursor: pointer;\r\n  }\r\n\r\n</style>\r\n\r\n<div class=\"overview\"\r\n  bind:this={overviewComponent}>\r\n\r\n  <div class=\"control-container\">\r\n\r\n    <div class=\"left-control\">\r\n      {#each imageOptions as image, i}\r\n        <div class=\"image-container\"\r\n          on:click={disableControl ? () => {} : imageOptionClicked}\r\n          class:inactive={selectedImage !== image.file}\r\n          class:disabled={disableControl}\r\n          data-imageName={image.file}>\r\n          <img src=\"PUBLIC_URL/assets/img/{image.file}\"\r\n            alt=\"image option\"\r\n            title=\"{image.class}\"\r\n            data-imageName={image.file}/>\r\n        </div>\r\n      {/each}\r\n\r\n      <!-- The plus button -->\r\n        <div class=\"image-container\"\r\n          class:inactive={selectedImage !== 'custom'}\r\n          class:disabled={disableControl}\r\n          data-imageName={'custom'}\r\n          on:click={disableControl ? () => {} : customImageClicked}>\r\n\r\n          <img class=\"custom-image\"\r\n            src=\"PUBLIC_URL/assets/img/plus.svg\"\r\n            alt=\"plus button\"\r\n            title=\"Add new input image\"\r\n            data-imageName=\"custom\"/>\r\n\r\n          <span class=\"fa-stack edit-icon\"\r\n            class:hidden={customImageURL === null}>\r\n            <i class=\"fas fa-circle fa-stack-2x\"></i>\r\n            <i class=\"fas fa-pen fa-stack-1x fa-inverse\"></i>\r\n          </span>\r\n\r\n        </div>\r\n\r\n      <button class=\"button is-very-small is-link is-light\"\r\n        id=\"hover-label\"\r\n        style=\"opacity:{hoverInfo.show ? 1 : 0}\">\r\n        <span class=\"icon\" style=\"margin-right: 5px;\">\r\n          <i class=\"fas fa-crosshairs \"></i>\r\n        </span>\r\n        <span id=\"hover-label-text\">\r\n          {hoverInfo.text}\r\n        </span>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- <div class=\"right-control\">\r\n\r\n      <button class=\"button is-very-small\"\r\n        id=\"detailed-button\"\r\n        disabled={disableControl}\r\n        class:is-activated={detailedMode}\r\n        on:click={detailedButtonClicked}>\r\n        <span class=\"icon\">\r\n          <i class=\"fas fa-eye\"></i>\r\n        </span>\r\n        <span id=\"hover-label-text\">\r\n          Show detail\r\n        </span>\r\n      </button>\r\n\r\n      <div class=\"control is-very-small has-icons-left\"\r\n        title=\"Change color scale range\">\r\n        <span class=\"icon is-left\">\r\n          <i class=\"fas fa-palette\"></i>\r\n        </span>\r\n\r\n        <div class=\"select\">\r\n          <select bind:value={selectedScaleLevel} id=\"level-select\"\r\n            disabled={disableControl}>\r\n            <option value=\"local\">Unit</option>\r\n            <option value=\"module\">Module</option>\r\n            <option value=\"global\">Global</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n    </div> -->\r\n    \r\n  </div>\r\n\r\n  <div class=\"cnn\">\r\n    <svg id=\"cnn-svg\"></svg>\r\n  </div>\r\n</div>\r\n\r\n<!-- <Article/> -->\r\n\r\n<div id='detailview'>\r\n  {#if selectedNode.data && selectedNode.data.type === 'conv' && selectedNodeIndex != -1}\r\n    <ConvolutionView on:message={handleExitFromDetiledConvView} input={nodeData[selectedNodeIndex].input} \r\n                      kernel={nodeData[selectedNodeIndex].kernel}\r\n                      dataRange={nodeData.colorRange}\r\n                      colorScale={nodeData.inputIsInputLayer ?\r\n                        layerColorScales.input[0] : layerColorScales.conv}\r\n                      isInputInputLayer={nodeData.inputIsInputLayer}\r\n                      isExited={isExitedFromCollapse}/>\r\n  {:else if selectedNode.data && selectedNode.data.type === 'relu'}\r\n    <ActivationView on:message={handleExitFromDetiledActivationView} input={nodeData[0].input} \r\n                    output={nodeData[0].output}\r\n                    dataRange={nodeData.colorRange}\r\n                    isExited={isExitedFromDetailedView}/>\r\n  {:else if selectedNode.data && selectedNode.data.type === 'pool'}\r\n    <PoolView on:message={handleExitFromDetiledPoolView} input={nodeData[0].input} \r\n              kernelLength={2}\r\n              dataRange={nodeData.colorRange}\r\n              isExited={isExitedFromDetailedView}/>\r\n  {:else if softmaxDetailViewInfo.show}\r\n    <SoftmaxView logits={softmaxDetailViewInfo.logits}\r\n                 logitColors={softmaxDetailViewInfo.logitColors}\r\n                 selectedI={softmaxDetailViewInfo.selectedI}\r\n                 highlightI={softmaxDetailViewInfo.highlightI}\r\n                 outputName={softmaxDetailViewInfo.outputName}\r\n                 outputValue={softmaxDetailViewInfo.outputValue}\r\n                 startAnimation={softmaxDetailViewInfo.startAnimation}\r\n                 on:xClicked={handleExitFromDetiledSoftmaxView}\r\n                 on:mouseOver={softmaxDetailViewMouseOverHandler}\r\n                 on:mouseLeave={softmaxDetailViewMouseLeaveHandler}/>\r\n  {/if}\r\n</div>\r\n\r\n<Modal on:xClicked={handleModalCanceled}\r\n  on:urlTyped={handleCustomImage}/>",
    "<script>\r\n  import Overview from \"../overview/Overview.svelte\";\r\n  import Article from \"../article/article.svelte\";\r\n  import { cnnStore } from \"../stores.js\";\r\n  import { link } from \"svelte-spa-router\";\r\n\r\n  // Enum to control the displaying view\r\n  const View = {\r\n    OVERVIEW: \"overview\",\r\n    LAYERVIEW: \"layerview\",\r\n    DETAILVIEW: \"detailview\"\r\n  };\r\n\r\n  let mainView = View.OVERVIEW;\r\n\r\n  /* Example to read loaded cnn in other components:\r\n  $: if ( $cnnStore.length != 0) {\r\n    console.log($cnnStore);\r\n  }\r\n  */\r\n</script>\r\n\r\n<style>\r\n  #article{\r\n    border-bottom: solid 2px rgb(211, 208, 208);\r\n  }\r\n  #explainer {\r\n    width: 100%;\r\n    padding: 0;\r\n    margin: auto;\r\n    /* outline: 1px solid var(--g-dark-gray); */\r\n  }\r\n  #foot{\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    max-width: 78ch;\r\n    position:relative;\r\n    border-top: solid 1px #eee;\r\n  }\r\n  #foot .lasttext p{\r\n    padding-top: 10px;\r\n    font-style: italic;\r\n    font-size: 18px;\r\n    color: rgb(226, 195, 90);\r\n  }\r\n  #foot .addition p{\r\n    color: #555;\r\n    font-size: 17px;\r\n    line-height: 1.6;\r\n  }\r\n  .return {\r\n    position: absolute;\r\n    right: -300px;\r\n    top: 80%;\r\n    font-size: 20px;\r\n    font-style: italic;\r\n    color: steelblue;\r\n  }\r\n  .title{\r\n    font-style: italic;\r\n    color: steelblue;\r\n    font-size: 24px;\r\n    font-weight: 450;\r\n    margin-bottom: 8px;\r\n    margin-top: 44px;\r\n  }\r\n</style>\r\n<div id=\"article\">\r\n  <Article />\r\n</div>\r\n<div id=\"explainer\">\r\n  <Overview />\r\n</div>\r\n<footer id=\"foot\">\r\n    <p class='title'>扩展与补充</p>\r\n    <div class=\"addition\">\r\n      <p>CNN除了能够进行图像分类任务之外，还能够用于图像分割、目标检测等一些更加复杂的任务。同时，由于它的参数共享机制，使得相比于神经网络而已有着更少的网络参数量。在研究者们的努力之下，各种更新更有效的网络设计以及卷积方式得以被提出。CNN还有许多有趣的地方等待着你的探索。</p>\r\n    </div>\r\n    <a href=\"/\" use:link rel=\"prefetch\">\r\n        <div class=\"return\">返回</div>\r\n    </a>\r\n</footer>",
    "<script>\r\n  export let input1 ;\r\n  export let input2 ;\r\n  export let weight1 ;\r\n  export let weight2 ;\r\n  let output ;\r\n\r\n  import { createEventDispatcher } from 'svelte';\r\n  import Graph1Dataview from './Graph1_Dataview.svelte';\r\n  \r\n  const dispatch = createEventDispatcher();\r\n\r\n  function calculate(){\r\n    output  = input1 * weight1 + input2 * weight2;\r\n  }\r\n  function handleMouseover(event) {\r\n    let outputMappings = generateOutputMappings(stride, output, kernel.length, image.length, dilation);\r\n    outputHighlights = array1d(output.length * output.length, (i) => false);\r\n    const animatedH = event.detail.hoverH;\r\n    const animatedW = event.detail.hoverW;\r\n    outputHighlights[animatedH * output.length + animatedW] = true;\r\n    inputHighlights = compute_input_multiplies_with_weight(animatedH, animatedW, image.length, kernel.length, outputMappings, kernel.length)\r\n    isPaused = true;\r\n    dispatch('message', {\r\n      text: isPaused\r\n    });\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .wrapper {\r\n    display: flex;\r\n    flex-direction: row;\r\n    align-items: flex-end;\r\n  }\r\n\r\n  .column {\r\n    padding: 5px 10px 10px 10px;\r\n  }\r\n\r\n  .header-text {\r\n    line-height: 1.1;\r\n  }\r\n</style>\r\n\r\n<div class=\"wrapper\">\r\n  <div class=\"column has-text-centered\">\r\n    <div class=\"header-text\">\r\n      2 inputs and 1 output<br/>\r\n    </div>\r\n    <Graph1Dataview on:message={handleMouseover}  input1={input1} input2={input2} weight1={weight1}\r\n            weight2={weight2} output={output}/>\r\n    <p>output:{output}</p>\r\n    <button on:click={calculate}>new output</button>\r\n  </div>\r\n</div>",
    "<script>\r\n  import Graph1Animator from './Graph1_Animator.svelte';\r\n  let inputNode1 ;\r\n  let inputNode2 ;\r\n  let weight_1 ;\r\n  let weight_2 ;\r\n\r\n  function handleClickPause() {\r\n    isPaused = !isPaused;\r\n  }\r\n\r\n  function handlePauseFromInteraction(event) {\r\n    isPaused = event.detail.text;\r\n  }\r\n\r\n</script>\r\n\r\n<style>\r\n  .control-button {\r\n    position: absolute;\r\n    top: 5px;\r\n    right: 15px;\r\n    color: gray;\r\n    font-size: 22px;\r\n    opacity: 0.4;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .control-button:hover {\r\n    opacity: 0.8;\r\n  }\r\n\r\n  .box {\r\n    padding: 5px 30px 20px 30px;\r\n    position: relative;\r\n  }\r\n\r\n  .left-part {\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin-top: 30px;\r\n  }\r\n\r\n  .right-part {\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: center;\r\n    align-items: center;\r\n  }\r\n\r\n  .content-container {\r\n    display: flex;\r\n    justify-content: space-around;\r\n  }\r\n\r\n  .field {\r\n    padding-top: 5px;\r\n  }\r\n\r\n  .annotation {\r\n    display: flex;\r\n    align-items: center;\r\n    padding-left : 10px;\r\n  }\r\n\r\n  .annotation-text-hyper {\r\n    font-size: 15px;\r\n    font-style: italic;\r\n  }\r\n\r\n  .annotation > img {\r\n    width: 20px;\r\n    margin-right: 5px;\r\n  }\r\n\r\n  .is-very-small {\r\n    font-size: 12px; \r\n  }\r\n\r\n  .field {\r\n    align-items: center;\r\n  }\r\n\r\n  .field-label.is-normal {\r\n    padding-top: 0;\r\n  }\r\n\r\n  .field:not(:last-child) {\r\n    margin-bottom: 7px;\r\n  }\r\n\r\n  label {\r\n    display: inline-block;\r\n    width: 105px;\r\n    text-align: right;\r\n    font-weight: 500;\r\n    color: #4a4a4a;\r\n  } \r\n\r\n  input[type=number] {\r\n    width: 50px;\r\n  }\r\n\r\n  input[type=range] {\r\n    width: 160px;\r\n  }\r\n</style>\r\n\r\n<div class=\"container has-text-centered\" id=\"detailview-container\">\r\n  <div class=\"box\">\r\n\r\n    <div class=\"content-container\">\r\n      <div class=\"left-part\">\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Input Node1:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={inputNode1}>\r\n          </div>\r\n        </div>\r\n\r\n      <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Input Node2:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={inputNode2}>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Weight1:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={weight_1}>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"input-row\">\r\n          <div class=\"field is-horizontal\">\r\n            <div class=\"field-label is-normal\">\r\n              <label class=\"label\">Weight2:</label>\r\n            </div>\r\n            <input class=\"input is-very-small\" type=\"number\" bind:value={weight_2}>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n\r\n        <div class=\"right-part\">\r\n          <Graph1Animator on:message={handlePauseFromInteraction} \r\n            input1={inputNode1} input2={inputNode2} weight1={weight_1}\r\n            weight2={weight_2}/>       \r\n        </div>\r\n\r\n    </div>\r\n\r\n  </div>\r\n</div>",
    "<script>\r\n    import { onMount } from 'svelte';\r\n    import { link } from \"svelte-spa-router\";\r\n    let outdata;\r\n    let sortdata;\r\n    var kdata;\r\n    const color = {\"山鸢尾\": 'red', \"杂色鸢尾\":'steelblue', \"维吉尼亚鸢尾\":'green'};\r\n    const en2ch = {\"Iris-setosa\": \"山鸢尾\", \"Iris-versicolor\":\"杂色鸢尾\", \"Iris-virginica\":\"维吉尼亚鸢尾\"};\r\n    const arrcolor = ['red', 'steelblue', 'green'];\r\n    const labels = [\"山鸢尾\", \"杂色鸢尾\", \"维吉尼亚鸢尾\"];\r\n    const margin = {top: 20, right: 10, bottom: 10, left: 40};\r\n    const height = 280;\r\n    const width = 500;\r\n    const r = 3.5;\r\n    let counts = {\"山鸢尾\": 0, \"杂色鸢尾\": 0, \"维吉尼亚鸢尾\": 0};\r\n    let testlabel = \"\";\r\n    let k = 15;\r\n    let svg;\r\n    let gtext, plusText;\r\n    let xAxis;\r\n    let yAxis;\r\n    let y, ry;\r\n    let x, rx;\r\n    let point = {};\r\n    let svglink;\r\n    let strlegend;\r\n\r\n    \r\n    onMount(async () => {\r\n        // window.location.hash = \"#article\";\r\n        window.scrollTo(0,0);\r\n        strlegend = swatches({\r\n            color: d3.scaleOrdinal(labels, arrcolor)\r\n        })\r\n        const data = await d3.csv(\"PUBLIC_URL/assets/data/Iris.csv\");\r\n        // const data = d3.csvParse(await FileAttachment(\"PUBLIC_URL/assets/data/us-population-state-age.csv\").text(), d3.autoType);\r\n        // const ages = data.columns.slice(1);\r\n        // for (const d of data) d.total = d3.sum(ages, age => d[age]);\r\n        // outdata = ages.flatMap(age => data.map(d => ({name: d.name, age, value: d[age] / d.total})));\r\n\r\n        const newlabels = data.columns.slice(1);\r\n        outdata = data.map(d => ({x: d.SepalLengthCm * 10, y: d.PetalLengthCm * 10, label: en2ch[d.Species]}));\r\n\r\n        y = d3.scaleLinear()\r\n            .domain(d3.extent(outdata, d => d.y))\r\n            .range([margin.top, height - margin.bottom]);\r\n\r\n        ry = d3.scaleLinear()\r\n            .domain([margin.top, height - margin.bottom])\r\n            .range(d3.extent(outdata, d => d.y));\r\n\r\n        x = d3.scaleLinear()\r\n            .domain(d3.extent(outdata, d => d.x))\r\n            .range([margin.left + 10, width - margin.right]);  \r\n \r\n        rx = d3.scaleLinear()\r\n            .domain([margin.left + 10, width - margin.right])\r\n            .range(d3.extent(outdata, d => d.x));    \r\n\r\n        yAxis = g => g.attr(\"transform\", `translate(${margin.left},0)`)\r\n            .call(d3.axisLeft(y).ticks(10))\r\n            .call(g => g.selectAll(\".tick line\").clone().attr(\"stroke-opacity\", 0.1).attr(\"x2\", width - margin.right - margin.left))\r\n            .call(g => g.selectAll(\".domain\").remove());\r\n\r\n        xAxis = g => g.attr(\"transform\", `translate(0,${margin.top})`)\r\n            .call(d3.axisTop(x).ticks(20))\r\n            .call(g => g.selectAll(\".tick line\").clone().attr(\"stroke-opacity\", 0.1).attr(\"y2\", height - margin.bottom - margin.top))\r\n            .call(g => g.selectAll(\".domain\").remove())\r\n\r\n        svg = d3.select('#knn-svg')\r\n        .attr(\"viewBox\", [0, 0, width, height]);\r\n\r\n        svg.append(\"g\")\r\n            .style(\"pointer-events\", \"none\")\r\n            .call(xAxis);\r\n\r\n        svg.append(\"text\")\r\n            .attr(\"transform\", `translate(${5},${height - 10})`)\r\n            .style(\"font-size\", \"10px\")\r\n            .attr('class', 'annotation-text')\r\n            .text(\"花瓣长度（mm)\");   \r\n        \r\n        svg.append(\"g\")\r\n            .style(\"pointer-events\", \"none\")\r\n            .call(yAxis);\r\n\r\n        svg.append(\"text\")\r\n            .attr(\"transform\", `translate(${width - 80},${margin.top + 10})`)\r\n            .attr('class', 'annotation-text')\r\n            .style(\"font-size\", \"10px\")\r\n            .text(\"花萼长度（mm)\");   \r\n\r\n        svg.append(\"g\")\r\n            .attr(\"class\", \"tcircles\")\r\n            .attr(\"fill\", \"none\")\r\n            .attr(\"pointer-events\", \"all\")\r\n            .selectAll(\"circle\")\r\n            .data(outdata)   \r\n            .join(\"circle\")\r\n            .attr(\"stroke\", d => color[d.label])\r\n            .attr(\"r\", r)\r\n            .attr(\"cx\", d => x(d.x))\r\n            .attr(\"cy\", d => y(d.y))\r\n            .append(\"title\")\r\n            .text(d => `品种: ${d.label}  位置:(${(d.x)},  ${d.y})`);\r\n\r\n        const circles = d3.range(1).map(i => ({\r\n            x: 56,\r\n            y: 25,\r\n        }));\r\n        point.x = 56;\r\n        point.y = 25;\r\n        svg.append('g')\r\n            .selectAll(\"circle\")\r\n            .data(circles)\r\n            .join(\"circle\")\r\n            .attr(\"fill\", \"yellow\")\r\n            .attr(\"stroke\", \"#C4C400\")\r\n            .attr(\"r\", r)\r\n            .attr(\"cx\", d => x(d.x))\r\n            .attr(\"cy\", d => y(d.y))\r\n            .style(\"cursor\", \"move\")\r\n            .call(d3.drag()\r\n                    .on(\"start\", dragstarted)\r\n                    .on(\"drag\", dragged)\r\n                    .on(\"end\", dragended));\r\n        sortdata = outdata;\r\n        sortdata.sort((a, b) =>{\r\n            let distance1 = (a.x - point.x)**2 + (a.y - point.y)**2;\r\n            let distance2 = (b.x - point.x)**2 + (b.y - point.y)**2;\r\n            return distance1 - distance2;\r\n        })\r\n        kdata = sortdata.slice(0, k);\r\n        svglink = svg.insert(\"g\", \".tcircles\")\r\n            .attr(\"id\", \"lines\")\r\n            .selectAll(\"line\")\r\n            .data(kdata)\r\n            .join(\"line\")\r\n            .attr(\"stroke\", d => color[d.label])\r\n            .style('opacity', 0.5)\r\n            .attr(\"x1\", x(point.x))\r\n            .attr(\"y1\", y(point.y))\r\n            .attr(\"x2\", d => x(d.x))\r\n            .attr(\"y2\", d => y(d.y))\r\n        \r\n        d3.select('#num-k').text(\"k = \" + k);\r\n        d3.select(\"#add-layers\").on(\"click\", () => {\r\n            k++;\r\n            let diff = 1;\r\n            if (k > 30) {\r\n                k = 30;\r\n                diff = 0;\r\n            }\r\n            d3.select(\"#num-k\").text(\"k = \" + k);\r\n            drawklines(diff);\r\n        });\r\n\r\n        d3.select(\"#remove-layers\").on(\"click\", () => {\r\n            k--;\r\n            let diff = -1;\r\n            if (k <= 0) {\r\n                k = 1;\r\n                diff = 0;\r\n            }\r\n            d3.select(\"#num-k\").text(\"k = \" + k);\r\n            drawklines(diff);\r\n        });\r\n        countlabelnums();\r\n    })\r\n\r\n    function drawklines(diff){\r\n        sortdata.sort((a, b) =>{\r\n            let distance1 = (a.x - point.x)**2 + (a.y - point.y)**2;\r\n            let distance2 = (b.x - point.x)**2 + (b.y - point.y)**2;\r\n            return distance1 - distance2;\r\n        });\r\n        kdata = sortdata.slice(0, k);\r\n        if(diff > 0){\r\n            svglink = d3.select(\"#lines\").selectAll(\"line\");\r\n            svglink.data(kdata)\r\n            .enter()\r\n            .append('line')\r\n            .transition()\r\n            .duration(1000)\r\n            .attr(\"stroke\", d => color[d.label]) \r\n            .style('opacity', 0.5)\r\n            .attr(\"x1\", x(point.x))\r\n            .attr(\"y1\", y(point.y))\r\n            .attr(\"x2\", d => x(d.x))\r\n            .attr(\"y2\", d => y(d.y));\r\n\r\n        }else if(diff < 0){\r\n            svglink = d3.select(\"#lines\").selectAll(\"line\");\r\n            svglink.data(kdata)\r\n            .exit()\r\n            .transition()\r\n            .duration(100)\r\n            .remove()\r\n            .attr(\"stroke\", d => color[d.label])\r\n            .style('opacity', 0.5)\r\n            .attr(\"x1\", x(point.x))\r\n            .attr(\"y1\", y(point.y))\r\n            .attr(\"x2\", d => x(d.x))\r\n            .attr(\"y2\", d => y(d.y));\r\n\r\n        }else{\r\n            svglink.data(kdata)\r\n            .transition()\r\n            .duration(1000)\r\n            .attr(\"x1\", x(point.x))\r\n            .attr(\"y1\", y(point.y))\r\n            .attr(\"x2\", d => x(d.x))\r\n            .attr(\"y2\", d => y(d.y))\r\n            .attr(\"stroke\", d => color[d.label]) \r\n            .style('opacity', 0.5);\r\n        }\r\n    }\r\n\r\n    function dragstarted(d){\r\n        svglink = d3.select(\"#lines\").selectAll(\"line\");\r\n        d3.select(this).attr(\"stroke\", \"black\");\r\n    }\r\n\r\n    function dragged(d){\r\n        d3.select(this).raise().attr(\"cx\", d.x = d3.event.x).attr(\"cy\", d.y = d3.event.y);\r\n        point.x = rx(d3.event.x)\r\n        point.y = ry(d3.event.y)\r\n        svglink.data(kdata)\r\n            .attr(\"x1\", x(point.x))\r\n            .attr(\"y1\", y(point.y))\r\n            .attr(\"x2\", d => x(d.x))\r\n            .attr(\"y2\", d => y(d.y))\r\n    }\r\n    function dragended(d){\r\n        d3.select(this).attr(\"stroke\", \"#C4C400\");\r\n        if(d3.event.x > width - margin.right || d3.event.x < margin.left + 10){\r\n            d3.select(this).attr(\"cx\", d.x = x(50));\r\n            point.x = 50;\r\n        }else if(d3.event.y > height - margin.bottom || d3.event.y < margin.top){\r\n            d3.select(this).attr(\"cy\", d.y = y(50));\r\n            point.y = 50;\r\n        }else{\r\n            point.x = rx(d3.event.x)\r\n            point.y = ry(d3.event.y) \r\n        }\r\n        drawklines(0);\r\n        countlabelnums();\r\n    }\r\n\r\n    function countlabelnums(){\r\n        counts = {\"山鸢尾\": 0, \"杂色鸢尾\": 0, \"维吉尼亚鸢尾\": 0};\r\n        for(let i=0; i<k; ++i){\r\n            counts[kdata[i].label] += 1;\r\n        }\r\n        let max_num = 0;\r\n        let keys = Object.keys(counts);\r\n        for(let i=0; i<keys.length; ++i){\r\n            if(counts[keys[i]] > max_num){\r\n                max_num = counts[keys[i]];\r\n                testlabel = keys[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    function swatches({\r\n        color,\r\n        format = x => x,\r\n        swatchSize = 20,\r\n        swatchWidth = swatchSize,\r\n        swatchHeight = swatchSize,\r\n        marginLeft = 0\r\n    }) {\r\n        const id = 'color-legend2';\r\n    \r\n        return `<div style=\"display: flex; align-items: center; min-height: 33px; margin-left: ${+marginLeft}px; font: 12px sans-serif; float: right\">\r\n        <style>\r\n\r\n        .${id} {\r\n        pointer-events: none;\r\n        display: inline-flex;\r\n        align-items: flex-end;\r\n        margin-right: 2em;\r\n        font-style: italic;\r\n        fill: gray;\r\n        }\r\n\r\n        .${id}::before {\r\n        content: \"\";\r\n        width: ${+swatchWidth}px;\r\n        height: ${+swatchHeight}px;\r\n        margin-right: 0.5em;\r\n        margin-top: 10px;\r\n        background: var(--color);\r\n        }\r\n\r\n        </style>\r\n        <div>${color.domain().map(\r\n            value => `<span class=\"${id}\" style=\"--color: ${color(value)}\">${value}</span>`).join(\"\")}</div>`;\r\n    }\r\n</script>\r\n\r\n<style>\r\n    #knnarticle{\r\n        margin-top:60px;\r\n        margin-bottom: 60px;\r\n        margin-left: auto;\r\n        margin-right: auto;\r\n        max-width: 78ch;\r\n    }\r\n    #knn{\r\n        position:relative;\r\n        width: 100%;\r\n        height: 680px;\r\n        margin-bottom: 10px;\r\n        font-family: \"Helvetica\", \"Arial\", sans-serif;\r\n        background-color: #f7f7f7;\r\n    }\r\n    #foot{\r\n        margin-left: auto;\r\n        margin-right: auto;\r\n        max-width: 78ch;\r\n        position:relative;\r\n        border-top: solid 1px #eee;\r\n        padding: 20px 20px;\r\n    }\r\n    .footbody p{\r\n        margin: 16px 0;\r\n        color: #555;\r\n        font-size: 17px;\r\n        line-height: 1.6;\r\n    }\r\n    #foot .lasttext{\r\n        font-style: italic;\r\n        font-size: 20px;\r\n        color: peru;\r\n    }\r\n\r\n\t.box {\r\n        pointer-events: none;\r\n\t\twidth: 150px;\r\n\t\tborder: 1px solid #aaa;\r\n\t\tborder-radius: 2px;\r\n\t\tbox-shadow: 2px 2px 8px rgba(0,0,0,0.1);\r\n\t\tpadding: 1em;\r\n\t\tmargin: 0 0 0.5em 0;\r\n        position:absolute;\r\n        left: 1235px;\r\n        top:-568px;\r\n        border-radius: 5px;\r\n\t}\r\n    .box1 {\r\n        position:relative;\r\n        left:20%;\r\n        top:30px;\r\n\t\twidth: 880px;\r\n\t\tborder: 1px solid #aaa;\r\n\t\tborder-radius: 2px;\r\n\t\tbox-shadow: 2px 2px 8px rgba(0,0,0,0.1);\r\n\t\tpadding: 1em;\r\n\t\tmargin: 0 0 0.5em 0;\r\n        border-radius: 5px;\r\n        background: white;\r\n\t}\r\n    .clearfix{\r\n        position:relative;\r\n        left:20%;\r\n        top:30px;\r\n        width: 880px;\r\n\t\tborder: 1px solid #aaa;\r\n\t\tborder-radius: 2px;\r\n\t\tbox-shadow: 2px 2px 8px rgba(0,0,0,0.1);\r\n\t\tpadding: 1em;\r\n\t\tmargin: 0 0 0.5em 0;\r\n        border-radius: 5px;\r\n        background: white;\r\n    }\r\n    .clearfix:after {\r\n        content: '.';\r\n        display: block;\r\n        height: 0;\r\n        clear: both;\r\n        visibility: hidden;\r\n    }\r\n    #num-k{\r\n        font-style: italic;\r\n        fill: gray;\r\n        pointer-events: none;\r\n    }\r\n    .return {\r\n        position: absolute;\r\n        right: -300px;\r\n        top: 80%;\r\n        font-size: 20px;\r\n        font-style: italic;\r\n        color: steelblue;\r\n    }\r\n    .title{\r\n        font-style: italic;\r\n        color: steelblue;\r\n        font-size: 24px;\r\n        font-weight: 450;\r\n        margin-bottom: 8px;\r\n        margin-top: 44px;\r\n    }\r\n\r\n    #knnarticle p{\r\n        margin: 16px 0;\r\n        color: #555;\r\n        font-size: 17px;\r\n        line-height: 1.6;\r\n    }\r\n    #explain{\r\n        position: relative;\r\n        left: 74%;\r\n        top: -554px;\r\n    }\r\n    #explain p{\r\n        max-width: 20ch;\r\n        pointer-events: none;\r\n        font-size: 10px;\r\n        font-style: italic;\r\n        fill: gray;\r\n    }\r\n</style>\r\n\r\n<article id=\"knnarticle\">\r\n    <div id=\"One\"><h1>Section: KNN</h1></div>\r\n    <p>\r\n        <strong>\r\n            你将之前测量的花瓣的长度x1，花萼的长度x2，在坐标轴上画出了他们的分布（x1,\r\n\t\t\tx2）。你发现了从这个二维的坐标平面上似乎比之前的用“树”的结构来表示判断条件更为直观。\r\n\t\t\t那在这个坐标平面上要如何对鸢尾花进行分类预测呢？  \r\n        </strong>\r\n    </p>\r\n    <div class=\"l--body\">\r\n      <h2 class=\"title\">什么是KNN?</h2>\r\n      <p>KNN的基本思想有点类似“物以类聚，人以群分”，打个通俗的比方就是“如果你要了解一个人，可以从他最亲近的几个朋友去推测他是什么样的人”。\r\n      在分类领域，对于一个未知点，选取K个距离（可以是欧氏距离，也可以是其他相似度度量指标）最近的点，然后统计这K个点，在这K个点中频数最多的那一类就作为分类结果。</p>\r\n    </div>\r\n\r\n    <div class=\"l--body\">\r\n      <h2 class=\"title\">KNN算法的可视化</h2>\r\n      <p>将鸢尾花数据根据花萼长度及花瓣长度绘制在坐标轴中，其中每一点都代表一个已知的样本，且图像中两点之间的距离便代表了它们之间的相似度。</p>\r\n      <p>当有一个未知品种的鸢尾花时，根据它的两个特征将之绘制在图中，便可以找到它的K个最近邻。</p>\r\n    </div>\r\n\r\n    <div class=\"l--body\">\r\n      <h2 class=\"title\">尝试一下</h2>\r\n      <p>你根据要求绘制好了可视化图像，并将未知品种的鸢尾花以黄点标注在了图中。</p>\r\n      <p>拖动黄点试试吧，右上角会显示此时样本的预测类别，以及距离最近的K个样本的种类数目。</p>\r\n    </div>\r\n</article>\r\n\r\n\r\n<div id=\"knn\">\r\n    <div id=\"top-legends\" class=\"clearfix\">\r\n        <div style=\"float: left; margin-right: 5px;\">\r\n            <div class=\"ui-numHiddenLayers\" style=\"float: left; margin-right: 15px;\">\r\n                <button id=\"add-layers\" class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab\">\r\n                    <i class=\"material-icons\">add</i>\r\n                </button>\r\n                <button id=\"remove-layers\" class=\"mdl-button mdl-js-button mdl-button--fab mdl-button--mini-fab\">\r\n                    <i class=\"material-icons\">remove</i>\r\n                </button>\r\n            </div>\r\n            <span id=\"num-k\" style=\"float: left; margin-right: 5px; font-size: 25px\"></span>\r\n        </div>\r\n\r\n        {@html strlegend}\r\n    </div>\r\n    <div id=\"knn-graph\">\r\n        <div class=\"box1\"> \r\n            <svg id=\"knn-svg\"></svg>\r\n        </div>\r\n        <div class=\"box\" style=\"position: relative;\">\r\n            <slot>\r\n                <p style=\"font-size: 25px; font-style: italic; color: steelblue;\">{testlabel} </p>\r\n                {#each labels as label, i}\r\n                    <p style=\"font-style: italic;fill: gray;\">{label} : {counts[label]}</p>\r\n                {/each}\r\n            </slot>\r\n        </div>\r\n    </div>\r\n    <div id=\"explain\">\r\n        <p>黄点为未知的鸢尾花样本它的预测类别以及它邻近样本的类别会在上方显示</p>\r\n        <p>接着再拖动它试试吧 !</p>\r\n    </div>\r\n</div>\r\n\r\n<footer id=\"foot\">\r\n    <div class=\"footbody\">\r\n      <h3 class='title'>扩展与补充</h3>\r\n      <p>KNN方法思路简单，易于理解，易于实现，无需估计参数，无需训练, 是一个理论上比较成熟的方法，也是最简单的机器学习算法之一，比较适用于比较大的类域的自动分类。但KNN也有自己的不足之处，它的计算量比较大，同时在不同类别的样本数量差距较大时，结果容易受到大样本的影响。</p>\r\n      <p>目前针对KNN也有着许多的改进方法，值得你的进一步的探索了解。</p>\r\n    </div>\r\n    <div class=\"lasttext\">\r\n      <p>尝试过KNN的你发现虽然这个方法简单直观，但效果并没有想象中那么好，同时k值的设定也是一个难题，因此你开始寻找有没有更好的方法来识别鸢尾花的品种。</p>\r\n    </div>\r\n    <a href=\"/\" use:link rel=\"prefetch\">\r\n        <div class=\"return\">返回</div>\r\n    </a>\r\n</footer>\r\n",
    "<script type=\"text/javascript\">\r\n    import { onMount } from 'svelte';\r\n    import { link } from \"svelte-spa-router\";\r\n    var m = [20, 120, 20, 120],\r\n        w = 1500 ,\r\n        h = 500 ,\r\n        i = 0,\r\n        rect_width = 100,\r\n        rect_height = 20,\r\n        max_link_width = 20,\r\n        min_link_width = 1.5,\r\n        char_to_pxl = 8,\r\n        root;\r\n\r\n    const irislabel = [\"花萼长度\", \"花萼宽度\", \"花瓣长度\", \"花瓣宽度\"];\r\n    const iristype = [\"山鸢尾\", \"杂色鸢尾\", \"维吉尼亚鸢尾\"];\r\n    var tree;\r\n    var diagonal;\r\n    var vis;\r\n    var gLink;\r\n    var gNode;\r\n    var gtext, plusText;\r\n    var link_stoke_scale;\r\n    var color_map;\r\n    var stroke_callback = \"#ccc\";\r\n\r\n    onMount(async () =>{\r\n\r\n        window.scrollTo(0,0);\r\n\r\n        const jdata =await d3.json(\"PUBLIC_URL/assets/data/iris.json\");\r\n\r\n\r\n        tree = d3.tree()\r\n            .size([1000, 1500]);\r\n\r\n        diagonal = d3.linkHorizontal()\r\n            .x(d => d.x)\r\n            .y(d => d.y);\r\n\r\n        vis = d3.select(\"#tree-svg\")\r\n                .attr(\"viewBox\", [-200, -20, w , h]);\r\n\r\n        gLink = vis.append(\"g\")\r\n                .attr(\"fill\", \"none\")\r\n                .attr(\"stroke\", \"#555\")\r\n                .attr(\"stroke-opacity\", 0.4);\r\n\r\n        gNode = vis.append(\"g\")\r\n                .attr(\"pointer-events\", \"all\");\r\n\r\n        gtext = vis.append(\"g\")\r\n                    .attr('class', 'root-text');\r\n        plusText = gtext.append('text')\r\n            .attr('x', 350)\r\n            .attr('y', 0)\r\n            .attr('class', 'annotation-text')\r\n            .style('dominant-baseline', 'hanging')\r\n            .style('text-anchor', 'middle');\r\n        plusText.append('tspan')\r\n            .style('dominant-baseline', 'hanging')\r\n            .text('点击结点展开');\r\n        plusText.append('tspan')\r\n            .attr('x', 350)\r\n            .attr('dy', '1.5em')\r\n            .style('dominant-baseline', 'hanging')\r\n            .text('决策树');\r\n        plusText.append('tspan')\r\n            .attr('x', 350)\r\n            .attr('dy', '1.5em')\r\n            .style('dominant-baseline', 'hanging')\r\n            .text('当满足结点条件时');\r\n        plusText.append('tspan')\r\n            .attr('x', 350)\r\n            .attr('dy', '1.5em')\r\n            .style('dominant-baseline', 'hanging')\r\n            .text('决策前往');\r\n        plusText.append('tspan')\r\n            .attr('fill', 'green')\r\n            .style('dominant-baseline', 'hanging')\r\n            .text('左分支');\r\n        drawArrow({\r\n            group: gtext,\r\n            sx: 380,\r\n            sy: 15,\r\n            tx: 440,\r\n            ty: 0,\r\n            dr: 50,\r\n            hFlip: 0,\r\n        });\r\n\r\n    \r\n        color_map = d3.scaleOrdinal(d3.schemeCategory10);\r\n\r\n        load_dataset(jdata);\r\n    })\r\n\r\n\r\n\r\n    function load_dataset(json) {\r\n        root = d3.hierarchy(json);\r\n        root.x0 = 500;\r\n        root.y0 = 1000;\r\n\r\n        var n_samples = json.samples;\r\n        var n_labels = json.value.length;\r\n\r\n        if (n_labels >= 2) {\r\n            stroke_callback = mix_colors;\r\n        } else if (n_labels === 1) {\r\n            stroke_callback = mean_interpolation(root);\r\n        }\r\n\r\n        link_stoke_scale = d3.scaleLinear()\r\n                                    .domain([0, n_samples])\r\n                                    .rangeRound([min_link_width, max_link_width]);\r\n\r\n        root.descendants().forEach((d, i) => {\r\n            d.id = i;\r\n            d._children = d.children;\r\n            d.children = null;\r\n            if (d.data.type === \"leaf\") d.children = null;\r\n        });\r\n\r\n        update(root);\r\n    }\r\n\r\n    function update(source) {\r\n        var duration = d3.event && d3.event.altKey ? 5000 : 500;\r\n        const nodes = root.descendants().reverse();\r\n        const links = root.links();\r\n\r\n        // d3计算树的结构\r\n        tree(root);\r\n\r\n\r\n        // 设置固定深度\r\n        let ntop = root;\r\n        let nbottom = root;\r\n        nodes.forEach(function(d) { \r\n            d.y = d.depth * 180;\r\n            if(d.y < ntop.y) ntop = d;\r\n            if(d.y > nbottom.y) nbottom = d;   \r\n        });\r\n\r\n        const transition = vis.transition()\r\n            .duration(duration)\r\n            .attr(\"viewBox\", [-200, -20, w , Math.max(300, nbottom.y - ntop.y + 100)])\r\n            .tween(\"resize\", window.ResizeObserver ? null : () => () => vis.dispatch(\"toggle\"));\r\n\r\n        const node = gNode.selectAll(\"g\")\r\n                        .data(nodes, d => d.id)\r\n\r\n        const nodeEnter = node.enter().append(\"g\")\r\n            .attr(\"class\", \"node\")\r\n            .attr(\"transform\", d => `translate(${source.y0},${source.x0})`)\r\n            .attr(\"fill-opacity\", 0)\r\n            .attr(\"stroke-opacity\", 0)\r\n            .on(\"click\", d => {\r\n                d.children = d.children ? null : d._children;\r\n                update(d);\r\n                d3.select('.root-text')\r\n                .transition()\r\n                .duration(200)\r\n                .attr(\"transform\", d => `translate(-150, 0)`)\r\n            });\r\n                \r\n\r\n        nodeEnter.append(\"rect\")\r\n            .attr(\"class\", d => {return d.data.type === \"split\" ? \"cursor\" : \"no\"})\r\n            .attr(\"x\", function(d) {\r\n                var label = node_label(d);\r\n                var text_len = label.length * char_to_pxl;\r\n                var width = d3.max([rect_width, text_len])\r\n                return -width / 2;\r\n            })\r\n            .attr(\"rx\", function(d) { return d.data.type === \"split\" ? 2 : 0;})\r\n            .attr(\"ry\", function(d) { return d.data.type === \"split\" ? 2 : 0;})\r\n            .style(\"stroke\", function(d) { return d.data.type === \"split\" ? \"steelblue\" : \"olivedrab\";})\r\n            .style(\"fill\", function(d) { return d._children ? \"#f7f7f8\" : \"#fff\"; });\r\n\r\n        nodeEnter.append(\"text\")\r\n            .attr(\"class\", d => { return d._children ? 'cursor': 'no'})\r\n            .attr(\"dy\", \"14px\") \r\n            .attr(\"font-size\", \"12px\")\r\n            .attr(\"text-anchor\", \"middle\")\r\n            .append('tspan')\r\n            .style('fill', d => { return d._children ? 'red': 'steelblue'})\r\n            .text(node_label);\r\n\r\n        // 更新结点位置\r\n\r\n        const nodeUpdate = node.merge(nodeEnter).transition()\r\n            .duration(duration)\r\n            .attr(\"transform\", d => `translate(${d.x},${d.y - 5})`)\r\n            .attr(\"fill-opacity\", 1)\r\n            .attr(\"stroke-opacity\", 1);\r\n\r\n\r\n        nodeUpdate.selectAll(\"rect\")\r\n            .attr(\"width\", rect_width)\r\n            .attr(\"height\", rect_height)\r\n            .attr(\"fill\", function(d) { return d._children ? \"#fff\" : \"#fff\"; })\r\n            .style(\"stroke-width\", \"1.5px\");\r\n        \r\n        d3.selectAll(\".cursor\")\r\n            .style(\"cursor\", \"pointer\");\r\n\r\n        nodeUpdate.select(\"text\")\r\n            .style(\"fill-opacity\", 1);\r\n\r\n        const nodeExit = node.exit().transition().remove()\r\n            .attr(\"transform\", d => `translate(${source.x},${source.y})`)\r\n            .attr(\"fill-opacity\", 0)\r\n            .attr(\"stroke-opacity\", 0);\r\n\r\n        // 更新连线\r\n        let link = gLink.selectAll(\"path\")\r\n            .data(links, d => d.target.id);\r\n\r\n\r\n        const linkEnter = link.enter().append(\"path\")\r\n            .attr(\"class\", \"link\")\r\n            .attr(\"d\", d => {\r\n            const o = {x: source.x0, y: source.y0};\r\n            return diagonal({source: o, target: o});\r\n            });\r\n\r\n\r\n        link.merge(linkEnter).transition()\r\n            .attr(\"d\", diagonal)          \r\n            .style(\"stroke\", stroke_callback)\r\n            .style(\"stroke-width\", \"5\");\r\n\r\n        \r\n        link.exit().transition()\r\n            .attr(\"d\", d => {\r\n            const o = {x: source.x, y: source.y};\r\n            return diagonal({source: o, target: o});\r\n            }).remove();\r\n\r\n\r\n        nodes.forEach(function(d) {\r\n            d.x0 = d.x;\r\n            d.y0 = d.y;\r\n        });\r\n    }\r\n\r\n    // 结点标签\r\n    function node_label(d) {\r\n        d = d.data;\r\n        if (d.type === \"leaf\") {\r\n            // 叶子\r\n            var formatter = d3.format(\".2f\");\r\n            var vals = [];\r\n            d.value.forEach(function(v) {\r\n                vals.push(v);\r\n            });\r\n            var maxvalue = Math.max(...vals);\r\n            var index = vals.indexOf(maxvalue);\r\n            return iristype[vals.indexOf(Math.max(...vals))];\r\n        } else {\r\n            // 非叶结点\r\n            var label = d.label;\r\n            label = label.replace(\"X[0]\", irislabel[0]);\r\n            label = label.replace(\"X[1]\", irislabel[1]);\r\n            label = label.replace(\"X[2]\", irislabel[2]);\r\n            label = label.replace(\"X[3]\", irislabel[3]);\r\n            return label;\r\n        }\r\n    }\r\n\r\n    function mix_colors(d) {\r\n        var value = d.target.data.value;\r\n        var sum = d3.sum(value);\r\n        var col = d3.rgb(0, 0, 0);\r\n        value.forEach(function(val, i) {\r\n            var label_color = d3.rgb(color_map(i));\r\n            var mix_coef = val / sum;\r\n            col.r += mix_coef * label_color.r;\r\n            col.g += mix_coef * label_color.g;\r\n            col.b += mix_coef * label_color.b;\r\n        });\r\n        return col;\r\n    }\r\n\r\n\r\n    /**\r\n     设置线段颜色.\r\n     */\r\n    function mean_interpolation(root) {\r\n\r\n        var max = 1e-9,\r\n            min = 1e9;\r\n\r\n        function recurse(node) {\r\n            if (node.value[0] > max) {\r\n            max = node.value[0];\r\n            }\r\n\r\n            if (node.value[0] < min) {\r\n            min = node.value[0];\r\n            }\r\n\r\n            if (node.children) {\r\n            node.children.forEach(recurse);\r\n            }\r\n        }\r\n        recurse(root);\r\n\r\n        var scale = d3.scale.linear().domain([min, max])\r\n                                    .range([\"#2166AC\",\"#B2182B\"]);\r\n\r\n        function interpolator(d) {\r\n            return scale(d.target.data.value[0]);\r\n        }\r\n\r\n        return interpolator;\r\n    }\r\n\r\n    const drawArrow = (arg) => {\r\n        let group = arg.group,\r\n            sx = arg.sx,\r\n            sy = arg.sy,\r\n            tx = arg.tx,\r\n            ty = arg.ty,\r\n            dr = arg.dr,\r\n            hFlip = arg.hFlip,\r\n            marker = arg.marker === undefined ? 'marker' : arg.marker;\r\n        \r\n        let arrow = group.append('g')\r\n            .attr('class', 'arrow-group');\r\n\r\n        arrow.append('path')\r\n            .attr(\"d\", `M${sx},${sy}A${dr},${dr} 0 0,${hFlip ? 0 : 1} ${tx},${ty}`)\r\n            .attr('marker-end', 'url(#markerArrow)')\r\n            .style('stroke', 'gray')\r\n            .style('fill', 'none');\r\n    }\r\n\r\n</script>\r\n\r\n\r\n<style type=\"text/css\">\r\n\r\n    #article{\r\n        margin-top:60px;\r\n        margin-bottom: 60px;\r\n        margin-left: auto;\r\n        margin-right: auto;\r\n        max-width: 78ch;\r\n    }\r\n    #article p{\r\n        margin: 16px 0;\r\n        color: #555;\r\n        font-size: 17px;\r\n        line-height: 1.6;\r\n    }\r\n    #treebody{\r\n        position:relative;\r\n        width: 100%;\r\n        /* height: 680px; */\r\n        margin-bottom: 10px;\r\n        font-family: \"Helvetica\", \"Arial\", sans-serif;\r\n        background-color: #f7f7f7;\r\n    }\r\n    #foot{\r\n        margin-left: auto;\r\n        margin-right: auto;\r\n        max-width: 78ch;\r\n        position:relative;\r\n        border-top: solid 1px #eee;\r\n        padding: 20px 20px;\r\n    }\r\n    #foot .lasttext{\r\n        font-style: italic;\r\n        font-size: 20px;\r\n        color: peru;\r\n    }\r\n    #treebody {\r\n        width: 100%;\r\n        margin: auto;\r\n    }\r\n    .return {\r\n        position: absolute;\r\n        right: -300px;\r\n        top: 80%;\r\n        font-size: 20px;\r\n        font-style: italic;\r\n        color: steelblue;\r\n    }\r\n    .title{\r\n        font-style: italic;\r\n        color: steelblue;\r\n        font-size: 24px;\r\n        font-weight: 450;\r\n        margin-bottom: 8px;\r\n        margin-top: 44px;\r\n    }\r\n    .footbody p{\r\n        margin: 16px 0;\r\n        color: #555;\r\n        font-size: 17px;\r\n        line-height: 1.6;\r\n    }\r\n</style>\r\n\r\n<div id=\"article\">\r\n    <div id=\"One\"><h1>Section: 决策树</h1></div>\r\n    <p>\r\n        <strong>\r\n            第二天，你在网上看到了一个叫做决策树的分类模型，看到了决策树的基本原理之时，你想起了之前询问一个学园艺的哥哥的经历，你问他：“这是哪一类的鸢尾花？”他向你询问更多的细节：“你先看它的花萼长吗？，如果是长花萼，我们再看看它的花瓣是怎样的形态？哦，是窄花瓣，那这应该是山鸢尾花。” \r\n            结合之前的经历，你于是明白了这就是一个决策的过程。在理解了什么是决策的过程之后，你对决策树是如何进行具体决策的过程愈发感兴趣，于是你开始了进一步的学习。\r\n        </strong>\r\n    </p>\r\n\r\n    <div class=\"l--body\">\r\n      <h2 class='title'>决策树模型</h2>\r\n        <ul> \r\n            <li>每个“非叶结点”对应于某属性上的一次决策</li> \r\n            <li>每个结点之后分支对应于该决策的一种可能结果</li>\r\n            <li>每个“叶结点”对应于一个预测结果</li> \r\n        </ul>\r\n      <p>决策树的学习过程即通过对训练样本的分析来确定“划分属性”（即内部结点所对应的属性），而预测过程就是将测试示例从根结点开始，沿着划分属性所构成的“判定测试序列”下行，直到叶结点</p>\r\n    </div>\r\n\r\n    <div class=\"l--body\">\r\n      <h2 class='title'>再来看看这棵树</h2>\r\n        <p>当你在选取判断的时候，你可能像之前那样判断鸢尾花花瓣的长宽。花瓣的长度和宽度是两个不同的“特征”。</p>\r\n        <p>这个特征能否很好的区分鸢尾花的类型呢？你要如何衡量这个判断指标呢？</p>\r\n        <p>统计学里有几种算法可以帮助我们寻找好的切分点，通过划分算法来找到当前最佳的结点划分方式。简单来讲，每一个特征针对训练数据集的前后信息变化的影响是不一样的，当这些衡量参数在划分前后变化越大，即代表这种影响越大。而影响越大，就表明该特征更加重要。</p>\r\n    </div>\r\n\r\n    <div class=\"l--body\">\r\n      <h2 class='title'>决策树生长</h2>\r\n      <p>当你点开各个分节点，更多的分支会给决策树增加新的信息，从而增强决策树的预测准确性。加多一层，决策树的准确性增加到84%。再加几层，准确性增加到96%。我们甚至可以继续加分支直到决策树的分类正确率达到100%，这所有决策树末梢的分类结果会是纯粹山鸢尾花或者变色鸢尾，即将两类鸢尾花完全分开。</p>\r\n      <p>决策树的末节通常又叫做叶节点(leaf nodes)。决策树的预测取决于叶节点内哪一类的样本相对较多。</p>\r\n    </div>\r\n    <div class=\"l--body\">\r\n      <h2 class='title'>尝试一下</h2>\r\n      <p>在经过一番研究之后，你终于利用现有的数据训练好了一个决策树的分类模型了。这时候如果你得到了一个新的鸢尾花的数据，决策树会如何做出决策呢？根据下方的决策树模型，来看看它是如何做出决策的吧！</p>\r\n    </div>\r\n</div>\r\n<div id=\"treebody\">\r\n    <svg id=\"tree-svg\"></svg>\r\n</div>\r\n\r\n<footer id=\"foot\">\r\n    <div class=\"footbody\">\r\n      <h3 class='title'>扩展与补充</h3>\r\n      <p>决策树算法广泛应用于：语音识别、医疗诊断、客户关系管理、模式识别、专家系统等，在实际工作中，必须根据数据类型的特点及数据集的大小，选择合适的算法。想了解更多的相关知识，可以在机器学习相关的书籍中更详细的决策树原理。</p>\r\n    </div>\r\n    <div class=\"lasttext\">\r\n      <p>决策树是模仿一个人进行决策的过程，这让你想起了查阅资料过程中无意中看到的一个叫神经网络的模型，它好像是根据模仿人脑神经结构所提出来的一种模型，那么这种更加深入的模仿人脑神经运作的网络是不是能够更为有效的识别出鸢尾花的品种呢？你又带着更大的好奇心开始了新一轮的探索。。。</p>\r\n    </div>\r\n    <a href=\"/\" use:link rel=\"prefetch\">\r\n        <div class=\"return\">返回</div>\r\n    </a>\r\n</footer>",
    "<script>\r\n  import Knn from './Knn.svelte'\r\n  import NN1 from './Graph1_view.svelte'\r\n</script>\r\n<style>\r\n  h1,\r\n  h2,\r\n  h3,\r\n  h4,\r\n  h5,\r\n  h6 {\r\n    font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto,\r\n      Oxygen-Sans, Ubuntu, Cantarell, Helvetica Neue, sans-serif;\r\n  }\r\n  .Content-module--content__title--2nRHa {\r\n    font-size: 2.5rem;\r\n    line-height: 3.25rem;\r\n    margin-top: 2.4375rem;\r\n    font-weight: 500;\r\n  }\r\n  .Content-module--content__subtitle--34jJU {\r\n    font-size: 1.875rem;\r\n    line-height: 2.4375rem;\r\n  }\r\n  .Content-module--content__spacer--2kN9Y {\r\n    margin-bottom: 1.625rem;\r\n  }\r\n  .katex-display {\r\n    margin: 1em auto;\r\n    margin-top: 1em;\r\n    margin-right: auto;\r\n    margin-bottom: 1em;\r\n    margin-left: auto;\r\n    display: block;\r\n    text-align: center;\r\n  }\r\n  .katex {\r\n    font: normal 1.21em KaTeX_Main, Times New Roman, serif;\r\n    line-height: 1.2;\r\n    text-indent: 0;\r\n    text-rendering: auto;\r\n  }\r\n  .katex .katex-mathml {\r\n    position: absolute;\r\n    clip: rect(1px, 1px, 1px, 1px);\r\n    padding: 0;\r\n    border: 0;\r\n    height: 1px;\r\n    width: 1px;\r\n    overflow: hidden;\r\n  }\r\n  .katex-display > .katex > .katex-html {\r\n    display: block;\r\n    position: relative;\r\n  }\r\n  .katex .base {\r\n    position: relative;\r\n    white-space: nowrap;\r\n    width: min-content;\r\n  }\r\n  .katex .base,\r\n  .katex .strut,\r\n  .katex .mspace {\r\n    display: inline-block;\r\n  }\r\n  .inline-square {\r\n    margin-left: 5px;\r\n    width: 12px;\r\n    height: 12px;\r\n    display: inline-block;\r\n  }\r\n  .left_tree {\r\n    position: fixed;\r\n    top: 90px;\r\n    width: 16vw;\r\n    height: 100%;\r\n    background: rgba(103, 103, 120, 1);\r\n  }\r\n  .left_tree ul {\r\n    list-style: none;\r\n  }\r\n  .left_tree li a {\r\n    color: white;\r\n  }\r\n  .right_content {\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    max-width: 100ch;\r\n    height: calc(100% - 90px);\r\n  }\r\n  .name_md {\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n  }\r\n  /* 这是用来固定锚点位置的 具体样式在.name_md里写 */\r\n  .extra {\r\n    border-top: solid 200px #fff;\r\n    margin-top: -200px;\r\n  }\r\n  .picture1 {\r\n    width: 200px;\r\n    height: 200px;\r\n    background-image: url(\"tmp/Picture1.png\");\r\n    background-size: 100% auto;\r\n    color: transparent !important;\r\n  }\r\n</style>\r\n\r\n<div class=\"right_content\">\r\n  <div class=\"name_md extra\" id=\"Zero\"></div>\r\n  <div>\r\n    <h2 class=\"Content-module--content__title--2nRHa \">\r\n      1.决策树——“分而治之”\r\n    </h2>\r\n    <br/>\r\n    <div class=\"Content-module--content__spacer--2kN9Y\" />\r\n    <h5>\r\n      你想起之前有一个学园艺的哥哥，你问他：“这是哪一类的鸢尾花？”他向你询问更多的细节：你先看“它的花萼长吗？”，如果是“长花萼”，我们再看“它的花瓣是怎样的形态？”，是“窄花瓣”，那我们得到最终决策：这是山鸢尾花。\r\n    </h5>\r\n  </div>\r\n\r\n  <!-- More -->\r\n  <div class=\"more\">\r\n    <!-- <button class=\"mdl-button mdl-js-button mdl-button--icon\"><i class=\"material-icons\">keyboard_arrow_down</i></button> -->\r\n    <button class=\"mdl-button mdl-js-button mdl-button--fab\">\r\n      <i class=\"material-icons\">keyboard_arrow_down</i>\r\n    </button>\r\n  </div>\r\n  <div class=\"name_md extra\" id=\"One\"><h2>1. 遇到分类问题</h2></div>\r\n  <div>\r\n    <h5>\r\n      你观察到有一块集中的部分的鸢尾有较大的花瓣，而它旁边的一块的花瓣却很小。你想搞清楚他们究竟属于哪一类鸢尾花，于是你上网搜索，发现网上说可以根据一些特征值来刻画事物的某些方面的特点，比如通过花萼的长、花萼的宽、花瓣的长和花瓣的宽来辨别他们。于是你测量了一些花的长和宽。\r\n    </h5>\r\n   \r\n    <h5>***********************一些鸢尾花图片***********************</h5>\r\n  </div>\r\n\r\n    <!-- More -->\r\n  <div class=\"more\">\r\n    <!-- <button class=\"mdl-button mdl-js-button mdl-button--icon\"><i class=\"material-icons\">keyboard_arrow_down</i></button> -->\r\n    <button class=\"mdl-button mdl-js-button mdl-button--fab\">\r\n      <i class=\"material-icons\">keyboard_arrow_down</i>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"name_md extra\" id=\"One\"><h2>2.决策树-简单分析</h2></div>\r\n  <h5>\r\n    网上说宽大于2cm，长大于5cm的可能是山鸢尾。而小于的可能是变色鸢尾，你发现了很多这样的判断，\r\n    你想把他们整理一下，于是你借鉴树的结构将他们分成了这种判断：\r\n  </h5>\r\n  <div>\r\n    <a target=\"_blank\" href=\"/dt/index.html\">尝试下决策树吧</a>\r\n  </div>\r\n\r\n  <!-- More -->\r\n  <div class=\"more\">\r\n    <!-- <button class=\"mdl-button mdl-js-button mdl-button--icon\"><i class=\"material-icons\">keyboard_arrow_down</i></button> -->\r\n    <button class=\"mdl-button mdl-js-button mdl-button--fab\">\r\n      <i class=\"material-icons\">keyboard_arrow_down</i>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"name_md extra\" id=\"One\"><h2>3.初步构造分类器</h2></div>\r\n  <div>\r\n  <h5>\r\n      然后你又换了一种思路\r\n      你将花瓣的长作为x轴，花瓣的宽作为y轴，在坐标轴上画出了他们的分布。\r\n\r\n    </h5>\r\n    <h5>***************一些样简单交互*********************</h5>\r\n    <NN1 />\r\n    <h5>\r\n      这就是人工智能中的分类问题。\r\n那么我们要怎么分开他们呢 你想到了用一条直线来分开他们。在直线上方的属于山鸢尾，在直线下方的属于变色鸢尾。这样的方式叫作分类器\r\n但是你也发现了，这里有无数直线都可以的可能来讲他们分开。你想到现在大家都在谈用计算机来帮我们完成一些任务，那么要怎么才能让分类器自己学习得到分类直线呢。\r\n试一试：\r\n    </h5>\r\n    <li>\r\n        <a target=\"_blank\" href=\"/dist/indexnn.html\">尝试下神经网络吧</a>\r\n    </li>\r\n  </div>\r\n\r\n    <!-- More -->\r\n  <div class=\"more\">\r\n    <!-- <button class=\"mdl-button mdl-js-button mdl-button--icon\"><i class=\"material-icons\">keyboard_arrow_down</i></button> -->\r\n    <button class=\"mdl-button mdl-js-button mdl-button--fab\">\r\n      <i class=\"material-icons\">keyboard_arrow_down</i>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"name_md extra\" id=\"One\"><h2>4. KNN</h2></div>\r\n  <div>\r\n    <h5>\r\n      你觉得这样好像还不错。于是你在更远处的一块地，发现那里的鸢尾花好像和前面两种也有不同之处，它们长得更高，更细长。\r\n      于是你认为植物园的工作人员们可能将某一类鸢尾花集中地种在了某一块地方，于是你测量更多的数据重新绘制了一张坐标图。\r\n      但是新的问题来了，要怎么判断中间一些点的种类到底是什么呢。\r\n      于是你想到了一句谚语：“近朱者赤近墨者黑。”\r\n      试一试：\r\n    </h5>\r\n    <li>\r\n        <a target=\"_blank\" href=\"/dt/index.html\">尝试下KNN吧</a>\r\n    </li>\r\n  </div>\r\n\r\n  <div id='knnss'>\r\n    <Knn />\r\n  </div>\r\n\r\n<div class=\"name_md extra\" id=\"One\"><h2>5.CNN-一气呵成</h2></div>\r\n  <div>\r\n    <h5>\r\n      然后你发现这几种方法各有好坏，也有不足。\r\n而且测量起来特别麻烦。\r\n你想到了我们都在用的一些识别植物的APP，于是你打开了一个软件，拍了一张照片，立马就将它分为了山鸢尾花。这是怎么一回事呢。\r\n这个又用的哪些特征呢。\r\n这个和上面的方法有什么不同之处呢。\r\n试一试：\r\n\r\n    </h5>\r\n    <li>\r\n        <a target=\"_blank\" href=\"/cnn\">尝试下CNN吧</a>\r\n    </li>\r\n  </div>\r\n\r\n  <!-- More -->\r\n  <div class=\"more\">\r\n    <!-- <button class=\"mdl-button mdl-js-button mdl-button--icon\"><i class=\"material-icons\">keyboard_arrow_down</i></button> -->\r\n    <button class=\"mdl-button mdl-js-button mdl-button--fab\">\r\n      <i class=\"material-icons\">keyboard_arrow_down</i>\r\n    </button>\r\n  </div>\r\n\r\n  <div class=\"name_md extra\" id=\"One\"><h2>6.不同模型比较</h2></div>\r\n  <div>\r\n    <h5>\r\n      *****************一些交互***********************\r\n    </h5>\r\n  </div>\r\n\r\n</div>",
    "<script>\r\n  import Knn from \"./Knn.svelte\";\r\n  import Tree from \"./Tree.svelte\";\r\n  import { onMount } from \"svelte\";\r\n  import { tick } from \"svelte\";\r\n  import { link } from \"svelte-spa-router\";\r\n\r\n  var cont;\r\n  var elsArr;\r\n  var closeBtnsArr;\r\n  var dcont;\r\n  var selected = 0;\r\n  var dynamiccss = \"cont s--inactive\";\r\n  // 不加onMount  cont取不到值\r\n  onMount(async () => {\r\n    cont = document.querySelector(\".cont\");\r\n    elsArr = [].slice.call(document.querySelectorAll(\".el\"));\r\n    closeBtnsArr = [].slice.call(document.querySelectorAll(\".el__close-btn\"));\r\n\r\n    setTimeout(function() {\r\n      // cont.classList.remove('s--inactive');\r\n      dynamiccss = \"cont\";\r\n    }, 200);\r\n\r\n    elsArr.forEach(function(el, index) {\r\n      el.addEventListener(\r\n        \"click\",\r\n        function() {\r\n          selected = index + 1;\r\n          // if (this.classList.contains('s--active')) return;\r\n          // cont.classList.add('s--el-active');\r\n          // this.classList.add('s--active');\r\n        },\r\n        true\r\n      );\r\n    });\r\n\r\n    closeBtnsArr.forEach(function(btn) {\r\n      btn.addEventListener(\r\n        \"click\",\r\n        function(e) {\r\n          e.stopPropagation();\r\n          selected = 0;\r\n          // cont.classList.remove('s--el-active');\r\n          // document.querySelector('.el.s--active').classList.remove('s--active');\r\n        },\r\n        true\r\n      );\r\n    });\r\n  });\r\n</script>\r\n\r\n<style>\r\n  #begin {\r\n    margin-top: 60px;\r\n    margin-bottom: 60px;\r\n    margin-left: auto;\r\n    margin-right: auto;\r\n    max-width: 78ch;\r\n  }\r\n  .t {\r\n    font-size: 20px;\r\n  }\r\n  .flower {\r\n    color: steelblue;\r\n  }\r\n</style>\r\n\r\n<div id=\"begin\">\r\n  <p>\r\n    “UnboxAI打造了一个全套的教学生态系统来辅助智慧校园中开设的人工智能的课程，可以脱离纸质书籍教学，所有的内容均在电脑或者平板上完成。UnboxAI以第一人称的角色，通过算法可视化，用户可交互性带给同学们更强的体验感，有助于更好地理解人工智能算法背后的原理并激发同学们继续深入学习机器学习、深度学习的相关数学、编程知识。”\r\n  </p>\r\n  <br/>\r\n  <h1 style=\"color: peru;\">欢迎来到UnboxAI，在这里我们将以情节的方式，在不同的故事线中，由浅入深地带你学习人工智能的相关知识。</h1>\r\n  <br/>\r\n  <br/>\r\n  <div id=\"one\">\r\n    <h1 style=\"font-weight:500 \">故事线——植物园（分类任务）</h1>\r\n  </div>\r\n  <div id=\"article\">\r\n    <p class=\"t\">\r\n      学校组织去植物园春游，一片特别好看的蓝紫色的花海映入你眼帘，像一只只穿梭在绿草中的美丽蝴蝶。\r\n    </p>\r\n    <p class=\"t\">\r\n      你看到牌上的介绍说：这是鸢尾花，常见的有三大类:\r\n      <b class=\"flower\">山鸢尾</b>\r\n      (Iris-setosa)，\r\n      <b class=\"flower\">变色鸢尾</b>\r\n      (Iris-versicolor)和\r\n      <b class=\"flower\">维吉尼亚鸢尾</b>\r\n      (Iris-virginica)。\r\n    </p>\r\n    <p class=\"t\">\r\n      它们有着形状与色彩相似的花瓣和萼片。你观察到有一块集中的部分的鸢尾有较大的花瓣，而它旁边的一块的花瓣却很小。你想搞清楚它们究竟属于哪一类鸢尾花。\r\n    </p>\r\n    <p class=\"t\">\r\n      于是你上网搜索，发现网上说可以根据一些特征值来刻画事物的某些方面的特点，比如通过花萼的长、花萼的宽、花瓣的长和花瓣的宽来辨别他们。\r\n    </p>\r\n    <p class=\"t\">\r\n      <b>让我们从section1开始吧！</b>\r\n    </p>\r\n  </div>\r\n</div>\r\n\r\n<div class={selected > 0 ? 'cont s--el-active' : dynamiccss}>\r\n  <!-- cont inner start -->\r\n  <div class=\"cont__inner\">\r\n    <!-- el start -->\r\n    <div class={selected === 1 ? 'el s--active' : 'el'}>\r\n      <div class=\"el__overflow\">\r\n        <div class=\"el__inner\">\r\n          <div class=\"el__bg\" />\r\n          <div class=\"el__preview-cont\">\r\n            <h2 class=\"el__heading\" style=\"color:#f6f6f6\">Section 1</h2>\r\n          </div>\r\n          <div class=\"el__content\">\r\n            <a href=\"/knn\" use:link rel=\"prefetch\">\r\n              <div class=\"el__text\">Enter Section 1</div>\r\n            </a>\r\n            <div class=\"el__close-btn\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"el__index\">\r\n        <div class=\"el__index-back\">1</div>\r\n        <div class=\"el__index-front\">\r\n          <div class=\"el__index-overlay\" data-index=\"1\">1</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- el end -->\r\n    <!-- el start -->\r\n    <div class={selected === 2 ? 'el s--active' : 'el'}>\r\n      <div class=\"el__overflow\">\r\n        <div class=\"el__inner\">\r\n          <div class=\"el__bg\" />\r\n          <div class=\"el__preview-cont\">\r\n            <h2 class=\"el__heading\" style=\"color:#f6f6f6\">Section 2</h2>\r\n          </div>\r\n          <div class=\"el__content\">\r\n            <a href=\"/tree\" use:link rel=\"prefetch\">\r\n              <div class=\"el__text\">Enter Section 2</div>\r\n            </a>\r\n            <div class=\"el__close-btn\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"el__index\">\r\n        <div class=\"el__index-back\">2</div>\r\n        <div class=\"el__index-front\">\r\n          <div class=\"el__index-overlay\" data-index=\"2\">2</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- el end -->\r\n    <!-- el start -->\r\n    <div class={selected === 3 ? 'el s--active' : 'el'}>\r\n      <div class=\"el__overflow\">\r\n        <div class=\"el__inner\">\r\n          <div class=\"el__bg\" />\r\n          <div class=\"el__preview-cont\">\r\n            <h2 class=\"el__heading\" style=\"color:#f6f6f6\">Section 3</h2>\r\n          </div>\r\n          <div class=\"el__content\">\r\n            <a href=\"/\" use:link rel=\"prefetch\">\r\n              <div class=\"el__text\">Enter Section 3</div>\r\n            </a>\r\n            <div class=\"el__close-btn\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"el__index\">\r\n        <div class=\"el__index-back\">3</div>\r\n        <div class=\"el__index-front\">\r\n          <div class=\"el__index-overlay\" data-index=\"3\">3</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- el end -->\r\n    <!-- el start -->\r\n    <div class={selected === 4 ? 'el s--active' : 'el'}>\r\n      <div class=\"el__overflow\">\r\n        <div class=\"el__inner\">\r\n          <div class=\"el__bg\" />\r\n          <div class=\"el__preview-cont\">\r\n            <h2 class=\"el__heading\" style=\"color:#f6f6f6\">Section 4</h2>\r\n          </div>\r\n          <div class=\"el__content\">\r\n            <a href=\"/cnn\" use:link rel=\"prefetch\">\r\n              <div class=\"el__text\">Enter Section 4</div>\r\n            </a>\r\n            <div class=\"el__close-btn\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"el__index\">\r\n        <div class=\"el__index-back\">4</div>\r\n        <div class=\"el__index-front\">\r\n          <div class=\"el__index-overlay\" data-index=\"4\">4</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- el end -->\r\n    <!-- el start -->\r\n    <div class={selected === 5 ? 'el s--active' : 'el'}>\r\n      <div class=\"el__overflow\">\r\n        <div class=\"el__inner\">\r\n          <div class=\"el__bg\" />\r\n          <div class=\"el__preview-cont\">\r\n            <h2 class=\"el__heading\" style=\"color:#f6f6f6\">Section 5</h2>\r\n          </div>\r\n          <div class=\"el__content\">\r\n            <a href=\"/\" use:link rel=\"prefetch\">\r\n              <div class=\"el__text\">Continue...</div>\r\n            </a>\r\n            <div class=\"el__close-btn\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"el__index\">\r\n        <div class=\"el__index-back\">5</div>\r\n        <div class=\"el__index-front\">\r\n          <div class=\"el__index-overlay\" data-index=\"5\">5</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <!-- el end -->\r\n  </div>\r\n  <!-- cont inner end -->\r\n</div>\r\n<footer style=\"background-color: #37474f\">\r\n  <span\r\n    style=\"text-align: right;color: #f6f6f6;font-weight:300;;font-size: 13px\">\r\n    Deecamp2020 4-2 UnboxTherapy\r\n  </span>\r\n</footer>\r\n"
  ],
  "names": [],
  "mappings": "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"
}